<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Juliette Legrand">
<meta name="author" content="François Pimont">
<meta name="author" content="Jean-Luc Dupuy">
<meta name="author" content="Thomas Opitz">
<meta name="dcterms.date" content="2023-10-31">
<meta name="keywords" content="Climate projection, Integrated Nested Laplace Approximation, Marked log-Gaussian Cox process, Spatiotemporal model, SPDE approach, Wildfire">

<title>Bayesian spatiotemporal modelling of wildfire occurrences and sizes for projections under climate change</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="submitted-202310-legrand-wildfire_files/libs/clipboard/clipboard.min.js"></script>
<script src="submitted-202310-legrand-wildfire_files/libs/quarto-html/quarto.js"></script>
<script src="submitted-202310-legrand-wildfire_files/libs/quarto-html/popper.min.js"></script>
<script src="submitted-202310-legrand-wildfire_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="submitted-202310-legrand-wildfire_files/libs/quarto-html/anchor.min.js"></script>
<link href="submitted-202310-legrand-wildfire_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="submitted-202310-legrand-wildfire_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="submitted-202310-legrand-wildfire_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="submitted-202310-legrand-wildfire_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="submitted-202310-legrand-wildfire_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: #FFFFFF;
      }

      .quarto-title-block .quarto-title-banner {
        color: #FFFFFF;
background: #034E79;
      }
</style>

<script src="submitted-202310-legrand-wildfire_files/libs/kePrint/kePrint.js"></script>
<link href="submitted-202310-legrand-wildfire_files/libs/lightable/lightable.css" rel="stylesheet">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title"><a href="https://computo.sfds.asso.fr">
        <img src="https://computo.sfds.asso.fr/assets/img/logo_notext_white.png" height="60px">
      </a> &nbsp; Bayesian spatiotemporal modelling of wildfire occurrences and sizes for projections under climate change</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> source</button></div></div>
            <p class="subtitle lead">A step-by-step marked point process approach using INLA-SPDE</p>
            <p><a href="http://creativecommons.org/licenses/by/4.0/"><img src="https://i.creativecommons.org/l/by/4.0/80x15.png" alt="Creative Commons BY License"></a>
ISSN 2824-7795</p>
                </div>
  </div>
    
    <div class="quarto-title-meta-author">
      <div class="quarto-title-meta-heading">Authors</div>
      <div class="quarto-title-meta-heading">Affiliations</div>
          
          <div class="quarto-title-meta-contents">
        Juliette Legrand 
      </div>
          
          <div class="quarto-title-meta-contents">
              <p class="affiliation">
                  <a href="https://biosp.mathnum.inrae.fr/">
                  Biostatistics and Spatial Processes, INRAE, Avignon, France
                  </a>
                </p>
            </div>
            <div class="quarto-title-meta-contents">
        François Pimont 
      </div>
          
          <div class="quarto-title-meta-contents">
              <p class="affiliation">
                  <a href="https://www6.paca.inrae.fr/ecologie_des_forets_mediterraneennes/Les-personnes/Personnels-permanents/DUPUY-Jean-Luc">
                  Ecologie des Forêts Méditerranéennes (URFM), INRAE, Avignon, France
                  </a>
                </p>
            </div>
            <div class="quarto-title-meta-contents">
        <a href="https://biosp.mathnum.inrae.fr/homepage-thomas-opitz">Jean-Luc Dupuy</a> 
      </div>
          
          <div class="quarto-title-meta-contents">
              <p class="affiliation">
                  Ecologie des Forêts Méditerranéennes (URFM), INRAE, Avignon, France
                </p>
            </div>
            <div class="quarto-title-meta-contents">
        <a href="https://biosp.mathnum.inrae.fr/homepage-thomas-opitz">Thomas Opitz</a> 
      </div>
          
          <div class="quarto-title-meta-contents">
              <p class="affiliation">
                  <a href="https://biosp.mathnum.inrae.fr/">
                  Biostatistics and Spatial Processes, INRAE, Avignon, France
                  </a>
                </p>
            </div>
        </div>
                    
  <div class="quarto-title-meta">
                                
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 31, 2023</p>
      </div>
    </div>
                                    
      
                  
      <div>
      <div class="quarto-title-meta-heading">Keywords</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Climate projection, Integrated Nested Laplace Approximation, Marked log-Gaussian Cox process, Spatiotemporal model, SPDE approach, Wildfire</p>
      </div>
    </div>
    
    <div>
      <div class="quarto-title-meta-heading">Status</div>
      <div class="quarto-title-meta-contents">
              <p class="date">draft</p>
                  </div>
    </div>

  </div>
                                                
  <div>
    <div class="abstract">
    <div class="abstract-title">Abstract</div>
      <p>Appropriate spatiotemporal modelling of wildfire activity is crucial for its prediction and risk management. Here, we focus on wildfire risk in the Aquitaine region in the Southwest of France and its projection under climate change. We study whether wildfire risk could further increase under climate change in this specific region, which does not lie in the historical core area of wildfires in Southeastern France, corresponding to the Southeast. For this purpose, we consider a marked spatiotemporal point process, a flexible model for occurrences and magnitudes of such environmental risks, where the magnitudes are defined as the burnt areas. The model is first calibrated using 14 years of past observation data of wildfire occurrences and weather variables, and then applied for projection of climate-change impacts using simulations of numerical climate models until 2100 as new inputs. We work within the framework of a spatiotemporal Bayesian hierarchical model, and we present the workflow of its implementation for a large dataset at daily resolution for 8km-pixels using the INLA-SPDE approach. The assessment of the posterior distributions shows a satisfactory fit of the model for the observation period. We stochastically simulate projections of future wildfire activity by combining climate model output with posterior simulations of model parameters. Depending on climate models, spline-smoothed projections indicate low to moderate increase of wildfire activity under climate change. The increase is weaker than in the historical core area, which we attribute to different weather conditions (oceanic versus Mediterranean). Besides providing a relevant case study of environmental risk modelling, this paper is also intended to provide a full workflow for implementing the Bayesian estimation of marked log-Gaussian Cox processes using the R-INLA package of the R statistical software.</p>
    </div>
  </div>

  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#sec-intro" id="toc-sec-intro" class="nav-link active" data-scroll-target="#sec-intro"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#sec-data" id="toc-sec-data" class="nav-link" data-scroll-target="#sec-data"><span class="header-section-number">2</span> Fire data</a></li>
  <li><a href="#sec-model-inf" id="toc-sec-model-inf" class="nav-link" data-scroll-target="#sec-model-inf"><span class="header-section-number">3</span> Model and inference</a>
  <ul class="collapse">
  <li><a href="#subsampling" id="toc-subsampling" class="nav-link" data-scroll-target="#subsampling"><span class="header-section-number">3.1</span> Subsampling</a></li>
  <li><a href="#sec-model" id="toc-sec-model" class="nav-link" data-scroll-target="#sec-model"><span class="header-section-number">3.2</span> Model definition</a></li>
  <li><a href="#inla-settings" id="toc-inla-settings" class="nav-link" data-scroll-target="#inla-settings"><span class="header-section-number">3.3</span> INLA settings</a></li>
  <li><a href="#estimation-of-the-occurrence-model" id="toc-estimation-of-the-occurrence-model" class="nav-link" data-scroll-target="#estimation-of-the-occurrence-model"><span class="header-section-number">3.4</span> Estimation of the occurrence model</a></li>
  <li><a href="#estimation-of-the-size-model" id="toc-estimation-of-the-size-model" class="nav-link" data-scroll-target="#estimation-of-the-size-model"><span class="header-section-number">3.5</span> Estimation of the size model</a></li>
  </ul></li>
  <li><a href="#sec-sim" id="toc-sec-sim" class="nav-link" data-scroll-target="#sec-sim"><span class="header-section-number">4</span> Wildfire simulations from the posterior distribution for the observation period (2006-2020)</a>
  <ul class="collapse">
  <li><a href="#occurrence-component" id="toc-occurrence-component" class="nav-link" data-scroll-target="#occurrence-component"><span class="header-section-number">4.1</span> Occurrence component</a></li>
  <li><a href="#sec-sim-sizes" id="toc-sec-sim-sizes" class="nav-link" data-scroll-target="#sec-sim-sizes"><span class="header-section-number">4.2</span> Size component</a></li>
  </ul></li>
  <li><a href="#sec-proj" id="toc-sec-proj" class="nav-link" data-scroll-target="#sec-proj"><span class="header-section-number">5</span> Future wildfire simulations derived from climate model projections</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion"><span class="header-section-number">6</span> Discussion</a></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix">Appendix</a></li>
  <li><a href="#ackowledgments" id="toc-ackowledgments" class="nav-link" data-scroll-target="#ackowledgments">Ackowledgments</a></li>
  <li><a href="#supplementary-materials" id="toc-supplementary-materials" class="nav-link" data-scroll-target="#supplementary-materials">Supplementary materials</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="submitted-202310-legrand-wildfire.pdf"><i class="bi bi-file-pdf"></i>PDF (computo)</a></li></ul></div></nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">



<section id="sec-intro" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>As recently experienced in France during summer 2022, wildfires constitute a major threat for the environment and the society. Climate change leads to an increase in societal and economic risks related to wildfires <span class="citation" data-cites="Riviere2022">(<a href="#ref-Riviere2022" role="doc-biblioref">Riviere et al. 2022</a>)</span>, and moreover to an increase in fire-prone regions worldwide <span class="citation" data-cites="Abatzoglou2019">(<a href="#ref-Abatzoglou2019" role="doc-biblioref">Abatzoglou, Williams, and Barbero 2019</a>)</span>. In France, the Southeast historical region (where wildfire occurrence data have been systematically collected in the ``Prométhée” database since the 1970s) has received a lot of attention in recent years due to the large amount of burnt areas <span class="citation" data-cites="Pimont2021 Opitz2020">(e.g. <a href="#ref-Pimont2021" role="doc-biblioref">Pimont et al. 2021</a>; <a href="#ref-Opitz2020" role="doc-biblioref">Opitz, Bonneu, and Gabriel 2020</a>)</span>. In this study, we consider another French region that draws attention to its wildfire activity and its potential increase under climate change, the Aquitaine region in Southwest France. To better understand the processes driving wildfire activity in this specific region, in particular its sensitivity to weather conditions, and to measure its potential evolution under climate-change, we seek to stochastically model and describe wildfire activities. Statistical modelling of wildfire activity is challenging because occurrence intensities and sizes of wildfires (corresponding to the area burnt by a wildfire) vary in space and time according to meteorological conditions, land cover and human activities, and these predictors may act differently on the probabilities of the ignition of fires (occurrence) and their propagation after ignition has taken place (size).</p>
<p>More specifically, each wildfire can be characterized in space and time, for instance by its location <span class="math inline">\boldsymbol{s}</span> and time <span class="math inline">t</span> of ignition where <span class="math inline">\{\boldsymbol{s}\in\mathcal{S},t\in\mathcal{T}\}</span> would correspond to the space-time study domain. Doing so, wildfire occurrences can be seen as the realization of a spatiotemporal point process, a stochastic model for the occurrences of space-time events. Moreover, each point of this spatiotemporal point process can be associated with a numerical information, such as the burnt area of the corresponding fire. Adding this random quantitative mark, the spatiotemporal pattern of wildfire occurrences and sizes can be viewed as a marked spatiotemporal point process. That is, there exists a random measure <span class="math inline">N</span> that counts the number of points in Borel sets <span class="math inline">B\subset \mathcal{S}\times\mathcal{T}</span> with intensity function <span class="math inline">\Lambda(\boldsymbol{s},t)</span> determining the expected number of points in any set <span class="math inline">B</span>, i.e.&nbsp;<span class="math display">\mathbb{E}\left[N(B)\mid \{\Lambda(\boldsymbol{s},t)\}_{\boldsymbol{s}\in\mathcal{S},t\in\mathcal{T}}\right]=\int_B\Lambda(\boldsymbol{s},t)d(\boldsymbol{s},t).</span> In this study, we will consider such marked spatiotemporal point processes where the occurrences of wildfires are the points of the process and the burnt area the associated marks. But note that other quantitative marks have been considered in the wildfire risk literature, such as the duration of the fire <span class="citation" data-cites="Quinlan2021">(e.g. <a href="#ref-Quinlan2021" role="doc-biblioref">Quinlan, Díaz-Avalos, and Mena 2021</a>)</span>.</p>
<p>In addition, we will assume that <span class="math inline">N</span> conditionally on <span class="math inline">\Lambda</span> is a Poisson point process with intensity function <span class="math inline">\Lambda(\boldsymbol{s},t)</span>, meaning that <span class="math display">N(B)\mid \{\Lambda(\boldsymbol{s},t)\}_{\boldsymbol{s}\in\mathcal{S},t\in\mathcal{T}}\sim \text{Poisson}\left(\int_B\Lambda(\boldsymbol{s},t)d(\boldsymbol{s},t)\right)</span> and for any disjoint Borel sets <span class="math inline">B_1,B_2\subset\mathcal{S}\times\mathcal{T}</span>, <span class="math inline">N(B_1)</span> and <span class="math inline">N(B_2)</span> are independent conditionally on <span class="math inline">\{\Lambda(\boldsymbol{s},t)\}_{\boldsymbol{s}\in\mathcal{S},t\in\mathcal{T}}</span>.</p>
<p>Within a Bayesian modelling framework, it then appears natural to consider log-Gaussian Cox processes <span class="citation" data-cites="moller1998log">(LGCPs, <a href="#ref-moller1998log" role="doc-biblioref">Møller, Syversveen, and Waagepetersen 1998</a>)</span> which are a particular case of Poisson point processes where <span class="math inline">\{\log\Lambda(\boldsymbol{s},t)\}_{\boldsymbol{s}\in\mathcal{S},t\in\mathcal{T}}</span> is assumed to be a Gaussian random field. A Bayesian interpretation of the LGCP is that we consider a log-Gaussian prior process for the intensity function of a Poisson process. LGCPs allow flexible inclusion of covariate information and are useful when points tend to occur in clusters, a behavior that is captured by the stochastic nature of the point process intensity function given by a log-Gaussian process. LGCPs have found numerous applications in risk modelling, especially for wildfires, but also for ecological data <span class="citation" data-cites="Illian2012 Illian2013 Soriano2019">(e.g. <a href="#ref-Illian2012" role="doc-biblioref">Illian, Sørbye, and Rue 2012</a>; <a href="#ref-Illian2013" role="doc-biblioref">Illian et al. 2013</a>; <a href="#ref-Soriano2019" role="doc-biblioref">Soriano-Redondo et al. 2019</a>)</span>.</p>
<p>A fast, accurate and widely used Bayesian inference scheme when dealing with LGCPs is the integrated nested Laplace approximation framework <span class="citation" data-cites="Rue2009 Illian2012">(INLA, <a href="#ref-Rue2009" role="doc-biblioref">Rue, Martino, and Chopin 2009</a>; <a href="#ref-Illian2012" role="doc-biblioref">Illian, Sørbye, and Rue 2012</a>)</span>, which astutely exploits Laplace approximations <span class="citation" data-cites="Tierney1986Laplace">(<a href="#ref-Tierney1986Laplace" role="doc-biblioref">Tierney and Kadane 1986</a>)</span> and has proven to be computationally faster than simulation-based methods such as Markov chain Monte Carlo (MCMC) <span class="citation" data-cites="Taylor2014">(e.g. <a href="#ref-Taylor2014" role="doc-biblioref">Taylor and Diggle 2014</a>)</span>. INLA allows estimating Bayesian hierarchical models and assumes that the latent structure of the model is a Gaussian Markov random field (GMRF), which means that the precision matrix (i.e., the inverse of the variance-covariance matrix) is sparse and therefore allows for fast computations even with high-dimensional Gaussian vectors with up to tens of thousands of latent variables. The stochastic partial differential equation (SPDE) approach is then often combined with INLA (providing the so-called INLA-SPDE approach) in order to approximate Gaussian random fields with Matérn covariance by GMRFs with sparse precision matrix <span class="citation" data-cites="Lindgren2011SPDE">(<a href="#ref-Lindgren2011SPDE" role="doc-biblioref">Lindgren, Rue, and Lindström 2011</a>)</span>.</p>
<p>The INLA-SPDE approach has been intensively applied to wildfires. For instance, <span class="citation" data-cites="pereira2013quantification">Pereira et al. (<a href="#ref-pereira2013quantification" role="doc-biblioref">2013</a>)</span> have considered the occurrences of wildfires over Portugal taking into account specific topographic and land cover covariates, along with the average precipitation prior to the fire season. <span class="citation" data-cites="serra2014spatio">Serra et al. (<a href="#ref-serra2014spatio" role="doc-biblioref">2014</a>)</span> modeled fire occurrences in Catalonia given the potential causes of wildfires by considering a zero-inflated Poisson model. They also took into account topographic variables, the distance to anthropic areas and land uses. Another example is the work of <span class="citation" data-cites="Opitz2020">Opitz, Bonneu, and Gabriel (<a href="#ref-Opitz2020" role="doc-biblioref">2020</a>)</span>, who modeled wildfire occurrences in the Southeastern core area in France by including predictors related to temperature and precipitation, as well as numerous covariates based on land use and land cover.</p>
<p>In the following, we build on the previous study of <span class="citation" data-cites="Pimont2021">Pimont et al. (<a href="#ref-Pimont2021" role="doc-biblioref">2021</a>)</span> but we implement several extensions of their <em>Firelihood</em> model, a marked spatiotemporal log-Gaussian Cox process model for fire activities. Their model was initially applied in the Southeast of France where climatic conditions are sensibly different from the Aquitaine region. Note that to better account for burnt areas of extreme wildfires, <span class="citation" data-cites="Koh2021">Koh et al. (<a href="#ref-Koh2021" role="doc-biblioref">2023</a>)</span> extended the <em>Firelihood</em> model by considering a two-component mixture model for moderate and extreme fire sizes and other improvements that we include in our model. Specifically, we will focus on using the Gamma distribution for fire sizes, which was shown to provide a good fit in the historical Southeast region in <span class="citation" data-cites="Koh2021">Koh et al. (<a href="#ref-Koh2021" role="doc-biblioref">2023</a>)</span> without the need to construct rather complex mixture models. In <a href="#sec-data">Section&nbsp;2</a>, we describe the data used in this study. <a href="#sec-model-inf">Section&nbsp;3</a> presents the structure of our model and its inference using the INLA-SPDE approach. In particular, we detail a subsampling approach for occurrence observations that are zero to keep fully Bayesian inference with INLA-SPDE feasible. Then in <a href="#sec-sim">Section&nbsp;4</a>, we generate wildfire activities over the historical period in order to assess the validity of our methodology. Finally, in <a href="#sec-proj">Section&nbsp;5</a>, we derive future wildfire activities over the Aquitaine region under different climate scenarios.</p>
</section>
<section id="sec-data" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Fire data</h1>
<p>The wildfire data considered in this study are partially provided by the <a href="https://bdiff.agriculture.gouv.fr/">BDIFF</a> database which collects information on wildfires since 2006 on the whole French territory but for which no stochastic models similar to Firelihood have been developed so far. Since BDIFF data are known to show some gaps, they have been completed with those from a public-private network working on territorial risk management (GIP ATGeRi). We extracted data from 2006 to 2020 in the former administrative Aquitaine region, corresponding to four French ``départements” Dordogne, Gironde, Landes and Lot-et-Garonne (see the left display in <a href="#fig-data">Figure&nbsp;1</a>). Due to meteorological factors and specific human activities (agriculture, tourism), winter and summer wildfires correspond to two different fire regimes. Therefore, in this study, we focus on the summer wildfires, which are more numerous and on average also much bigger in terms of size, and we keep only wildfires that have occurred between May to October.</p>
<div id="fig-data" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-bottom">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fire-plot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="computo_figures/map_aquitaine.png" class="img-fluid figure-img" data-ref-parent="fig-data"></p>
<figcaption class="figure-caption">(a) Locations of wildfire activities during 2006-2020 over the region of interest.</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-FWI-plot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="computo_figures/FWI_map.png" class="img-fluid figure-img" data-widht="10%" data-ref-parent="fig-data"></p>
<figcaption class="figure-caption">(b) Spatial footprint of FWI observed on July 4, 2011</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Maps of fire activity during the observation period and spatial variability of the Fire Weather Index (FWI), which is commonly used to aggregate the meteorological fire drivers into a single variable, for a given day.</figcaption><p></p>
</figure>
</div>
<p>The meteorological data used are weather reanalysis data for variables such as temperature, precipitation, humidity and wind speed, provided by Météo France from the SAFRAN model <span class="citation" data-cites="vidal201050">Vidal et al. (<a href="#ref-vidal201050" role="doc-biblioref">2010</a>)</span>. These data are then combined in order to obtain a Fire Weather Index (hereinafter FWI), a unit-less indicator of fire danger. Since the SAFRAN model is defined on a regular grid of 8km resolution, wildfire data are aggregated to the SAFRAN pixels; i.e., for each pixel-day <span class="math inline">B</span>, we calculate the number of wildfire occurrences in <span class="math inline">B</span>; however, we do not aggregate the marks (i.e., the burnt areas) but continue working with the observed burnt area for each of the wildfire occurrences.</p>
<p>In the final dataset, we have for each pixel-day the corresponding daily FWI, the forest area FA (i.e.&nbsp;the fuel surface), the number of fires that are greater than <span class="math inline">0.1</span> hectares NB0.1 (for measurements issues) and the burnt area BA in hectares (see <a href="#tbl-dataset">Table&nbsp;1</a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-dataset" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;1: First lines of the fire dataset.</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">PIX</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">XL2e</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">YL2e</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">DEP</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">YEAR</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">DOY</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">FWI</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">FA</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">NB0.1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">6373</td>
<td style="text-align: right;">476000</td>
<td style="text-align: right;">2081000</td>
<td style="text-align: left;">24</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">227</td>
<td style="text-align: right;">2.7619048</td>
<td style="text-align: right;">2831.982</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">6373</td>
<td style="text-align: right;">476000</td>
<td style="text-align: right;">2081000</td>
<td style="text-align: left;">24</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">225</td>
<td style="text-align: right;">0.8491777</td>
<td style="text-align: right;">2831.982</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6373</td>
<td style="text-align: right;">476000</td>
<td style="text-align: right;">2081000</td>
<td style="text-align: left;">24</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">158</td>
<td style="text-align: right;">6.7485680</td>
<td style="text-align: right;">2831.982</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">6373</td>
<td style="text-align: right;">476000</td>
<td style="text-align: right;">2081000</td>
<td style="text-align: left;">24</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">155</td>
<td style="text-align: right;">3.4603725</td>
<td style="text-align: right;">2831.982</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6373</td>
<td style="text-align: right;">476000</td>
<td style="text-align: right;">2081000</td>
<td style="text-align: left;">24</td>
<td style="text-align: right;">2019</td>
<td style="text-align: right;">229</td>
<td style="text-align: right;">8.2332123</td>
<td style="text-align: right;">2831.982</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">6373</td>
<td style="text-align: right;">476000</td>
<td style="text-align: right;">2081000</td>
<td style="text-align: left;">24</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">154</td>
<td style="text-align: right;">1.8662924</td>
<td style="text-align: right;">2831.982</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section>
<section id="sec-model-inf" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Model and inference</h1>
<section id="subsampling" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="subsampling"><span class="header-section-number">3.1</span> Subsampling</h2>
<p>There are 1308930 observations in the fire dataset, but only 2331 actual wildfires. In order to keep the model manageable for INLA, we subsample observations with count <span class="math inline">0</span>. This approach is similar to <span class="citation" data-cites="Koh2021">Koh et al. (<a href="#ref-Koh2021" role="doc-biblioref">2023</a>)</span> and it does not bias the analysis since we reweight the Poisson intensities estimated in the model to take into account the factor by which we have subsampled. For instance, if we keep on average one in ten zeros when fitting the model, we attribute a ten times larger Poisson intensity to the zeros remaining in the observations used for estimation; this works since Poisson intensity parameters are additive under convolution of Poisson-distributed random variables.</p>
<p>We keep all observations with positive count (corresponding to at least one actual wildfire) since they are the most informative and account only for a small number of observations. For such observations, we put a weight equal to <span class="math inline">1</span>.<br>
Then, among the <span class="math inline">n</span> observations with <span class="math inline">0</span> count, we only keep a number equal to <span class="math inline">n_{ss}</span> and much smaller than <span class="math inline">n</span>, such that the associated weights are then equal to <span class="math inline">n/n_{ss}</span>. However, since wildfires tend to occur most often for large FWI, we further use a stratified approach by sampling with a larger probability weight <span class="math inline">p</span> (i.e., the probability of keeping an observation) observations associated to large FWI values such that the model will be able to appropriately discriminate between wildfire presence (positive count) and absence (zero count) for relatively large FWI values. A large value of FWI is defined as exceeding a given high threshold <span class="math inline">u_q</span> given by a specific <span class="math inline">q</span>-quantile, <span class="math inline">q\in (0,1)</span>. If we denote by <span class="math inline">(w_k)_{1\leq k\leq n_{ss}}</span> the subsampling weights of observation with count <span class="math inline">0</span>, then, for observations with FWI greater than <span class="math inline">u_q</span>, necessarily <span class="math inline">n\mathbb{P}(\text{FWI}\geq u_q)=n_{ss}pw_k</span>, i.e.&nbsp;<span class="math inline">w_k=n(1-q)/(n_{ss}p)</span>. Similarly, for FWI smaller than <span class="math inline">u_q</span>, <span class="math inline">n\mathbb{P}(\text{FWI}&lt; u_q)=n_{ss}(1-p)w_k</span> leading to <span class="math inline">w_k=nq/(n_{ss}(1-p))</span>.</p>
<p>In the following, we choose <span class="math inline">n_{ss}=20000</span>, <span class="math inline">q=0.9</span> and <span class="math inline">p=0.5</span> (i.e.&nbsp;we keep as many observations with large FWI value as with lower FWI value) leading to a data set with dimension manageable by INLA on a personal computer and with computation times around the order of several minutes. Note that <span class="math inline">p</span> and <span class="math inline">q</span> are parameters that can be freely chosen based on the particularities of the data.</p>
</section>
<section id="sec-model" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sec-model"><span class="header-section-number">3.2</span> Model definition</h2>
<p>In the following, the occurrences and fire sizes are considered as realizations of a spatiotemporal marked point process as explained in <a href="#sec-intro">Section&nbsp;1</a>.</p>
<p>To account for the fact that the meteorological covariate FWI considered in this study is provided on a regular grid (see <a href="#sec-data">Section&nbsp;2</a>), we discretize our space-time study domain <span class="math inline">\mathcal{S}\times\mathcal{T}</span> and assume that the intensity of the LGCP <span class="math inline">\Lambda(\boldsymbol{s},t)</span> is constant in each space-time cell <span class="math inline">C_i\in\{1,\dots,M\}</span>, i.e. <span class="math display">\Lambda(\boldsymbol{s},t)\equiv \Lambda_i \text{ if } (\boldsymbol{s},t)\in C_i.</span></p>
<p>We then consider the occurrences. We model the number of fires, denoted <span class="math inline">N_i</span>, in each space-time cell <span class="math inline">C_i\in\{1,\dots,M\}</span>, corresponding to a SAFRAN pixel and a given day of the year. With these assumptions, the data discretized to the pixel grid are still coherent with the LGCP model introduced before, and we represent each pixel by its center coordinate.</p>
<p>In our model, we assume that for each space-time cell <span class="math inline">C_i</span>, the number of fires <span class="math inline">N_i</span> is distributed according to Poisson distribution with a log-link function and a random intensity parameter, described in the following hierarchical structure with the data layer (first line), the latent process layer (second line) and the hyperparameter layer (third line): <span id="eq-inla-occ"><span class="math display">\begin{array}{cc}
N_i \mid \Lambda_i,\boldsymbol{\theta} \sim \text{Poisson}(w_i\Lambda_i) \\
\log\Lambda_i   = \beta_0 + f_\text{YEAR}(\text{YEAR}_i)+f_\text{DOY}(\text{DOY}_i)+ f_\text{FWI}(\text{FWI}_i) + f_\text{FA}(\text{FA}_i) + f_\text{Spatial}(A_i)   \\
\boldsymbol{\theta} = \left(\boldsymbol{\theta}^{\text{YEAR,size}},\boldsymbol{\theta}^\text{DOY},\boldsymbol{\theta}^\text{FWI}  , \boldsymbol{\theta}^\text{FA},\boldsymbol{\theta}^\text{Spatial}\right) \sim  \text{Hyperpriors}
\end{array} \tag{1}</span></span></p>
<p>The random 1-dimensional functional effects <span class="math inline">f_{\{\text{ FWI,DOY, FA}\}}</span> are defined through quadratic splines, for which SPDE prior models are available, and <span class="math inline">f_\text{Spatial}</span> is a spatial field. Finally, to better capture the yearly variability in the data, we add an iid random effect <span class="math inline">f_\text{YEAR}</span>.</p>
<p>We work in a Bayesian framework, that is we put Gaussian prior distributions on all the random effects. For instance, for the function representing the effect of FWI in the predictor, we set the following prior structure:</p>
<p><span class="math display">\left\{\begin{array}{cc}
f_{\text{FWI}}(\text{FWI}_i) = \sum_{k=1}^{n}\beta_k^\text{FWI} b_k^\text{FWI}(\text{FWI}_i) \\
\boldsymbol{\beta}^\text{FWI} = (\beta_1^\text{FWI},\dots,\beta_n^\text{FWI})^T \sim \mathcal{N}(\mathbf{0},\mathbf{Q}_\text{FWI}^{-1})
\end{array}
\right.</span></p>
<p>where <span class="math inline">(b_k^\text{FWI})_{k\in\{1,\dots,n\}}</span> are spline basis functions. Denoting <span class="math inline">\boldsymbol{B}^\text{FWI}=\left(b_k^\text{FWI}(\text{FWI}_i)\right)_{(1\leq k\leq n,1\leq i\leq M)}</span> the matrix containing the values of the spline basis function at the observed FWI values, and similarly for the other covariates, the linear predictor in <a href="#eq-inla-occ">Equation&nbsp;1</a> can be rewritten as follows</p>
<p><span id="eq-matrices"><span class="math display">\log\boldsymbol{\Lambda} = \left(\log\boldsymbol{\Lambda_1},\dots,\log \boldsymbol{\Lambda_M}\right) = \boldsymbol{1}\beta_0 + \sum\limits_{\text{eff}\in\text{Effects}} \boldsymbol{B}^\text{eff}\boldsymbol{\beta}^\text{eff} \tag{2}</span></span></p>
<p>where <span class="math inline">\text{Effects}</span> contains all the effects considered in the model <a href="#eq-inla-occ">Equation&nbsp;1</a>, i.e.&nbsp;<span class="math inline">\text{Effects}= \{\text{FWI},\text{FA},\text{YEAR},\text{DOY},\text{Spatial}\}</span>. In the decomposition of <a href="#eq-matrices">Equation&nbsp;2</a>, the second term on the right-hand side is decomposed for each effect by a product between the effect (i.e., the coefficients <span class="math inline">\beta^\text{eff}</span> to be estimated) and a projector matrix (i.e., the deterministic matrices <span class="math inline">B^\text{eff}</span> calculated from the spline basis and the covariate values).</p>
<p>To fit this hierarchical model, we use the INLA framework <span class="citation" data-cites="Rue2009">(<a href="#ref-Rue2009" role="doc-biblioref">Rue, Martino, and Chopin 2009</a>)</span>, which leverages an astutely designed deterministic approximation of the posterior distributions, unlike simulation-based methods such as MCMC.</p>
<p>For each component except the yearly effect, a latent Gaussian random field prior is approximated using the stochastic partial differential equations <span class="citation" data-cites="Lindgren2011SPDE">(SPDE, <a href="#ref-Lindgren2011SPDE" role="doc-biblioref">Lindgren, Rue, and Lindström 2011</a>)</span> approach. This approach allows us to approximate a continuous random field by a discrete random field with a finite number of Gaussian variables used as priors for basis function coefficients, where interpolation across continuous space provided is the deterministic basis functions. Shortly, recall that a Gaussian random field <span class="math inline">f(\boldsymbol{s})</span> on <span class="math inline">\mathbb{R}^d</span> can be obtained as the solution to the following SPDE <span id="eq-SPDE"><span class="math display">\left(\kappa^2-\Delta\right)^{\alpha/2}\tau f(\boldsymbol{s})=W(\boldsymbol{s}), \quad \alpha=\nu+d/2, \quad \boldsymbol{s}\in\mathbb{R}^d \tag{3}</span></span> where <span class="math inline">\Delta</span> is the Laplacian operator and <span class="math inline">W(\boldsymbol{s})</span> is a standard Gaussian white noise process. Then the only stationary solution to <a href="#eq-SPDE">Equation&nbsp;3</a> is a Gaussian random field with Matérn covariance function <span class="math display">\text{Cov}\left(f(\boldsymbol{0}),f(\boldsymbol{s})\right)=\sigma^2 2^{1-\nu}\left(\kappa \lVert\boldsymbol{s}\rVert \right)^\nu K_{\nu}\left(\kappa\lVert\boldsymbol{s}\rVert  \right)/\Gamma(\nu)</span> with Euclidean distance <span class="math inline">\lVert\cdot\rVert</span>, Gamma function <span class="math inline">\Gamma</span>, modified Bessel function of the second kind <span class="math inline">K_\nu</span>, and <span class="math inline">\sigma,\nu&gt;0</span>. In practice, we often fix <span class="math inline">\nu=1</span> (as we do here), and then approximate solutions of <a href="#eq-SPDE">Equation&nbsp;3</a>, having a Markov structure, are obtained using a finite element method with a triangulation of the space if <span class="math inline">d=2</span>, or splines if <span class="math inline">d=1</span>. Such solutions are Gaussian Markov random fields with sparse precision matrices, allowing for fast numerical calculations even in high dimension (in terms of the number of basis functions, equal to the dimension of the corresponding latent Gaussian vector).</p>
<p>We then model the associated size components <span class="math inline">\left(S_{i,1},\dots,S_{i,N_i}\right)</span> given that <span class="math inline">N_i&gt;0</span>, considered as the marks of the point process, through a Gamma distribution. As for the occurrence model, we consider the SPDE approach for the physical predictors FA and FWI, and an iid random effect for the year. We also consider an iid random effect for each ``département”, which leads to the following model:</p>
<p><span id="eq-size-model"><span class="math display">\begin{array}{cc}
\left(S_{i,1},\dots,S_{i,N_i}\right) \mid \alpha_i,\boldsymbol{\theta}^\text{size}, (N_i&gt;0) \stackrel{\text{iid}}{\sim} \text{Gamma}(\alpha_i,\phi) \\
\log\alpha_i   = \beta_0  +f_\text{YEAR}^\text{size}(\text{YEAR}_i) +  f_\text{FWI}^\text{size}(\text{FWI}_i)   +f_\text{FA}^\text{size}(\text{FA}_i)+f_\text{Spatial}^\text{size}(\text{DEP}_i) \\
\boldsymbol{\theta^\text{size}} = \left(\boldsymbol{\theta}^{\text{YEAR,size}},\boldsymbol{\theta}^{\text{FWI,size}}  , \boldsymbol{\theta}^{\text{FA,size}}\right) \sim  \text{Hyperpriors}
\end{array} \tag{4}</span></span></p>
<p>Note that with INLA, the parametrization of the Gamma likelihood is given by <span class="math inline">\mathbb{E}(S_{i,k})=\alpha_i</span> and <span class="math inline">Var(S_{i,k})=\alpha_i^2/\phi</span>, for all <span class="math inline">k\in\{1,\dots,N_i\}</span> where <span class="math inline">\phi</span> is a hyperparameter included in the vector <span class="math inline">\boldsymbol{\theta}^{\text{FWI,size}}</span>. The Gamma distribution behaves similarly to a Gaussian distribution when <span class="math inline">\phi</span> is large, whereas its tails become more and more heavy when <span class="math inline">\phi</span> approaches <span class="math inline">0</span>.</p>
</section>
<section id="inla-settings" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="inla-settings"><span class="header-section-number">3.3</span> INLA settings</h2>
<p>For the SPDE-based effects, namely FWI, FA, DOY and Spatial, we construct a Matérn SPDE model with penalized complexity (PC) priors for the hyperparameters of the Matérn field <span class="citation" data-cites="Fuglstad2019">(<a href="#ref-Fuglstad2019" role="doc-biblioref">Fuglstad et al. 2019</a>)</span>. The construction of the SPDE is achieved using the function <span class="math inline">\texttt{inla.spde2.pcmatern()}</span>. We also define the associated projector matrix <span class="math inline">B^\text{eff}</span> with <span class="math inline">\texttt{inla.spde.make.A()}</span>, mapping the projections of the SPDE to the observation points. Then, the function <span class="math inline">\texttt{inla.spde.make.index()}</span> is used to define the indexes of the latent variable for the SPDE model (i.e., an identifier that runs from <span class="math inline">1</span> to the number of basis functions).</p>
<p>The 1-dimensional effects <span class="math inline">f_\text{FWI,FA,DOY}</span> in <a href="#eq-inla-occ">Equation&nbsp;1</a> are defined through quadratic splines with <span class="math inline">5</span> knots for FWI and DOY, and <span class="math inline">6</span> knots for FA. For FWI, we want to extrapolate values as a constant in cases where new covariate values used for prediction are larger than the observed covariate values used for fitting the model, so we impose a Neumann upper-bound condition corresponding to a zero first derivative.</p>
<p>Regarding the spatial effect <span class="math inline">f_\text{Spatial}</span>, the triangulation mesh depicted in <a href="#fig-2d-mesh">Figure&nbsp;2</a> has <span class="math inline">1051</span> nodes. In order to avoid non-stationary effects of the SPDE solution near the boundaries, we define two regions with a lower density of triangulation nodes in the outer region. Based on previous studies <span class="citation" data-cites="Pimont2021">(e.g. <a href="#ref-Pimont2021" role="doc-biblioref">Pimont et al. 2021</a>)</span>, the parameters for the PC priors for the SPDE model (corresponding to exponential prior distributions for the standard deviation and the range parameter) are set using the following conditions: we set a probability of <span class="math inline">50\%</span> to have a standard deviation larger than <span class="math inline">1</span> and a probability of <span class="math inline">5\%</span> to have a spatial range smaller than <span class="math inline">50</span>km.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-2d-mesh" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="submitted-202310-legrand-wildfire_files/figure-html/fig-2d-mesh-1.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Constructed spatial mesh with <span class="math inline">1051</span> nodes. Red dots represent the centers of the SAFRAN pixels for the study area.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="estimation-of-the-occurrence-model" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="estimation-of-the-occurrence-model"><span class="header-section-number">3.4</span> Estimation of the occurrence model</h2>
<p>To perform the model estimation, we gather all the information in a stack, a data format used in the R-INLA package that is appropriate for INLA and contains the data, the projection matrices and the different effects. In the model, we only have one fixed effect, which is the intercept, and five random effects. For the SPDE-based effects we include the indices of their associated SPDE. Then, we define the model formula as in <a href="#eq-inla-occ">Equation&nbsp;1</a>.</p>
<p>We then fit the model calling <span class="math inline">\texttt{inla()}</span> with a number of user-specific settings to control how Laplace approximations are carried out and which posterior quantities are calculated.</p>
<p>We can visualize summaries of the posterior distributions of the random effects. For the SPDE effects, we have to project the effects on a 1-d (or 2-d for the spatial effect) grid that contains the initial mesh. The new projector matrix (i.e., the matrix <span class="math inline">B</span> containing the new values of covariates and evaluated spline bases) is obtained with the function <span class="math inline">\texttt{inla.mesh.projector()}</span>. Results are depicted in <a href="#fig-posterior-mean">Figure&nbsp;3</a>.</p>
<p>From <a href="#fig-posterior-mean">Figure&nbsp;3</a>, we can conclude that the yearly effect captures an inter-annual variability that cannot be described by the physical parameters FWI and FA. Regarding the seasonal effect DOY, we see that it decreases in mid-September, after the high summer heat. Both FWI and Forest area (FA) effects increase almost linearly, which is something that we expect since wildfire activity increases with FWI and the amount of fuel material. Looking at the spatial effect, we can observe a high spatial correlation between the different locations and clear separated clusters highlighting different fire regimes. An interpretation of these results is that FWI and FA are able to explain a substantial part of the spatiotemporal variability in wildfire activity, but that there also remains strong spatiotemporal residual correlation that is captured by the other random effects. Lastly, the magnitude of the effects appears to be smaller for the yearly effect than for the other effects.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-posterior-mean" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="submitted-202310-legrand-wildfire_files/figure-html/fig-posterior-mean-1.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Partial effects of the occurrence model.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="estimation-of-the-size-model" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="estimation-of-the-size-model"><span class="header-section-number">3.5</span> Estimation of the size model</h2>
<p>Similarly to the occurrence model, we use INLA to perform the size model estimation. But prior to that, we need to build the new projection matrices for the SPDE effects defined in <a href="#eq-size-model">Equation&nbsp;4</a> since we will consider hereafter only data such that the burnt area is greater than <span class="math inline">0.1</span>ha. We here perform the estimation of the size model separately from the estimation of the occurrence model, which is possible as long as we do not construct a model where some of the random effects are used in both the occurrence model and the size model, i.e., where there are shared random effects, such as in <span class="citation" data-cites="Koh2021">Koh et al. (<a href="#ref-Koh2021" role="doc-biblioref">2023</a>)</span>. Separate estimation of the two models strongly reduces the overall computational cost for running INLA.</p>
<p>Again, after running the INLA estimation, we can plot the estimated random effects, see <a href="#fig-posterior-mean-size">Figure&nbsp;4</a>. It can be seen that large wildfires tend to be associated with large values of FWI and FA. The spatial effect is almost null except for the north-east region for which we have a negative effect. Finally, looking at the amplitude of the effects, the FWI has the strongest influence on wildfire sizes.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-posterior-mean-size" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="submitted-202310-legrand-wildfire_files/figure-html/fig-posterior-mean-size-1.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;4: Partial effects of the size model.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-sim" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Wildfire simulations from the posterior distribution for the observation period (2006-2020)</h1>
<p>Before applying the fitted model to climate projections, we wish to assess the validity of our model. We here focus on the capacity of the model to reproduce the observed wildfires during the study period (2006-2020) with appropriate posterior uncertainty. R-INLA implements a method to obtain independent samples from the posterior distributions of hyperparameters and latent Gaussian variables, which can then be combined with new covariate data to calculate Monte-Carlo estimations of any posterior quantity of interest.</p>
<section id="occurrence-component" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="occurrence-component"><span class="header-section-number">4.1</span> Occurrence component</h2>
<p>For the occurrence model, we first have to sample from the posterior distribution of all the coefficients in the occurrence model and then combine them with new effect values, using the additivity of <a href="#eq-matrices">Equation&nbsp;2</a>.</p>
<p>Hereinafter, we perform <span class="math inline">n=100</span> simulations and results are depicted in <a href="#fig-res-occ">Figure&nbsp;5</a>. The top line panels depict the spatial patterns of observed and simulated fire occurrences. In the bottom line, the yearly aggregated occurrences are shown on the left. Then, we looked for a specific year the daily and weekly aggregation (middle and right panels) of simulated fire occurrences. We chose to examine the year <span class="math inline">2010</span>, but any other year could have been considered.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-res-occ" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="submitted-202310-legrand-wildfire_files/figure-html/fig-res-occ-1.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;5: top: Spatial patterns of observed wildfire occurrences (left) and simulated occurrences (right). bottom: Simulated wildfire occurrences with <span class="math inline">95\%</span> pointwise confidence intervals (in red) and observations (black dots).</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-res-occ">Figure&nbsp;5</a> highlights that the model successfully recovers both the spatial and temporal pattern of fire occurrences. Almost all observations are within the uncertainty bands of the posterior model. The temporal aggregations also highlights the temporal trends and stochasticity of wildfire regimes, with for instance a stronger fire activity at the end of August.</p>
</section>
<section id="sec-sim-sizes" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="sec-sim-sizes"><span class="header-section-number">4.2</span> Size component</h2>
<p>As for the occurrence model, we illustrate the applicability of our model through simulations and compare the simulated sizes with the historical data (see <a href="#fig-res-sizes">Figure&nbsp;6</a>). The simulation scheme is as follows: for each of the <span class="math inline">100</span> previously simulated samples of fire occurrences, we generate the associated sizes by sampling the posterior distributions of the fitted size model effects and use the additivity of the linear predictor as defined in <a href="#eq-size-model">Equation&nbsp;4</a>.</p>
<p>Simulations are presented in <a href="#fig-res-sizes">Figure&nbsp;6</a>. Again, the spatial aggregation is shown in the top line panels. The yearly aggregated burnt areas are depicted in the bottom-left panel. Finally, the middle and right panels in the bottom line depict the weekly aggregated occurrences of fires greater than <span class="math inline">1</span> ha and <span class="math inline">10</span> ha respectively.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-res-sizes" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="submitted-202310-legrand-wildfire_files/figure-html/fig-res-sizes-1.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;6: top: Spatial patterns of observed wildfire sizes (left) and simulated sizes (right). bottom: Simulated wildfire sizes with <span class="math inline">95\%</span> pointwise confidence intervals (in red) and observations (black dots).</figcaption>
</figure>
</div>
</div>
</div>
<p>The size simulations depicted in <a href="#fig-res-sizes">Figure&nbsp;6</a> show that the model successfully recovers the spatial pattern but misses some of the the most extreme values in terms of coverage of pointwise credible intervals. Unlike the fire occurrences, the distribution of burnt areas is heavy-tailed and more difficult to predict. Still, looking at the temporal aggregation the simulations provide satisfying results and almost all observations are within the uncertainty bands. We note that for the largest fires (i.e.&nbsp;greater than <span class="math inline">10</span> ha), the sample size being much smaller, the uncertainties are larger.</p>
</section>
</section>
<section id="sec-proj" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Future wildfire simulations derived from climate model projections</h1>
<p>We consider hereafter four different climate models under two climate scenarios RCP4.5 and RCP8.5 where the second one is more pessimistic in terms of expected global warming than the first one. The models, together with the institutes having developed them written in parentheses, are as follows: IPSL-CM5A (Institut Pierre-Simon Laplace, France), MPI-ESM (Max Planck Institut für Meteorologie, Germany), HadGEM2 (Met Office Hadley Center, UK) and CNRM (Météo-France, France).</p>
<p>For simulated FWI values in the climate change projections that fall outside the range of historical FWI values, we extrapolate the function <span class="math inline">f_\text{FWI}</span> as a constant. For the forest surface FA in each pixel, we extrapolate the historical values in a constant manner, that is, we use the values available for 2018.</p>
<p>We perform <span class="math inline">n = 20</span> realizations of pixel-day occurrences and generate for each occurrence its associated size. The occurrences and sizes can then be aggregated over various spatial and temporal scales to study the potential evolutions of future wildfire risk. In <a href="#fig-climate-models">Figure&nbsp;7</a>, we depict the results at an annual scale. Interannual variability in simulated counts and sizes remains relatively high, even after averaging the twenty realizations over the whole study area. To smooth the projected curves and identify long-term trends in wildfire activity, we implemented a 1D-SPDE INLA model, given by <a href="#eq-inla-proj">Equation&nbsp;5</a>. The basis representation for the yearly effect is defined through a quadratic spline and we set PC priors for the prior function such that the probability to have a standard deviation larger than <span class="math inline">100</span> is equal to <span class="math inline">0.5</span> and we fix a range value of <span class="math inline">30</span> years. This choice is motivated by the fact that a <span class="math inline">30</span>-year period is often used to calculate averages in climatological studies. Moreover, to assess if there is a general upward trend in the smoothed curve, we include the rescaled year as a linear covariate, i.e., as a fixed effect. The rescaling is constructed such as to interpret the coefficient <span class="math inline">\beta_1</span> as a decadal effect. Therefore, the role of the spline function <span class="math inline">f_\text{YEAR}</span> is to model nonlinear deviations from the general linear trend, <span class="math inline">\beta_0+\beta_1\left(\text{YEAR}_i-2020\right)/10</span>. For the sake of identifiability, we set Dirichlet boundary conditions for the spline function, such that it takes value zero at both boundaries.</p>
<p><span id="eq-inla-proj"><span class="math display">\begin{array}{cc}
Y_i \mid \mu_i,\boldsymbol{\theta}^\text{YEAR} \sim \text{Lognormal}(\mu_i,\sigma) \\
\mu_i   = \beta_0 + \beta_1 \left(\text{YEAR}_i-2020\right)/10 + f_\text{YEAR}(\text{YEAR}_i) \\
\boldsymbol{\theta}^\text{YEAR} \sim  \text{Hyperprior}
\end{array} \tag{5}</span></span></p>
<p>Since the posterior sampling from the fitted model takes a lot of memory to run, we have stored the results beforehand.</p>
<div id="fig-climate-models" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="computo_figures/plot_smooth_1.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="computo_figures/plot_smooth_2.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="computo_figures/plot_smooth_3.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="computo_figures/plot_smooth_4.png" class="img-fluid figure-img"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="computo_figures/plot_smooth_size_1.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="computo_figures/plot_smooth_size_2.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="computo_figures/plot_smooth_size_3.png" class="img-fluid figure-img"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 25.0%;justify-content: center;">
<p><img src="computo_figures/plot_smooth_size_4.png" class="img-fluid figure-img"></p>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;7: Annual means of wildfire occurrences (top-line) and sizes (bottom-line) for the four climate models and the two emission scenarios (RCP4.5 in black, RCP8.5 in red). Dots represent annual averages calculated over twenty samples from the full posterior model, continuous curves report the posterior mean fit of the INLA model used to smooth curves, and dashed lines indicate the corresponding <span class="math inline">95\%</span> credible intervals.</figcaption><p></p>
</figure>
</div>
<p>Looking at <a href="#fig-climate-models">Figure&nbsp;7</a>, the four climate models provide substantially different results. The IPSL-CM5A and CNRM show no significant trend either for occurrences or for sizes under both scenarios. Among the two other models, MPI-ESM shows a clearer trend: by 2100, the number of wildfire occurrences can be expected to double on average under the most pessimistic emission scenario. The associated wildfire sizes are also increasing, going from <span class="math inline">500</span> ha in 2020 to up to <span class="math inline">1500</span> ha by the end of the century. This evolution can be better measured by looking at the posterior distribution of the decadal linear effect defined in <a href="#eq-inla-proj">Equation&nbsp;5</a>. Summary statistics for <span class="math inline">\beta_1</span> are reported in the Appendix. Under the RCP8.5 scenario, the HadGEM-RCA4 and MPI-ESM models lead to significantly positive <span class="math inline">\beta_1</span> estimates since their <span class="math inline">95\%</span> credible intervals do not contain zero.</p>
<p>To capture potential spatial variability of projected wildfire activities, we also considered the spatial aggregation of the simulated occurrences and sizes during the end of the projection period (2070–2100), results are depicted in <a href="#fig-climate-models-map">Figure&nbsp;8</a>.</p>
<div id="fig-climate-models-map" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-occ-proj" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="computo_figures/map_occ_proj_2.png" class="img-fluid figure-img" data-ref-parent="fig-climate-models-map"></p>
<figcaption class="figure-caption">(a) Projected wildfire occurrences</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-size-proj" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="computo_figures/map_size_proj_2.png" class="img-fluid figure-img" data-ref-parent="fig-climate-models-map"></p>
<figcaption class="figure-caption">(b) Projected burnt area</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;8: Spatial patterns of wildfire activity during the end of the projection period (2070–2100) for each climate models and associated climate scenarios. Values correspond to the mean values over the period and are compared to the mean values during the observation period (2006-2020) displayed on the left-hand side.</figcaption><p></p>
</figure>
</div>
<p>From <a href="#fig-occ-proj">Figure&nbsp;8 (a)</a>, it can be seen that the spatial pattern of fire occurrences will remain essentially the same, but the intensities within each pixel may change. Under the scenario RCP <span class="math inline">4.5</span> most models show no strong significant increasing trend. However, under the pessimistic scenario RCP <span class="math inline">8.5</span>, MPI-ESM model seems to predict a substantial increase in fire activities. To a lesser extent, a similar observation can be made for models CNRM and HadGEM2.</p>
<p>Looking at the projected burnt areas <a href="#fig-size-proj">Figure&nbsp;8 (b)</a>, similarly to the simulations performed over the observation period in <a href="#sec-sim-sizes">Section&nbsp;4.2</a>, predictions are quite noisy which we attribute to the fact that burnt areas are relatively heavy-tailed, such that a relatively small number of values can have a relatively strong influence on the calculation of the mean. But again, under the scenario RCP <span class="math inline">8.5</span>, MPI-ESM model shows a significant increase in the average annual fire size compared to the observation period.</p>
<p>These experiments seem to indicate that for the Aquitaine region the climate-related vulnerability of forests to wildfires could increase to a lesser extent in the future than in the historical core wildfire area in the Southeastern France.</p>
</section>
<section id="discussion" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Discussion</h1>
<p>A first remark should be made concerning the most recent wildfire events: as the 2022 weather data are not yet available, the 2022 summer fire season was not considered in this study. Therefore, the projections obtained above do not take into account the relatively extreme fire activities with several very large fires that have been observed in the Western part of France during this period, and the resulting projections could potentially have been more pessimistic in terms of the future increase of wildfire risk in the study region. The results we obtain point towards an increase in future wildfire risk. However, the uncertainty about the future climate remains large and propagates through to projected wildfire risk. Indeed, the weather simulations of the four climate models considered here lead to clearly significant increases only in some cases for rather pessimistic scenarios of greenhouse gas emissions.</p>
<p>This work presented a step-by-step methodology for the modelling of spatiotemporal marked point processes, that has been applied to the modelling of wildfire activities in the Southwest region of France. Due to the high stochasticity involved in wildfire activity but also in climate-change projections, and due to the complex processes and data that have to be modeled, Bayesian hierarchical modeling provides an appropriate framework for including various observed predictors and random effects into a model that allows for accurate predictions with precise uncertainty assessment. Our model includes additive random effects for various components of the linear predictors, such as nonlinear effects of continuous covariates, spatial random effects and temporal random effects. The SPDE approach provides flexible Gaussian prior distributions for such effects with two hyperparameters for the variance and the correlation range, and the INLA method allows for fast and reliable Bayesian inference even with complex and high-dimensional structures of the latent linear predictor and the likelihood model of the data.</p>
<p>In addition, we also presented how INLA can be used to smooth relatively noisy simulations of projected time series of risk occurrences, here based on combining posterior simulations of model parameters with new weather-related covariates obtained from climate model output. Our smoothing approach based on a Bayesian hierarchical model is an attractive statistical alternative to the classical filtering approaches from signal processing, since it can lead to more interpretable results while at the same time providing uncertainty envelopes.</p>
<p>We want to emphasize that our modeling approach for spatiotemporal marked point processes can also be used in other contexts. In ecology, for example, researchers are interested in modelling the distribution of species in space and time over a given study area: the occurrences of the spatio-temporal process could be the observation locations, and the marks could refer to certain characteristics (traits) of the observed individuals. In particular, we plan to construct INLA-SPDE models similar to the one presented here to project how species distributions evolve in response to present and future climatic change <span class="citation" data-cites="Guillot2022 Laxton2023">(see e.g. <a href="#ref-Guillot2022" role="doc-biblioref">Guillot et al. 2022</a>; <a href="#ref-Laxton2023" role="doc-biblioref">Laxton et al. 2023</a>)</span>.</p>
</section>
<section id="appendix" class="level1 unnumbered">
<h1 class="unnumbered">Appendix</h1>
<p>Estimates of <span class="math inline">\beta_1</span> as defined in <a href="#eq-inla-proj">Equation&nbsp;5</a> are depicted in the folowing table, highlighting for which climate model there is a positive trend in wildfire activities (in red).</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Estimated slopes of the linear predictor defined in Eq. (5) for each climate model </caption>
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide; border-bottom: hidden;"></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Occurrence
</div></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Size
</div></th>
</tr>
<tr class="odd">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">0.025quant</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">0.975quant</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">0.025quant</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">0.975quant</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">IPSL_CM5A_WRF331F 4.5</td>
<td style="text-align: right;">-0.013</td>
<td style="text-align: right;">-0.073</td>
<td style="text-align: right;">0.039</td>
<td style="text-align: right;">-0.029</td>
<td style="text-align: right;">-0.132</td>
<td style="text-align: right;">0.061</td>
</tr>
<tr class="even">
<td style="text-align: left;">IPSL_CM5A_WRF331F 8.5</td>
<td style="text-align: right;">-0.003</td>
<td style="text-align: right;">-0.077</td>
<td style="text-align: right;">0.055</td>
<td style="text-align: right;">-0.007</td>
<td style="text-align: right;">-0.137</td>
<td style="text-align: right;">0.090</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MPI_ESM_RCA4 4.5</td>
<td style="text-align: right;">0.020</td>
<td style="text-align: right;">-0.020</td>
<td style="text-align: right;">0.061</td>
<td style="text-align: right;">0.029</td>
<td style="text-align: right;">-0.037</td>
<td style="text-align: right;">0.096</td>
</tr>
<tr class="even">
<td style="text-align: left; color: red !important;">MPI_ESM_RCA4 8.5</td>
<td style="text-align: right; color: red !important;">0.094</td>
<td style="text-align: right; color: red !important;">0.033</td>
<td style="text-align: right; color: red !important;">0.133</td>
<td style="text-align: right; color: red !important;">0.164</td>
<td style="text-align: right; color: red !important;">0.069</td>
<td style="text-align: right; color: red !important;">0.228</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HadGEM_RCA4 4.5</td>
<td style="text-align: right;">0.037</td>
<td style="text-align: right;">-0.008</td>
<td style="text-align: right;">0.082</td>
<td style="text-align: right;">0.052</td>
<td style="text-align: right;">-0.021</td>
<td style="text-align: right;">0.124</td>
</tr>
<tr class="even">
<td style="text-align: left; color: red !important;">HadGEM_RCA4 8.5</td>
<td style="text-align: right; color: red !important;">0.064</td>
<td style="text-align: right; color: red !important;">0.030</td>
<td style="text-align: right; color: red !important;">0.098</td>
<td style="text-align: right; color: red !important;">0.101</td>
<td style="text-align: right; color: red !important;">0.042</td>
<td style="text-align: right; color: red !important;">0.157</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CNRM_RCA4 4.5</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">-0.053</td>
<td style="text-align: right;">0.058</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">-0.105</td>
<td style="text-align: right;">0.100</td>
</tr>
<tr class="even">
<td style="text-align: left;">CNRM_RCA4 8.5</td>
<td style="text-align: right;">0.027</td>
<td style="text-align: right;">-0.014</td>
<td style="text-align: right;">0.077</td>
<td style="text-align: right;">0.046</td>
<td style="text-align: right;">-0.025</td>
<td style="text-align: right;">0.131</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="ackowledgments" class="level1 unnumbered">
<h1 class="unnumbered">Ackowledgments</h1>
<p>The authors are grateful to Météo-France for making the SAFRAN data available.</p>
</section>
<section id="supplementary-materials" class="level1 unnumbered">
<h1 class="unnumbered">Supplementary materials</h1>
<p>All data used in this study are available at the following link: <a href="https://doi.org/10.5281/zenodo.7870592">https://doi.org/10.5281/zenodo.7870592</a>. Note that for confidentiality reasons, the fire data provided correspond to simulated data from the model developed in this work.</p>
<p>The R codes are available on GitHub: <a href="https://github.com/jlegrand35/wildfire_activities">https://github.com/jlegrand35/wildfire_activities</a></p>
</section>
<section id="references" class="level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-Abatzoglou2019" class="csl-entry" role="listitem">
Abatzoglou, John T., A. Park Williams, and Renaud Barbero. 2019. <span>“Global Emergence of Anthropogenic Climate Change in Fire Weather Indices.”</span> <em>Geophysical Research Letters</em> 46 (1): 326–36. https://doi.org/<a href="https://doi.org/10.1029/2018GL080959">https://doi.org/10.1029/2018GL080959</a>.
</div>
<div id="ref-Fuglstad2019" class="csl-entry" role="listitem">
Fuglstad, Geir-Arne, Daniel Simpson, Finn Lindgren, and Håvard Rue. 2019. <span>“Constructing Priors That Penalize the Complexity of Gaussian Random Fields.”</span> <em>Journal of the American Statistical Association</em> 114 (525): 445–52. <a href="https://doi.org/10.1080/01621459.2017.1415907">https://doi.org/10.1080/01621459.2017.1415907</a>.
</div>
<div id="ref-Guillot2022" class="csl-entry" role="listitem">
Guillot, Gilles, Ali Arab, Janine Bärbel Illian, and Stéphane Dray. 2022. <span>“Editorial: Advances in Statistical Ecology: New Methods and Software.”</span> <em>Frontiers in Ecology and Evolution</em> 9. <a href="https://doi.org/10.3389/fevo.2021.828919">https://doi.org/10.3389/fevo.2021.828919</a>.
</div>
<div id="ref-Illian2013" class="csl-entry" role="listitem">
Illian, Janine B., Sara Martino, Sigrunn H. Sørbye, Juan B. Gallego-Fernández, María Zunzunegui, M. Paz Esquivias, and Justin M. J. Travis. 2013. <span>“Fitting Complex Ecological Point Process Models with Integrated Nested Laplace Approximation.”</span> <em>Methods in Ecology and Evolution</em> 4 (4): 305–15. https://doi.org/<a href="https://doi.org/10.1111/2041-210x.12017">https://doi.org/10.1111/2041-210x.12017</a>.
</div>
<div id="ref-Illian2012" class="csl-entry" role="listitem">
Illian, Janine B., Sigrunn H. Sørbye, and Håvard Rue. 2012. <span>“<span class="nocase">A toolbox for fitting complex spatial point process models using integrated nested Laplace approximation (INLA)</span>.”</span> <em>The Annals of Applied Statistics</em> 6 (4): 1499–1530. <a href="https://doi.org/10.1214/11-AOAS530">https://doi.org/10.1214/11-AOAS530</a>.
</div>
<div id="ref-Koh2021" class="csl-entry" role="listitem">
Koh, Jonathan, François Pimont, Jean-Luc Dupuy, and Thomas Opitz. 2023. <span>“<span class="nocase">Spatiotemporal wildfire modeling through point processes with moderate and extreme marks</span>.”</span> <em>The Annals of Applied Statistics</em> 17 (1): 560–82. <a href="https://doi.org/10.1214/22-AOAS1642">https://doi.org/10.1214/22-AOAS1642</a>.
</div>
<div id="ref-Laxton2023" class="csl-entry" role="listitem">
Laxton, Megan R., Óscar Rodríguez de Rivera, Andrea Soriano-Redondo, and Janine B. Illian. 2023. <span>“Balancing Structural Complexity with Ecological Insight in Spatio-Temporal Species Distribution Models.”</span> <em>Methods in Ecology and Evolution</em> 14 (1): 162–72. https://doi.org/<a href="https://doi.org/10.1111/2041-210X.13957">https://doi.org/10.1111/2041-210X.13957</a>.
</div>
<div id="ref-Lindgren2011SPDE" class="csl-entry" role="listitem">
Lindgren, Finn, Håvard Rue, and Johan Lindström. 2011. <span>“An Explicit Link Between Gaussian Fields and Gaussian Markov Random Fields: The Stochastic Partial Differential Equation Approach.”</span> <em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em> 73 (4): 423–98. <a href="https://doi.org/10.1111/j.1467-9868.2011.00777.x">https://doi.org/10.1111/j.1467-9868.2011.00777.x</a>.
</div>
<div id="ref-moller1998log" class="csl-entry" role="listitem">
Møller, Jesper, Anne Randi Syversveen, and Rasmus Plenge Waagepetersen. 1998. <span>“Log Gaussian Cox Processes.”</span> <em>Scandinavian Journal of Statistics</em> 25 (3): 451–82.
</div>
<div id="ref-Opitz2020" class="csl-entry" role="listitem">
Opitz, Thomas, Florent Bonneu, and Edith Gabriel. 2020. <span>“Point-Process Based Bayesian Modeling of Space–Time Structures of Forest Fire Occurrences in Mediterranean France.”</span> <em>Spatial Statistics</em> 40: 100429. <a href="https://doi.org/10.1016/j.spasta.2020.100429">https://doi.org/10.1016/j.spasta.2020.100429</a>.
</div>
<div id="ref-pereira2013quantification" class="csl-entry" role="listitem">
Pereira, Paula, Kamil Feridun Turkman, Maria Antónia Amaral Turkman, Ana Sá, and José MC Pereira. 2013. <span>“Quantification of Annual Wildfire Risk; a Spatio-Temporal Point Process Approach.”</span> <em>Statistica</em> 73 (1): 55–68.
</div>
<div id="ref-Pimont2021" class="csl-entry" role="listitem">
Pimont, François, Héléne Fargeon, Thomas Opitz, Julien Ruffault, Renaud Barbero, Nicolas Martin-StPaul, Eric Rigolot, Miguel Riviere, and Jean-Luc Dupuy. 2021. <span>“Prediction of Regional Wildfire Activity in the Probabilistic Bayesian Framework of Firelihood.”</span> <em>Ecological Applications</em> 31 (5): e02316. <a href="https://doi.org/10.1002/eap.2316">https://doi.org/10.1002/eap.2316</a>.
</div>
<div id="ref-Quinlan2021" class="csl-entry" role="listitem">
Quinlan, José J., Carlos Díaz-Avalos, and Ramsés H. Mena. 2021. <span>“Modeling Wildfires via Marked Spatio-Temporal Poisson Processes.”</span> <em>Environmental and Ecological Statistics</em> 28 (3): 549–65. <a href="https://doi.org/10.1007/s10651-021-00497-1">https://doi.org/10.1007/s10651-021-00497-1</a>.
</div>
<div id="ref-Riviere2022" class="csl-entry" role="listitem">
Riviere, M., F. Pimont, P. Delacote, S. Caurla, J. Ruffault, A. Lobianco, T. Opitz, and J. L. Dupuy. 2022. <span>“A Bioeconomic Projection of Climate-Induced Wildfire Risk in the Forest Sector.”</span> <em>Earth’s Future</em> 10 (4): e2021EF002433. https://doi.org/<a href="https://doi.org/10.1029/2021EF002433">https://doi.org/10.1029/2021EF002433</a>.
</div>
<div id="ref-Rue2009" class="csl-entry" role="listitem">
Rue, Håvard, Sara Martino, and Nicolas Chopin. 2009. <span>“Approximate Bayesian Inference for Latent Gaussian Models by Using Integrated Nested Laplace Approximations.”</span> <em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em> 71 (2): 319–92. <a href="https://doi.org/10.1111/j.1467-9868.2008.00700.x">https://doi.org/10.1111/j.1467-9868.2008.00700.x</a>.
</div>
<div id="ref-serra2014spatio" class="csl-entry" role="listitem">
Serra, Laura, Marc Saez, Jorge Mateu, Diego Varga, Pablo Juan, Carlos Diaz-Ávalos, and Håvard Rue. 2014. <span>“Spatio-Temporal Log-Gaussian Cox Processes for Modelling Wildfire Occurrence: The Case of Catalonia, 1994–2008.”</span> <em>Environmental and Ecological Statistics</em> 21: 531–63.
</div>
<div id="ref-Soriano2019" class="csl-entry" role="listitem">
Soriano-Redondo, Andrea, Charlotte M. Jones-Todd, Stuart Bearhop, Geoff M. Hilton, Leigh Lock, Andrew Stanbury, Stephen C. Votier, and Janine B. Illian. 2019. <span>“Understanding Species Distribution in Dynamic Populations: A New Approach Using Spatio-Temporal Point Process Models.”</span> <em>Ecography</em> 42 (6): 1092–102. https://doi.org/<a href="https://doi.org/10.1111/ecog.03771">https://doi.org/10.1111/ecog.03771</a>.
</div>
<div id="ref-Taylor2014" class="csl-entry" role="listitem">
Taylor, Benjamin M., and Peter J. Diggle. 2014. <span>“INLA or MCMC? A Tutorial and Comparative Evaluation for Spatial Prediction in Log-Gaussian Cox Processes.”</span> <em>Journal of Statistical Computation and Simulation</em> 84 (10): 2266–84. <a href="https://doi.org/10.1080/00949655.2013.788653">https://doi.org/10.1080/00949655.2013.788653</a>.
</div>
<div id="ref-Tierney1986Laplace" class="csl-entry" role="listitem">
Tierney, Luke, and Joseph B. Kadane. 1986. <span>“Accurate Approximations for Posterior Moments and Marginal Densities.”</span> <em>Journal of the American Statistical Association</em> 81 (393): 82–86. <a href="https://doi.org/10.1080/01621459.1986.10478240">https://doi.org/10.1080/01621459.1986.10478240</a>.
</div>
<div id="ref-vidal201050" class="csl-entry" role="listitem">
Vidal, Jean-Philippe, Eric Martin, Laurent Franchistéguy, Martine Baillon, and Jean-Michel Soubeyroux. 2010. <span>“A 50-Year High-Resolution Atmospheric Reanalysis over France with the Safran System.”</span> <em>International Journal of Climatology</em> 30 (11): 1627–44.
</div>
</div>
</section>


<div id="quarto-appendix" class="default"><section id="session-information" class="level1 appendix unnumbered"><h2 class="anchored quarto-appendix-heading">Session information</h2><div class="quarto-appendix-contents">

<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.2.3 (2023-03-15)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 22.04.2 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.10.0
LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.10.0

locale:
 [1] LC_CTYPE=fr_FR.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=fr_FR.UTF-8        LC_COLLATE=fr_FR.UTF-8    
 [5] LC_MONETARY=fr_FR.UTF-8    LC_MESSAGES=fr_FR.UTF-8   
 [7] LC_PAPER=fr_FR.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=fr_FR.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] parallel  stats4    stats     graphics  grDevices utils     datasets 
[8] methods   base     

other attached packages:
 [1] kableExtra_1.3.4  knitr_1.42        INLA_22.05.07     foreach_1.5.2    
 [5] Matrix_1.5-1      spdep_1.2-8       sf_1.0-12         spData_2.2.2     
 [9] dplyr_1.1.1       gridExtra_2.3     ggplot2_3.4.2     stringr_1.5.0    
[13] evd_2.3-6.1       fields_14.1       viridis_0.6.2     viridisLite_0.4.0
[17] spam_2.9-1        splancs_2.01-43   sn_2.1.1          sp_1.4-6         

loaded via a namespace (and not attached):
 [1] httr_1.4.5          maps_3.4.0          jsonlite_1.8.4     
 [4] splines_4.2.3       dotCall64_1.0-2     highr_0.9          
 [7] yaml_2.3.7          numDeriv_2016.8-1.1 pillar_1.9.0       
[10] lattice_0.20-45     glue_1.6.2          digest_0.6.31      
[13] rvest_1.0.3         colorspace_2.0-2    htmltools_0.5.5    
[16] pkgconfig_2.0.3     s2_1.1.2            webshot_0.5.4      
[19] scales_1.2.1        svglite_2.1.0       MatrixModels_0.5-0 
[22] tibble_3.2.1        proxy_0.4-26        farver_2.1.0       
[25] generics_0.1.2      withr_2.5.0         cli_3.6.1          
[28] mnormt_2.1.1        magrittr_2.0.3      deldir_1.0-6       
[31] evaluate_0.20       fansi_1.0.4         xml2_1.3.3         
[34] class_7.3-21        tools_4.2.3         lifecycle_1.0.3    
[37] munsell_0.5.0       compiler_4.2.3      e1071_1.7-9        
[40] systemfonts_1.0.4   rlang_1.1.0         classInt_0.4-3     
[43] units_0.8-0         grid_4.2.3          iterators_1.0.14   
[46] rstudioapi_0.14     htmlwidgets_1.5.4   labeling_0.4.2     
[49] rmarkdown_2.21      boot_1.3-28         wk_0.6.0           
[52] gtable_0.3.0        codetools_0.2-19    DBI_1.1.2          
[55] R6_2.5.1            rgdal_1.5-28        fastmap_1.1.0      
[58] utf8_1.2.3          KernSmooth_2.23-20  stringi_1.7.12     
[61] Rcpp_1.0.10         vctrs_0.6.2         tidyselect_1.2.0   
[64] xfun_0.38          </code></pre>
</div>
</div>
<!-- -->

</div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@article{legrand2023,
  author = {Legrand, Juliette and Pimont, François and Dupuy, Jean-Luc
    and Opitz, Thomas},
  title = {Bayesian Spatiotemporal Modelling of Wildfire Occurrences and
    Sizes for Projections Under Climate Change},
  journal = {Computo},
  date = {2023-10-31},
  url = {https://computo.sfds.asso.fr/},
  doi = {xxxx},
  langid = {en},
  abstract = {Appropriate spatiotemporal modelling of wildfire activity
    is crucial for its prediction and risk management. Here, we focus on
    wildfire risk in the Aquitaine region in the Southwest of France and
    its projection under climate change. We study whether wildfire risk
    could further increase under climate change in this specific region,
    which does not lie in the historical core area of wildfires in
    Southeastern France, corresponding to the Southeast. For this
    purpose, we consider a marked spatiotemporal point process, a
    flexible model for occurrences and magnitudes of such environmental
    risks, where the magnitudes are defined as the burnt areas. The
    model is first calibrated using 14 years of past observation data of
    wildfire occurrences and weather variables, and then applied for
    projection of climate-change impacts using simulations of numerical
    climate models until 2100 as new inputs. We work within the
    framework of a spatiotemporal Bayesian hierarchical model, and we
    present the workflow of its implementation for a large dataset at
    daily resolution for 8km-pixels using the INLA-SPDE approach. The
    assessment of the posterior distributions shows a satisfactory fit
    of the model for the observation period. We stochastically simulate
    projections of future wildfire activity by combining climate model
    output with posterior simulations of model parameters. Depending on
    climate models, spline-smoothed projections indicate low to moderate
    increase of wildfire activity under climate change. The increase is
    weaker than in the historical core area, which we attribute to
    different weather conditions (oceanic versus Mediterranean). Besides
    providing a relevant case study of environmental risk modelling,
    this paper is also intended to provide a full workflow for
    implementing the Bayesian estimation of marked log-Gaussian Cox
    processes using the R-INLA package of the R statistical software.}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-legrand2023" class="csl-entry quarto-appendix-citeas" role="listitem">
Legrand, Juliette, François Pimont, Jean-Luc Dupuy, and Thomas Opitz.
2023. <span>“Bayesian Spatiotemporal Modelling of Wildfire Occurrences
and Sizes for Projections Under Climate Change.”</span>
<em>Computo</em>, October. <a href="https://doi.org/xxxx">https://doi.org/xxxx</a>.
</div></div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb2" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Bayesian spatiotemporal modelling of wildfire occurrences and sizes for projections under climate change"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "A step-by-step marked point process approach using INLA-SPDE"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Juliette Legrand</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">    corresponding: true</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">    email: juliette.legrand@univ-brest.fr</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Biostatistics and Spatial Processes, INRAE, Avignon, France</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation-url: https://biosp.mathnum.inrae.fr/</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: François Pimont</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Ecologie des Forêts Méditerranéennes (URFM), INRAE, Avignon, France</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation-url: https://www6.paca.inrae.fr/ecologie_des_forets_mediterraneennes/Les-personnes/Personnels-permanents/DUPUY-Jean-Luc</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Jean-Luc Dupuy</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://biosp.mathnum.inrae.fr/homepage-thomas-opitz</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Ecologie des Forêts Méditerranéennes (URFM), INRAE, Avignon, France</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Thomas Opitz</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://biosp.mathnum.inrae.fr/homepage-thomas-opitz</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Biostatistics and Spatial Processes, INRAE, Avignon, France</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation-url: https://biosp.mathnum.inrae.fr/</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> last-modified</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="an">abstract:</span><span class="co"> &gt;+</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">   Appropriate spatiotemporal modelling of wildfire activity is crucial for its prediction and risk management. Here, we focus on wildfire risk in the Aquitaine region in the Southwest of France and its projection under climate change. We study whether wildfire risk could further increase under climate change in this specific region, which does not lie in the historical core area of wildfires in Southeastern France, corresponding to the Southeast. For this purpose, we consider a marked spatiotemporal point process, a flexible model for occurrences and magnitudes of such environmental risks, where the magnitudes are defined as the burnt areas. The model is first calibrated using 14 years of past observation data of wildfire occurrences and weather variables, and then applied for projection of climate-change impacts using simulations of numerical climate models until 2100 as new inputs. We work within the framework of a spatiotemporal Bayesian hierarchical model, and we present the workflow of its implementation for a large dataset at daily resolution for 8km-pixels using the INLA-SPDE approach. The assessment of the posterior distributions shows a satisfactory fit of the model for the observation period. We stochastically simulate projections of future wildfire activity by combining climate model output with posterior simulations of model parameters. Depending on climate models, spline-smoothed projections indicate low to moderate increase of wildfire activity under climate change. The increase is weaker than in the historical core area, which we attribute to different weather conditions (oceanic versus Mediterranean). Besides providing a relevant case study of environmental risk modelling, this paper is also intended to provide a full workflow for implementing the Bayesian estimation of marked log-Gaussian Cox processes using the R-INLA package of the R statistical software.</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="an">keywords:</span><span class="co"> [Climate projection, Integrated Nested Laplace Approximation, Marked log-Gaussian Cox process, Spatiotemporal model, SPDE approach, Wildfire]</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co">  type: article-journal</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co">  container-title: "Computo"</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co">  doi: "xxxx"</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co">  url: https://computo.sfds.asso.fr/</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="an">github-user:</span><span class="co"> jlegrand35</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="an">repo:</span><span class="co"> "wildfires_inla"</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="an">draft:</span><span class="co"> true # set to false once the build is running</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="an">published:</span><span class="co"> false # will be set to true once accepted</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="co">  computo-html: default</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co">  computo-pdf: default</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">tidy =</span> <span class="cn">FALSE</span>, <span class="at">fig.width =</span> <span class="dv">8</span>, <span class="at">fig.height =</span> <span class="dv">8</span>, <span class="at">echo =</span> <span class="cn">FALSE</span>, <span class="at">warning =</span> <span class="cn">FALSE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">htmltools.dir.version =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = F}</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"rgdal_show_exportToProj4_warnings"</span><span class="ot">=</span><span class="st">"none"</span>)</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp) </span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sn) </span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splancs) </span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fields)</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(evd)</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(INLA)</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="co"># DATA = "computo_data/"</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>poisson.sim.occ <span class="ot">=</span><span class="cf">function</span>(x,Dat){</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulation of observing at least 1 fire + selection of corresponding events</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>  Dat[<span class="fu">rpois</span>(<span class="fu">length</span>(x), <span class="at">lambda =</span> x)<span class="sc">&gt;</span><span class="dv">0</span>, ]</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction {#sec-intro}</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>As recently experienced in France during summer 2022, wildfires constitute a major threat for the environment and the society. Climate change leads to an increase in societal and economic risks related to wildfires <span class="co">[</span><span class="ot">@Riviere2022</span><span class="co">]</span>, and moreover to an increase in fire-prone regions worldwide <span class="co">[</span><span class="ot">@Abatzoglou2019</span><span class="co">]</span>. In France, the Southeast historical region (where wildfire occurrence data have been systematically collected in the ``Prométhée" database since the 1970s) has received a lot of attention in recent years due to the large amount of burnt areas <span class="co">[</span><span class="ot">e.g. @Pimont2021; @Opitz2020</span><span class="co">]</span>. In this study, we consider another French region that draws attention to its wildfire activity and its potential increase under climate change, the Aquitaine region in Southwest France. To better understand the processes driving wildfire activity in this specific region, in particular its sensitivity to weather conditions, and to measure its potential evolution under climate-change, we seek to stochastically model and describe wildfire activities. Statistical modelling of wildfire activity is challenging because occurrence intensities and sizes of wildfires (corresponding to the area burnt by a wildfire) vary in space and time according to meteorological conditions, land cover and human activities, and these predictors may act differently on the probabilities of the ignition of fires (occurrence) and their propagation after ignition has taken place (size). </span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>More specifically, each wildfire can be characterized in space and time, for instance by its location $\boldsymbol{s}$ and time $t$ of ignition where $<span class="sc">\{</span>\boldsymbol{s}\in\mathcal{S},t\in\mathcal{T}<span class="sc">\}</span>$ would correspond to the space-time study domain. Doing so, wildfire occurrences can be seen as the realization of a spatiotemporal point process, a stochastic model for the occurrences of space-time events. Moreover, each point of this spatiotemporal point process can be associated with a numerical information, such as the burnt area of the corresponding fire. Adding this random quantitative mark, the spatiotemporal pattern of wildfire occurrences and sizes can be viewed as a marked spatiotemporal point process. That is, there exists a random measure $N$ that counts the number of points in Borel sets $B\subset \mathcal{S}\times\mathcal{T}$ with intensity function $\Lambda(\boldsymbol{s},t)$ determining the expected number of points in any set $B$, i.e. $$\mathbb{E}\left<span class="co">[</span><span class="ot">N(B)\mid \{\Lambda(\boldsymbol{s},t)\}_{\boldsymbol{s}\in\mathcal{S},t\in\mathcal{T}}\right</span><span class="co">]</span>=\int_B\Lambda(\boldsymbol{s},t)d(\boldsymbol{s},t).$$</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>In this study, we will consider such marked spatiotemporal point processes where the occurrences of wildfires are the points of the process and the burnt area the associated marks. But note that other quantitative marks have been considered in the wildfire risk literature, such as the duration of the fire <span class="co">[</span><span class="ot">e.g. @Quinlan2021</span><span class="co">]</span>.</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>In addition, we will assume that $N$ conditionally on $\Lambda$  is a Poisson point process with intensity function $\Lambda(\boldsymbol{s},t)$, meaning that $$N(B)\mid <span class="sc">\{</span>\Lambda(\boldsymbol{s},t)<span class="sc">\}</span>_{\boldsymbol{s}\in\mathcal{S},t\in\mathcal{T}}\sim \text{Poisson}\left(\int_B\Lambda(\boldsymbol{s},t)d(\boldsymbol{s},t)\right)$$ and for any disjoint Borel sets $B_1,B_2\subset\mathcal{S}\times\mathcal{T}$, $N(B_1)$ and $N(B_2)$ are independent conditionally on $\{\Lambda(\boldsymbol{s},t)\}_{\boldsymbol{s}\in\mathcal{S},t\in\mathcal{T}}$.</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>Within a Bayesian modelling framework, it then appears natural to consider log-Gaussian Cox processes <span class="co">[</span><span class="ot">LGCPs, @moller1998log</span><span class="co">]</span> which are a particular case of Poisson point processes where $<span class="sc">\{</span>\log\Lambda(\boldsymbol{s},t)<span class="sc">\}</span>_{\boldsymbol{s}\in\mathcal{S},t\in\mathcal{T}}$ is assumed to be a Gaussian random field. A Bayesian interpretation of the LGCP is that we consider a log-Gaussian prior process for the intensity function of a Poisson process. LGCPs allow flexible inclusion of covariate information and are useful when points tend to occur in clusters, a behavior that is captured by the stochastic nature of the point process intensity function given by a log-Gaussian process. LGCPs have found numerous applications in risk modelling, especially for wildfires, but also for ecological data <span class="co">[</span><span class="ot">e.g. @Illian2012; @Illian2013; @Soriano2019</span><span class="co">]</span>.</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>A fast, accurate and widely used Bayesian inference scheme when dealing with LGCPs is the integrated nested Laplace approximation framework <span class="co">[</span><span class="ot">INLA, @Rue2009; @Illian2012</span><span class="co">]</span>, which astutely exploits Laplace approximations <span class="co">[</span><span class="ot">@Tierney1986Laplace</span><span class="co">]</span> and has proven to be computationally faster than simulation-based methods such as Markov chain Monte Carlo (MCMC) <span class="co">[</span><span class="ot">e.g. @Taylor2014</span><span class="co">]</span>.  INLA allows estimating Bayesian hierarchical models and assumes that the latent structure of the model is a Gaussian Markov random field (GMRF), which means that the precision matrix (i.e., the inverse of the variance-covariance matrix) is sparse and therefore allows for fast computations even with high-dimensional Gaussian vectors with up to tens of thousands of latent variables. The stochastic partial differential equation (SPDE) approach is then often combined with INLA (providing the so-called INLA-SPDE approach) in order to approximate Gaussian random fields with Matérn covariance by GMRFs with sparse precision matrix <span class="co">[</span><span class="ot">@Lindgren2011SPDE</span><span class="co">]</span>. </span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>The INLA-SPDE approach has been intensively applied to wildfires. For instance, @pereira2013quantification have considered the occurrences of wildfires over Portugal taking into account specific topographic and land cover covariates, along with the average precipitation prior to the fire season. @serra2014spatio modeled fire occurrences in Catalonia given the potential causes of wildfires by considering a zero-inflated Poisson model. They also took into account  topographic variables, the distance to anthropic areas and land uses. Another example is the work of @Opitz2020, who modeled wildfire occurrences in the Southeastern core area in France by including predictors related to temperature and precipitation, as well as numerous covariates based on land use and land cover.</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>In the following, we build on the previous study of @Pimont2021 but we implement several extensions of their *Firelihood* model, a marked spatiotemporal log-Gaussian Cox process model for fire activities. Their model was initially applied in the Southeast of France where climatic conditions are sensibly different from the Aquitaine region. Note that to better account for burnt areas of extreme wildfires, @Koh2021 extended the *Firelihood* model by considering a two-component mixture model for moderate and extreme fire sizes and other improvements that we include in our model. Specifically, we will focus on using the Gamma distribution for fire sizes, which was shown to provide a good fit in the historical Southeast region in @Koh2021 without the need to construct rather complex mixture models. In @sec-data, we describe the data used in this study. @sec-model-inf presents the structure of our model and its inference using the INLA-SPDE approach. In particular, we detail a subsampling approach for occurrence observations that are zero to keep fully Bayesian inference with INLA-SPDE feasible. Then in @sec-sim, we generate wildfire activities over the historical period in order to assess the validity of our methodology. Finally, in @sec-proj, we derive future wildfire activities over the Aquitaine region under different climate scenarios.</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a><span class="fu"># Fire data {#sec-data}</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>The wildfire data considered in this study are partially provided by the <span class="co">[</span><span class="ot">BDIFF</span><span class="co">](https://bdiff.agriculture.gouv.fr/)</span> database which collects information on wildfires since 2006 on the whole French territory but for which no stochastic models similar to Firelihood have been developed so far. Since BDIFF data are known to show some gaps, they have been completed with those from a public-private network working on territorial risk management (GIP ATGeRi). We extracted data from 2006 to 2020 in the former administrative Aquitaine region, corresponding to four French ``départements" Dordogne, Gironde, Landes and Lot-et-Garonne (see the left display in @fig-data). Due to meteorological factors and specific human activities (agriculture, tourism), winter and summer wildfires correspond to two different fire regimes. Therefore, in this study, we focus on the summer wildfires, which are more numerous and on average also much bigger in terms of size, and we keep only wildfires that have occurred between May to October.</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>::: {#fig-data layout-ncol=2 layout-valign="bottom"}</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a><span class="al">![Locations of wildfire activities during 2006-2020 over the region of interest.](computo_figures/map_aquitaine.png)</span>{#fig-fire-plot width=50%}</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a><span class="al">![Spatial footprint of FWI observed on July 4, 2011 ](computo_figures/FWI_map.png)</span>{#fig-FWI-plot widht=10%}</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>Maps of fire activity during the observation period and spatial variability of the Fire Weather Index (FWI), which is commonly used to aggregate the meteorological fire drivers into a single variable, for a given day.</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = F}</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a><span class="co"># load("DF_Aquitaine.Rdata" ) #with the original data</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">WARNING</span><span class="co">: this has to be changed with the simulated data as follows:</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>temp_file <span class="ot">=</span> <span class="st">"fire_data.zip"</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>(<span class="fu">file.exists</span>(<span class="st">"fire_data.zip"</span>))){</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>  <span class="co">#system("wget https://zenodo.org/record/7870593/files/fire_data.zip")</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>  withr<span class="sc">::</span><span class="fu">with_options</span>(<span class="fu">list</span>(<span class="at">timeout =</span> <span class="dv">1000</span>),  <span class="fu">download.file</span>(<span class="at">url =</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://zenodo.org/record/7870593/files/fire_data.zip"</span>, <span class="at">method =</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>    <span class="st">"auto"</span>, <span class="at">destfile =</span> temp_file))</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">=</span> <span class="fu">unz</span>(temp_file, <span class="st">"DF_Aquitaine_sim.RData"</span>)</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(temp)</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(temp)</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a><span class="co">#SAFRAN coordinates</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">=</span> <span class="fu">unz</span>(temp_file, <span class="st">"Coord_L2E_dep.csv"</span>)</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>coord <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="at">file=</span>temp,<span class="at">sep=</span><span class="st">";"</span>)</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(temp)</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>DF <span class="ot">=</span> DF[(DF<span class="sc">$</span>DOY <span class="sc">&gt;=</span><span class="dv">154</span>) <span class="sc">&amp;</span> (DF<span class="sc">$</span>DOY<span class="sc">&lt;=</span><span class="dv">314</span>),] <span class="co">#Keep only summer fires</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = F}</span></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>DF <span class="ot">=</span> DF[ ,<span class="fu">c</span>(<span class="st">"PIX"</span>,<span class="st">"XL2e"</span>,<span class="st">"YL2e"</span>,<span class="st">"DEP"</span>,<span class="st">"YEAR"</span>,<span class="st">"DOY"</span>,<span class="st">"FWI"</span>,<span class="st">"FA"</span>,<span class="st">"NB0.1"</span>,<span class="st">"BA"</span>)]</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo= F, message =F}</span></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a><span class="co"># To plot the maps with departements</span></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>dep <span class="ot">=</span> <span class="fu">st_read</span>(<span class="st">"map_shp/DEPARTEMENT_CARTO.shp"</span>,<span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>departements <span class="ot">=</span> <span class="fu">st_geometry</span>(dep[(dep<span class="sc">$</span>INSEE_DEP <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"24"</span>, <span class="st">"33"</span>, <span class="st">"40"</span>, <span class="st">"47"</span>)),])</span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>dep.coord <span class="ot">=</span> <span class="fu">st_transform</span>(dep, <span class="at">crs =</span> <span class="dv">27572</span>) <span class="co">#transform coordinates</span></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>dep.coord <span class="ot">=</span> dep.coord[(dep.coord<span class="sc">$</span>INSEE_DEP <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"24"</span>, <span class="st">"33"</span>, <span class="st">"40"</span>, <span class="st">"47"</span>)),] <span class="co">#extract departements</span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>The meteorological data used are weather reanalysis data for variables such as temperature, precipitation, humidity and wind speed, provided by Météo France from the SAFRAN model @vidal201050. These data are then combined in order to obtain a Fire Weather Index (hereinafter FWI), a unit-less indicator of fire danger. Since the SAFRAN model is defined on a regular grid of 8km resolution, wildfire data are aggregated to the SAFRAN pixels; i.e., for each pixel-day $B$, we calculate the number of wildfire occurrences in $B$; however, we do not aggregate the marks (i.e., the burnt areas) but continue working with the observed burnt area for each of the wildfire occurrences.</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>In the final dataset, we have for each pixel-day the corresponding daily FWI, the forest area FA (i.e. the fuel surface), the number of fires that are greater than $0.1$ hectares NB0.1 (for measurements issues) and the burnt area BA in hectares (see @tbl-dataset).</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = F}</span></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-dataset</span></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: First lines of the fire dataset.</span></span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(DF), <span class="at">row.names    =</span>F)</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a><span class="fu"># Model and inference {#sec-model-inf}</span></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a><span class="fu">## Subsampling</span></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>There are <span class="in">`r nrow(DF)`</span> observations in the fire dataset, but only <span class="in">`r sum(DF$NB0.1)`</span> actual wildfires.</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>In order to keep the model manageable for INLA, we subsample observations with count $0$. This approach is similar to @Koh2021 and it does not bias the analysis since we reweight the Poisson intensities estimated in the model to take into account the factor by which we have subsampled. For instance, if we keep on average one in ten zeros when fitting the model, we attribute a ten times larger Poisson intensity to the zeros remaining in the observations used for estimation; this works since Poisson intensity parameters are additive under convolution of Poisson-distributed random variables.</span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>We keep all observations with positive count (corresponding to at least one actual wildfire) since they are the most informative and account only for a small number of observations. For such observations, we put a weight equal to $1$.  </span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>Then, among the $n$ observations with $0$ count, we only keep a number equal to $n_{ss}$ and much smaller than $n$, such that the associated weights are then equal to $n/n_{ss}$. However, since wildfires tend to occur most often for large FWI, we further use a stratified approach by sampling with a larger probability weight $p$ (i.e., the probability of keeping an observation) observations associated to large FWI values such that the model will be able to appropriately discriminate between wildfire presence (positive count) and absence (zero count) for relatively large FWI values. A large value of FWI is defined as exceeding a given high threshold $u_q$ given by a specific $q$-quantile, $q\in (0,1)$. If we denote by $(w_k)_{1\leq k\leq n_{ss}}$ the subsampling weights of observation with count $0$, then, for observations with FWI greater than $u_q$, necessarily</span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>$n\mathbb{P}(\text{FWI}\geq u_q)=n_{ss}pw_k$, i.e. $w_k=n(1-q)/(n_{ss}p)$.  Similarly, for FWI smaller than $u_q$, $n\mathbb{P}(\text{FWI}&lt; u_q)=n_{ss}(1-p)w_k$ leading to $w_k=nq/(n_{ss}(1-p))$.</span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>In the following, we choose $n_{ss}=20000$, $q=0.9$ and $p=0.5$ (i.e. we keep as many observations with large FWI value as with lower FWI value) leading to a data set with dimension manageable by INLA on a personal computer and with computation times around the order of several minutes. Note that $p$ and $q$ are parameters that can be freely chosen based on the particularities of the data.</span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo =F}</span></span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>n_ss <span class="ot">=</span> <span class="dv">20000</span></span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>q_FWI <span class="ot">=</span> <span class="fl">0.9</span></span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>thresh_FWI <span class="ot">=</span> <span class="fu">quantile</span>(DF<span class="sc">$</span>FWI,<span class="at">probs=</span>q_FWI)</span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>ids2subsample <span class="ot">=</span> <span class="fu">which</span>(DF<span class="sc">$</span>NB0<span class="fl">.1</span> <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">length</span>(ids2subsample)</span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>weights_FWI <span class="ot">=</span> <span class="fu">ifelse</span>(DF<span class="sc">$</span>FWI[ids2subsample]<span class="sc">&gt;</span>thresh_FWI,q_FWI,<span class="dv">1</span><span class="sc">-</span>q_FWI)</span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>ids2keep <span class="ot">=</span> <span class="fu">sample</span>(ids2subsample, <span class="at">size =</span> n_ss, <span class="at">prob =</span> weights_FWI)</span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>weights_ss <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">ifelse</span>(DF<span class="sc">$</span>FWI[ids2keep]<span class="sc">&gt;</span>thresh_FWI,((<span class="dv">1</span><span class="sc">-</span>q_FWI)<span class="sc">*</span>n)<span class="sc">/</span>(n_ss<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>                      (q_FWI<span class="sc">*</span>n)<span class="sc">/</span>(n_ss<span class="sc">/</span><span class="dv">2</span>)), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">sum</span>(DF<span class="sc">$</span>NB0<span class="fl">.1</span> <span class="sc">&gt;</span> <span class="dv">0</span>)))</span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>ids2keep <span class="ot">=</span> <span class="fu">c</span>(ids2keep, <span class="fu">which</span>(DF<span class="sc">$</span>NB0<span class="fl">.1</span> <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>DF_sub <span class="ot">=</span> DF[ids2keep,]</span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>DF_sub<span class="sc">$</span>weight_ss <span class="ot">=</span> weights_ss</span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(DF_sub)</span></span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(weights_FWI, ids2subsample, ids2keep)</span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model definition {#sec-model}</span></span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>In the following, the occurrences and fire sizes are considered as realizations of a spatiotemporal marked point process as explained in @sec-intro.</span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>To account for the fact that the meteorological covariate FWI considered in this study is provided on a regular grid (see @sec-data), we discretize our space-time study domain $\mathcal{S}\times\mathcal{T}$ and assume that the intensity of the LGCP $\Lambda(\boldsymbol{s},t)$ is constant in each space-time cell $C_i\in<span class="sc">\{</span>1,\dots,M<span class="sc">\}</span>$, i.e.</span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>$$\Lambda(\boldsymbol{s},t)\equiv \Lambda_i \text{ if } (\boldsymbol{s},t)\in C_i.$$</span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>We then consider the occurrences. We model the number of fires, denoted $N_i$, in each space-time cell $C_i\in<span class="sc">\{</span>1,\dots,M<span class="sc">\}</span>$, corresponding to a SAFRAN pixel and a given day of the year. With these assumptions, the data discretized to the pixel grid are still coherent with the LGCP model introduced before, and we represent each pixel by its center coordinate.</span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>In our model, we assume that for each space-time cell $C_i$, the number of fires $N_i$ is distributed according to Poisson distribution with a log-link function and a random intensity parameter, described in the following hierarchical structure with the data layer (first line), the latent process layer (second line) and the hyperparameter layer (third line):</span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a> $$\begin{array}{cc}</span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>N_i \mid \Lambda_i,\boldsymbol{\theta} \sim \text{Poisson}(w_i\Lambda_i) <span class="sc">\\</span></span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>\log\Lambda_i   = \beta_0 + f_\text{YEAR}(\text{YEAR}_i)+f_\text{DOY}(\text{DOY}_i)+ f_\text{FWI}(\text{FWI}_i) + f_\text{FA}(\text{FA}_i) + f_\text{Spatial}(A_i)   <span class="sc">\\</span></span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a>\boldsymbol{\theta} = \left(\boldsymbol{\theta}^{\text{YEAR,size}},\boldsymbol{\theta}^\text{DOY},\boldsymbol{\theta}^\text{FWI}  , \boldsymbol{\theta}^\text{FA},\boldsymbol{\theta}^\text{Spatial}\right) \sim  \text{Hyperpriors}</span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a>\end{array}$$ {#eq-inla-occ}</span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>The random 1-dimensional functional effects $f_{<span class="sc">\{</span>\text{ FWI,DOY, FA}<span class="sc">\}</span>}$ are defined through quadratic splines, for which SPDE prior models are available, and $f_\text{Spatial}$ is a spatial field. Finally, to better capture the yearly variability in the data, we add an iid random effect $f_\text{YEAR}$.</span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a>We work in a Bayesian framework, that is we put Gaussian prior distributions on all the random effects. For instance, for the function representing the effect of FWI in the predictor, we set the following prior structure:</span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a>$$\left<span class="sc">\{</span>\begin{array}{cc}</span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a>f_{\text{FWI}}(\text{FWI}_i) = \sum_{k=1}^{n}\beta_k^\text{FWI} b_k^\text{FWI}(\text{FWI}_i) <span class="sc">\\</span></span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a>\boldsymbol{\beta}^\text{FWI} = (\beta_1^\text{FWI},\dots,\beta_n^\text{FWI})^T \sim \mathcal{N}(\mathbf{0},\mathbf{Q}_\text{FWI}^{-1})</span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a>\end{array}</span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a>\right.$$</span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a>where $(b_k^\text{FWI})_{k\in<span class="sc">\{</span>1,\dots,n<span class="sc">\}</span>}$ are spline basis functions.</span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a>Denoting $\boldsymbol{B}^\text{FWI}=\left(b_k^\text{FWI}(\text{FWI}_i)\right)_{(1\leq k\leq n,1\leq i\leq M)}$ the matrix containing the values of the spline basis function at the observed FWI values, and similarly for the other covariates, the linear predictor in @eq-inla-occ can be rewritten as follows</span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a>$$\log\boldsymbol{\Lambda} = \left(\log\boldsymbol{\Lambda_1},\dots,\log \boldsymbol{\Lambda_M}\right) = \boldsymbol{1}\beta_0 + \sum\limits_{\text{eff}\in\text{Effects}} \boldsymbol{B}^\text{eff}\boldsymbol{\beta}^\text{eff}$$ {#eq-matrices}</span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a>where $\text{Effects}$ contains all the effects considered in the model @eq-inla-occ, i.e. $\text{Effects}= <span class="sc">\{</span>\text{FWI},\text{FA},\text{YEAR},\text{DOY},\text{Spatial}<span class="sc">\}</span>$. In the decomposition of @eq-matrices, the second term on the right-hand side is decomposed for each effect by a product between the effect  (i.e., the coefficients $\beta^\text{eff}$ to be estimated) and a projector matrix (i.e., the deterministic matrices $B^\text{eff}$ calculated from the spline basis and the covariate values).</span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a>To fit this hierarchical model, we use the INLA framework <span class="co">[</span><span class="ot">@Rue2009</span><span class="co">]</span>, which leverages an astutely designed deterministic approximation of the posterior distributions, unlike simulation-based methods such as MCMC.</span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a>For each component except the yearly effect, a latent Gaussian random field prior is approximated using the stochastic partial differential equations <span class="co">[</span><span class="ot">SPDE, @Lindgren2011SPDE</span><span class="co">]</span> approach. This approach allows us to approximate a continuous random field by a discrete random field with a finite number of Gaussian variables used as priors for basis function coefficients, where interpolation across continuous space provided is the deterministic basis functions. Shortly, recall that a Gaussian random field $f(\boldsymbol{s})$ on $\mathbb{R}^d$ can be obtained as the solution to the following SPDE</span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a>$$\left(\kappa^2-\Delta\right)^{\alpha/2}\tau f(\boldsymbol{s})=W(\boldsymbol{s}), \quad \alpha=\nu+d/2, \quad \boldsymbol{s}\in\mathbb{R}^d$$ {#eq-SPDE}</span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a>where $\Delta$ is the Laplacian operator and $W(\boldsymbol{s})$ is a standard Gaussian white noise process. Then the only stationary solution to @eq-SPDE is a Gaussian random field with Matérn covariance function</span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a>$$\text{Cov}\left(f(\boldsymbol{0}),f(\boldsymbol{s})\right)=\sigma^2 2^{1-\nu}\left(\kappa \lVert\boldsymbol{s}\rVert \right)^\nu K_{\nu}\left(\kappa\lVert\boldsymbol{s}\rVert  \right)/\Gamma(\nu)$$</span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a>with Euclidean distance $\lVert\cdot\rVert$, Gamma function $\Gamma$, modified Bessel function of the second</span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>kind $K_\nu$, and $\sigma,\nu&gt;0$. In practice, we often fix $\nu=1$ (as we do here), and then approximate solutions of @eq-SPDE, having a Markov structure, are obtained using a finite element method with a triangulation of the space if $d=2$, or splines if $d=1$. Such solutions are Gaussian Markov random fields with sparse precision matrices, allowing for fast numerical calculations even in high dimension (in terms of the number of basis functions, equal to the dimension of the corresponding latent Gaussian vector).</span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a>We then model the associated size components $\left(S_{i,1},\dots,S_{i,N_i}\right)$  given that $N_i&gt;0$, considered as the marks of the point process, through a Gamma distribution. As for the occurrence model, we consider the SPDE approach for the physical predictors FA and FWI, and an iid random effect for the year. We also consider an iid random effect for each ``département", which leads to the following model:</span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a>$$\begin{array}{cc}</span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a>\left(S_{i,1},\dots,S_{i,N_i}\right) \mid \alpha_i,\boldsymbol{\theta}^\text{size}, (N_i&gt;0) \stackrel{\text{iid}}{\sim} \text{Gamma}(\alpha_i,\phi) <span class="sc">\\</span></span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a>\log\alpha_i   = \beta_0  +f_\text{YEAR}^\text{size}(\text{YEAR}_i) +  f_\text{FWI}^\text{size}(\text{FWI}_i)   +f_\text{FA}^\text{size}(\text{FA}_i)+f_\text{Spatial}^\text{size}(\text{DEP}_i) <span class="sc">\\</span></span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a>\boldsymbol{\theta^\text{size}} = \left(\boldsymbol{\theta}^{\text{YEAR,size}},\boldsymbol{\theta}^{\text{FWI,size}}  , \boldsymbol{\theta}^{\text{FA,size}}\right) \sim  \text{Hyperpriors}</span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a>\end{array}$${#eq-size-model}</span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a>Note that with INLA, the parametrization of the Gamma likelihood is given by $\mathbb{E}(S_{i,k})=\alpha_i$ and $Var(S_{i,k})=\alpha_i^2/\phi$, for all $k\in<span class="sc">\{</span>1,\dots,N_i<span class="sc">\}</span>$ where $\phi$ is a hyperparameter included in the vector $\boldsymbol{\theta}^{\text{FWI,size}}$. The Gamma distribution behaves similarly to a Gaussian distribution when $\phi$ is large, whereas its tails become more and more heavy when $\phi$ approaches $0$.</span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a><span class="fu">## INLA settings</span></span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a>For the SPDE-based effects, namely FWI, FA, DOY and Spatial, we construct a Matérn SPDE model with penalized complexity (PC) priors for the hyperparameters of the Matérn field <span class="co">[</span><span class="ot">@Fuglstad2019</span><span class="co">]</span>. The construction of the SPDE is achieved using the function $\texttt{inla.spde2.pcmatern()}$. We also define the associated projector matrix $B^\text{eff}$ with $\texttt{inla.spde.make.A()}$, mapping the projections of the SPDE to the observation points. Then, the function $\texttt{inla.spde.make.index()}$ is used to define the indexes of the latent variable for the SPDE model (i.e., an identifier that runs from $1$ to the number of basis functions).</span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a>The 1-dimensional effects $f_\text{FWI,FA,DOY}$ in @eq-inla-occ are defined through quadratic splines with $5$ knots for FWI and DOY, and $6$ knots for FA. For FWI, we want to extrapolate values as a constant in cases where new covariate values used for prediction are larger than the observed covariate values used for fitting the model, so we impose a Neumann upper-bound condition corresponding to a zero first derivative.</span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=F, message=F, warning=F}</span></span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a><span class="co"># dimension and shape parameter</span></span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">=</span> nu <span class="sc">+</span> d<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a><span class="co"># FWI mesh and SPDE</span></span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a>knots_FWI <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>, <span class="dv">30</span>)</span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a>bnd_FWI <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(DF_sub<span class="sc">$</span>FWI))</span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a>mesh_FWI <span class="ot">=</span> <span class="fu">inla.mesh.1d</span>(knots_FWI, bnd_FWI, <span class="at">degree=</span><span class="dv">2</span>, <span class="at">boundary=</span><span class="fu">c</span>(<span class="st">"free"</span>, <span class="st">"neumann"</span>))</span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a>B_FWI <span class="ot">=</span> <span class="fu">inla.spde.make.A</span>(mesh_FWI, DF_sub<span class="sc">$</span>FWI)</span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a>spde_FWI <span class="ot">=</span> <span class="fu">inla.spde2.pcmatern</span>(mesh_FWI, <span class="at">alpha =</span> alpha, <span class="at">prior.sigma =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>), <span class="at">prior.range =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="cn">NA</span>), <span class="at">constr =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a>idx_FWI <span class="ot">=</span> <span class="fu">inla.spde.make.index</span>(<span class="st">"FWI"</span>, <span class="at">n.spde =</span> spde_FWI<span class="sc">$</span>n.spde)</span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a><span class="co"># DOY mesh and SPDE</span></span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a>nknots <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a>knots_DOY <span class="ot">=</span> <span class="fu">quantile</span>(DF_sub<span class="sc">$</span>DOY, <span class="at">probs =</span> (<span class="dv">1</span><span class="sc">:</span>nknots)<span class="sc">/</span>(nknots<span class="sc">+</span><span class="dv">1</span>))</span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a>bnd_DOY <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">min</span>(DF_sub<span class="sc">$</span>DOY) <span class="sc">-</span> <span class="dv">7</span>, <span class="fu">max</span>(DF_sub<span class="sc">$</span>DOY) <span class="sc">+</span> <span class="dv">7</span>)</span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a>mesh_DOY <span class="ot">=</span> <span class="fu">inla.mesh.1d</span>(knots_DOY, bnd_DOY, <span class="at">degree=</span><span class="dv">2</span>, <span class="at">boundary=</span><span class="fu">c</span>(<span class="st">"free"</span>,<span class="st">"free"</span>))</span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a>spde_DOY <span class="ot">=</span> <span class="fu">inla.spde2.pcmatern</span>(mesh_DOY, <span class="at">alpha =</span> alpha, <span class="at">prior.sigma =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>), <span class="at">prior.range =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="cn">NA</span>), <span class="at">constr =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a>idx_DOY <span class="ot">=</span> <span class="fu">inla.spde.make.index</span>(<span class="st">"DOY"</span>, <span class="at">n.spde =</span> spde_DOY<span class="sc">$</span>n.spde)</span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a>B_DOY <span class="ot">=</span> <span class="fu">inla.spde.make.A</span>(mesh_DOY, DF_sub<span class="sc">$</span>DOY)</span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a><span class="co"># FA mesh and SPDE</span></span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a>knots_FA <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">500</span>,<span class="dv">1000</span>,<span class="dv">2000</span>,<span class="dv">3000</span>,<span class="dv">4000</span>,<span class="dv">5000</span>)</span>
<span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a>bnd_FA <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6400</span>)</span>
<span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a>mesh_FA <span class="ot">=</span> <span class="fu">inla.mesh.1d</span>(knots_FA, bnd_FA, <span class="at">degree=</span><span class="dv">2</span>, <span class="at">boundary=</span><span class="fu">c</span>(<span class="st">"free"</span>, <span class="st">"free"</span>))</span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a>spde_FA <span class="ot">=</span> <span class="fu">inla.spde2.pcmatern</span>(mesh_FA, <span class="at">alpha =</span> alpha, <span class="at">prior.sigma =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>), <span class="at">prior.range =</span> <span class="fu">c</span>(<span class="dv">3000</span>, <span class="cn">NA</span>), <span class="at">constr =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a>idx_FA <span class="ot">=</span> <span class="fu">inla.spde.make.index</span>(<span class="st">"FA"</span>, <span class="at">n.spde =</span> spde_FA<span class="sc">$</span>n.spde)</span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a>B_FA <span class="ot">=</span> <span class="fu">inla.spde.make.A</span>(mesh_FA, DF_sub<span class="sc">$</span>FA)</span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a>Regarding the spatial effect $f_\text{Spatial}$, the triangulation mesh depicted in @fig-2d-mesh has $1051$ nodes. In order to avoid non-stationary effects of the SPDE solution near the boundaries, we define two regions with a lower density of triangulation nodes in the outer region. Based on previous studies <span class="co">[</span><span class="ot">e.g. @Pimont2021</span><span class="co">]</span>, the parameters for the PC priors for the SPDE model (corresponding to exponential prior distributions for the standard deviation and the range parameter) are set using the following conditions: we set a probability of $50\%$ to have a standard deviation larger than $1$ and a probability of $5\%$ to have a spatial range smaller than $50$km.</span>
<span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo =F}</span></span>
<span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a><span class="co"># dimension and shape parameter</span></span>
<span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">=</span> nu <span class="sc">+</span> d<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a><span class="co">#definition of the mesh</span></span>
<span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a>PIXobs <span class="ot">=</span> <span class="fu">unique</span>(DF_sub<span class="sc">$</span>PIX)</span>
<span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a>coordL2e <span class="ot">=</span> coord[<span class="fu">match</span>(PIXobs,coord<span class="sc">$</span>N_SAFRAN),]</span>
<span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a><span class="co">#rescaling coordinates (otherwise, INLA may be unstable)</span></span>
<span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a>coordinla <span class="ot">=</span> <span class="fu">cbind</span>(coordL2e<span class="sc">$</span>XL2e<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>,coordL2e<span class="sc">$</span>YL2e<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>)</span>
<span id="cb2-311"><a href="#cb2-311" aria-hidden="true" tabindex="-1"></a><span class="co">#define boundaries for the domain of the SPDE model</span></span>
<span id="cb2-312"><a href="#cb2-312" aria-hidden="true" tabindex="-1"></a>bound1 <span class="ot">=</span> <span class="fu">inla.nonconvex.hull</span>(coordinla, <span class="at">convex=</span> <span class="sc">-</span><span class="fl">0.03</span>) <span class="co">#central boundary</span></span>
<span id="cb2-313"><a href="#cb2-313" aria-hidden="true" tabindex="-1"></a>bound2 <span class="ot">=</span> <span class="fu">inla.nonconvex.hull</span>(coordinla, <span class="at">convex=</span> <span class="sc">-</span><span class="fl">0.25</span>) <span class="co">#external boundary</span></span>
<span id="cb2-314"><a href="#cb2-314" aria-hidden="true" tabindex="-1"></a><span class="co">#create triangulation</span></span>
<span id="cb2-315"><a href="#cb2-315" aria-hidden="true" tabindex="-1"></a>mesh_spatial <span class="ot">=</span> <span class="fu">inla.mesh.2d</span>(coordinla,<span class="at">boundary=</span><span class="fu">list</span>(bound1,bound2),<span class="at">cutoff=</span><span class="fl">0.001</span>, <span class="at">min.angle=</span><span class="dv">21</span>, <span class="at">max.edge=</span> <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.025</span>))</span>
<span id="cb2-316"><a href="#cb2-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-317"><a href="#cb2-317" aria-hidden="true" tabindex="-1"></a>spde_PIX <span class="ot">=</span> <span class="fu">inla.spde2.pcmatern</span>(<span class="at">mesh =</span> mesh_spatial, <span class="at">alpha =</span> alpha, <span class="at">prior.range =</span> <span class="fu">c</span>(.<span class="dv">05</span>, .<span class="dv">05</span>), <span class="at">prior.sigma =</span> <span class="fu">c</span>(<span class="dv">1</span>,.<span class="dv">5</span>), <span class="at">constr =</span> T)</span>
<span id="cb2-318"><a href="#cb2-318" aria-hidden="true" tabindex="-1"></a>idx_PIX <span class="ot">=</span> <span class="fu">inla.spde.make.index</span>(<span class="st">"spatial"</span>, <span class="at">n.spde =</span> spde_PIX<span class="sc">$</span>n.spde)</span>
<span id="cb2-319"><a href="#cb2-319" aria-hidden="true" tabindex="-1"></a>B_PIX <span class="ot">=</span> <span class="fu">inla.spde.make.A</span>(mesh_spatial, </span>
<span id="cb2-320"><a href="#cb2-320" aria-hidden="true" tabindex="-1"></a>                         <span class="at">loc =</span> <span class="fu">cbind</span>(DF_sub<span class="sc">$</span>XL2e, DF_sub<span class="sc">$</span>YL2e)<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>)</span>
<span id="cb2-321"><a href="#cb2-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-322"><a href="#cb2-322" aria-hidden="true" tabindex="-1"></a><span class="co">#for the Besag model on sizes we need to define the neighborhood structure </span></span>
<span id="cb2-323"><a href="#cb2-323" aria-hidden="true" tabindex="-1"></a>dept <span class="ot">=</span> <span class="fu">as_Spatial</span>(dep[(dep<span class="sc">$</span>INSEE_DEP <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"24"</span>, <span class="st">"33"</span>, <span class="st">"40"</span>, <span class="st">"47"</span>)),])</span>
<span id="cb2-324"><a href="#cb2-324" aria-hidden="true" tabindex="-1"></a>spdep<span class="sc">::</span><span class="fu">nb2INLA</span>(<span class="st">"SIZEadjgraphDEP.txt"</span>,spdep<span class="sc">::</span><span class="fu">poly2nb</span>(dept,<span class="at">queen=</span>F,</span>
<span id="cb2-325"><a href="#cb2-325" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">row.names=</span>dept<span class="sc">$</span>DEP))</span>
<span id="cb2-326"><a href="#cb2-326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-327"><a href="#cb2-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-328"><a href="#cb2-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-329"><a href="#cb2-329" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo =F, fig.width = 6, fig.height = 6}</span></span>
<span id="cb2-330"><a href="#cb2-330" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-2d-mesh</span></span>
<span id="cb2-331"><a href="#cb2-331" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Constructed spatial mesh with $1051$ nodes. Red dots represent the centers of the SAFRAN pixels for the study area."</span></span>
<span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mesh_spatial,<span class="at">main=</span><span class="st">""</span>)</span>
<span id="cb2-334"><a href="#cb2-334" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(coordinla,<span class="at">col=</span><span class="st">"red"</span>,<span class="at">pch=</span><span class="dv">19</span>,<span class="at">cex=</span>.<span class="dv">5</span>)</span>
<span id="cb2-335"><a href="#cb2-335" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-336"><a href="#cb2-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-337"><a href="#cb2-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-338"><a href="#cb2-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-339"><a href="#cb2-339" aria-hidden="true" tabindex="-1"></a><span class="fu">## Estimation of the occurrence model</span></span>
<span id="cb2-340"><a href="#cb2-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-341"><a href="#cb2-341" aria-hidden="true" tabindex="-1"></a>To perform the model estimation, we gather all the information in a stack, a data format used in the R-INLA package that is appropriate for INLA and contains the data, the projection matrices and the different effects. In the model, we only have one fixed effect, which is the intercept, and five random effects. For the SPDE-based effects we include the indices of their associated SPDE. Then, we define the model formula as in @eq-inla-occ.</span>
<span id="cb2-342"><a href="#cb2-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-343"><a href="#cb2-343" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo =F}</span></span>
<span id="cb2-344"><a href="#cb2-344" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb2-345"><a href="#cb2-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-346"><a href="#cb2-346" aria-hidden="true" tabindex="-1"></a>fixed_effects_df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">intercept =</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(DF_sub))) </span>
<span id="cb2-347"><a href="#cb2-347" aria-hidden="true" tabindex="-1"></a>stack.obs <span class="ot">=</span> <span class="fu">inla.stack</span>(<span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(DF_sub<span class="sc">$</span>NB0<span class="fl">.1</span>)), </span>
<span id="cb2-348"><a href="#cb2-348" aria-hidden="true" tabindex="-1"></a>                       <span class="at">A =</span> <span class="fu">list</span>(B_DOY, B_FWI, B_PIX, B_FA,<span class="dv">1</span>,<span class="dv">1</span> ), </span>
<span id="cb2-349"><a href="#cb2-349" aria-hidden="true" tabindex="-1"></a>                       <span class="at">effects =</span> <span class="fu">list</span>(idx_DOY, idx_FWI,  idx_PIX, idx_FA, </span>
<span id="cb2-350"><a href="#cb2-350" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">list</span>(<span class="at">YEAR=</span>(DF_sub<span class="sc">$</span>YEAR<span class="dv">-2005</span>)),fixed_effects_df))</span>
<span id="cb2-351"><a href="#cb2-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-352"><a href="#cb2-352" aria-hidden="true" tabindex="-1"></a>hyper_prec <span class="ot">=</span> <span class="fu">list</span>(<span class="at">prec =</span> <span class="fu">list</span>(<span class="at">prior =</span> <span class="st">'pcprec'</span>, <span class="at">param =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>)))</span>
<span id="cb2-353"><a href="#cb2-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-354"><a href="#cb2-354" aria-hidden="true" tabindex="-1"></a>formula <span class="ot">=</span> y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span>  intercept <span class="sc">+</span> <span class="fu">f</span>(YEAR,<span class="at">model=</span><span class="st">"iid"</span>, <span class="at">hyper =</span> hyper_prec) <span class="sc">+</span> <span class="fu">f</span>(DOY, <span class="at">model =</span> spde_DOY)  <span class="sc">+</span>  <span class="fu">f</span>(FWI, <span class="at">model =</span> spde_FWI)<span class="sc">+</span>  <span class="fu">f</span>(FA, <span class="at">model =</span> spde_FA) <span class="sc">+</span>  <span class="fu">f</span>(spatial, <span class="at">model =</span> spde_PIX)</span>
<span id="cb2-355"><a href="#cb2-355" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-356"><a href="#cb2-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-357"><a href="#cb2-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-358"><a href="#cb2-358" aria-hidden="true" tabindex="-1"></a>We then fit the model calling $\texttt{inla()}$ with a number of user-specific settings to control how Laplace approximations are carried out and which posterior quantities are calculated.</span>
<span id="cb2-359"><a href="#cb2-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-360"><a href="#cb2-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-361"><a href="#cb2-361" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo =F, warning = F}</span></span>
<span id="cb2-362"><a href="#cb2-362" aria-hidden="true" tabindex="-1"></a>fit<span class="ot">=</span><span class="fu">inla</span>(formula,</span>
<span id="cb2-363"><a href="#cb2-363" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> <span class="fu">inla.stack.data</span>(stack.obs),</span>
<span id="cb2-364"><a href="#cb2-364" aria-hidden="true" tabindex="-1"></a>         <span class="at">family =</span> <span class="st">"poisson"</span>,</span>
<span id="cb2-365"><a href="#cb2-365" aria-hidden="true" tabindex="-1"></a>         <span class="at">quantiles =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>),</span>
<span id="cb2-366"><a href="#cb2-366" aria-hidden="true" tabindex="-1"></a>         <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">return.marginals=</span>T,<span class="at">config=</span><span class="cn">TRUE</span>,<span class="at">dic=</span><span class="cn">TRUE</span>,</span>
<span id="cb2-367"><a href="#cb2-367" aria-hidden="true" tabindex="-1"></a>                                <span class="at">waic=</span><span class="cn">TRUE</span>),</span>
<span id="cb2-368"><a href="#cb2-368" aria-hidden="true" tabindex="-1"></a>         <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute=</span><span class="cn">FALSE</span>,<span class="at">A=</span><span class="fu">inla.stack.A</span>(stack.obs)),</span>
<span id="cb2-369"><a href="#cb2-369" aria-hidden="true" tabindex="-1"></a>         <span class="at">control.inla =</span> <span class="fu">list</span>(<span class="at">strategy=</span><span class="st">"adaptive"</span>,<span class="at">adaptive.max=</span><span class="dv">1000</span>),</span>
<span id="cb2-370"><a href="#cb2-370" aria-hidden="true" tabindex="-1"></a>         <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-371"><a href="#cb2-371" aria-hidden="true" tabindex="-1"></a>         <span class="at">E =</span> DF_sub<span class="sc">$</span>weight_ss,</span>
<span id="cb2-372"><a href="#cb2-372" aria-hidden="true" tabindex="-1"></a>         <span class="at">num.threads =</span> <span class="dv">2</span>)</span>
<span id="cb2-373"><a href="#cb2-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-374"><a href="#cb2-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-375"><a href="#cb2-375" aria-hidden="true" tabindex="-1"></a>We can visualize summaries of the posterior distributions of the random effects. For the SPDE effects, we have to project the effects on a 1-d (or 2-d for the spatial effect) grid that contains the initial mesh. The new projector matrix (i.e., the matrix $B$ containing the new values of covariates and evaluated spline bases) is obtained with the function $\texttt{inla.mesh.projector()}$. Results are depicted in @fig-posterior-mean.</span>
<span id="cb2-376"><a href="#cb2-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-377"><a href="#cb2-377" aria-hidden="true" tabindex="-1"></a>From @fig-posterior-mean, we can conclude that the yearly effect captures an inter-annual variability that cannot be described by the physical parameters FWI and FA. Regarding the seasonal effect DOY, we see that it decreases in mid-September, after the high summer heat. Both  FWI and Forest area (FA) effects increase almost linearly, which is something that we expect since wildfire activity increases with FWI and the amount of fuel material. Looking at the spatial effect, we can observe a high spatial correlation between the different locations and clear separated clusters highlighting different fire regimes. An interpretation of these results is that FWI and FA are able to explain a substantial part of the spatiotemporal variability in wildfire activity, but that there also remains strong spatiotemporal residual correlation that is captured by the other random effects. Lastly, the magnitude of the effects appears to be smaller for the yearly effect than for the other effects.</span>
<span id="cb2-378"><a href="#cb2-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-379"><a href="#cb2-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-380"><a href="#cb2-380" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning=F, message=F}</span></span>
<span id="cb2-381"><a href="#cb2-381" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-posterior-mean</span></span>
<span id="cb2-382"><a href="#cb2-382" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Partial effects of the occurrence model."</span></span>
<span id="cb2-383"><a href="#cb2-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-384"><a href="#cb2-384" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb2-385"><a href="#cb2-385" aria-hidden="true" tabindex="-1"></a><span class="co">#yearly effect</span></span>
<span id="cb2-386"><a href="#cb2-386" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">=</span> <span class="fu">sort</span>(<span class="fu">unique</span>(DF_sub<span class="sc">$</span>YEAR))</span>
<span id="cb2-387"><a href="#cb2-387" aria-hidden="true" tabindex="-1"></a>plots[[<span class="dv">1</span>]] <span class="ot">=</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb2-388"><a href="#cb2-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid,<span class="at">y=</span>fit<span class="sc">$</span>summary.random<span class="sc">$</span>YEAR<span class="sc">$</span>mean))<span class="sc">+</span></span>
<span id="cb2-389"><a href="#cb2-389" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid,<span class="at">y=</span>fit<span class="sc">$</span>summary.random<span class="sc">$</span>YEAR<span class="sc">$</span><span class="st">`</span><span class="at">0.025quant</span><span class="st">`</span>),</span>
<span id="cb2-390"><a href="#cb2-390" aria-hidden="true" tabindex="-1"></a>              <span class="at">color=</span><span class="st">'blue'</span>,<span class="at">linetype=</span><span class="st">'dashed'</span>)<span class="sc">+</span></span>
<span id="cb2-391"><a href="#cb2-391" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid,<span class="at">y=</span>fit<span class="sc">$</span>summary.random<span class="sc">$</span>YEAR<span class="sc">$</span><span class="st">`</span><span class="at">0.975quant</span><span class="st">`</span>),</span>
<span id="cb2-392"><a href="#cb2-392" aria-hidden="true" tabindex="-1"></a>              <span class="at">color=</span><span class="st">'blue'</span>,<span class="at">linetype=</span><span class="st">'dashed'</span>)<span class="sc">+</span></span>
<span id="cb2-393"><a href="#cb2-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">'Linear predictor'</span>, <span class="at">x =</span> <span class="st">"Year"</span>)<span class="sc">+</span></span>
<span id="cb2-394"><a href="#cb2-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb2-395"><a href="#cb2-395" aria-hidden="true" tabindex="-1"></a><span class="co"># 1-d SPDE effects</span></span>
<span id="cb2-396"><a href="#cb2-396" aria-hidden="true" tabindex="-1"></a>ngrid <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb2-397"><a href="#cb2-397" aria-hidden="true" tabindex="-1"></a>names_effect <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"DOY"</span>, <span class="st">"FWI"</span>, <span class="st">"FA"</span>)</span>
<span id="cb2-398"><a href="#cb2-398" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(names_effect)){</span>
<span id="cb2-399"><a href="#cb2-399" aria-hidden="true" tabindex="-1"></a>  eff <span class="ot">=</span> names_effect[i]</span>
<span id="cb2-400"><a href="#cb2-400" aria-hidden="true" tabindex="-1"></a>  mesh <span class="ot">=</span> <span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">"mesh_"</span>, eff))</span>
<span id="cb2-401"><a href="#cb2-401" aria-hidden="true" tabindex="-1"></a>  grid <span class="ot">=</span> <span class="fu">inla.mesh.projector</span>(mesh, <span class="at">dims =</span> ngrid)</span>
<span id="cb2-402"><a href="#cb2-402" aria-hidden="true" tabindex="-1"></a>  curve_mean <span class="ot">=</span> <span class="fu">inla.mesh.project</span>(grid, <span class="at">field =</span> fit<span class="sc">$</span>summary.random[[eff]]<span class="sc">$</span>mean)</span>
<span id="cb2-403"><a href="#cb2-403" aria-hidden="true" tabindex="-1"></a>  curve_upper<span class="ot">=</span><span class="fu">inla.mesh.project</span>(grid,</span>
<span id="cb2-404"><a href="#cb2-404" aria-hidden="true" tabindex="-1"></a>                                <span class="at">field=</span>fit<span class="sc">$</span>summary.random[[eff]]<span class="sc">$</span><span class="st">`</span><span class="at">0.975quant</span><span class="st">`</span>)</span>
<span id="cb2-405"><a href="#cb2-405" aria-hidden="true" tabindex="-1"></a>  curve_lower<span class="ot">=</span><span class="fu">inla.mesh.project</span>(grid,</span>
<span id="cb2-406"><a href="#cb2-406" aria-hidden="true" tabindex="-1"></a>                                <span class="at">field=</span>fit<span class="sc">$</span>summary.random[[eff]]<span class="sc">$</span><span class="st">`</span><span class="at">0.025quant</span><span class="st">`</span>)</span>
<span id="cb2-407"><a href="#cb2-407" aria-hidden="true" tabindex="-1"></a>  plots[[i<span class="sc">+</span><span class="dv">1</span>]] <span class="ot">=</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb2-408"><a href="#cb2-408" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid<span class="sc">$</span>x,<span class="at">y=</span>curve_mean))<span class="sc">+</span></span>
<span id="cb2-409"><a href="#cb2-409" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid<span class="sc">$</span>x,<span class="at">y=</span>curve_lower),<span class="at">color=</span><span class="st">'blue'</span>,<span class="at">linetype=</span><span class="st">'dashed'</span>)<span class="sc">+</span></span>
<span id="cb2-410"><a href="#cb2-410" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid<span class="sc">$</span>x,<span class="at">y=</span>curve_upper),<span class="at">color=</span><span class="st">'blue'</span>,<span class="at">linetype=</span><span class="st">'dashed'</span>)<span class="sc">+</span></span>
<span id="cb2-411"><a href="#cb2-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">'Linear predictor'</span>, <span class="at">x =</span> eff)<span class="sc">+</span></span>
<span id="cb2-412"><a href="#cb2-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb2-413"><a href="#cb2-413" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-414"><a href="#cb2-414" aria-hidden="true" tabindex="-1"></a><span class="co"># spatial effect</span></span>
<span id="cb2-415"><a href="#cb2-415" aria-hidden="true" tabindex="-1"></a>ngrid <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb2-416"><a href="#cb2-416" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">=</span> <span class="fu">inla.mesh.projector</span>(mesh_spatial, <span class="at">dims=</span><span class="fu">c</span>(ngrid, ngrid),</span>
<span id="cb2-417"><a href="#cb2-417" aria-hidden="true" tabindex="-1"></a>                           <span class="at">xlim=</span><span class="fu">range</span>(coordinla[,<span class="dv">1</span>]),</span>
<span id="cb2-418"><a href="#cb2-418" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ylim=</span><span class="fu">range</span>(coordinla[,<span class="dv">2</span>]))</span>
<span id="cb2-419"><a href="#cb2-419" aria-hidden="true" tabindex="-1"></a>field_mean <span class="ot">=</span> <span class="fu">inla.mesh.project</span>(grid, <span class="at">field =</span> fit<span class="sc">$</span>summary.random<span class="sc">$</span>spatial<span class="sc">$</span>mean[<span class="dv">1</span><span class="sc">:</span>mesh_spatial<span class="sc">$</span>n])</span>
<span id="cb2-420"><a href="#cb2-420" aria-hidden="true" tabindex="-1"></a>df.spatial <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x =</span> grid<span class="sc">$</span>x, <span class="at">y =</span> grid<span class="sc">$</span>y)</span>
<span id="cb2-421"><a href="#cb2-421" aria-hidden="true" tabindex="-1"></a>df.spatial<span class="sc">$</span>mean <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(field_mean)</span>
<span id="cb2-422"><a href="#cb2-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-423"><a href="#cb2-423" aria-hidden="true" tabindex="-1"></a>pix.inla <span class="ot">=</span> df.spatial[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)]<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span></span>
<span id="cb2-424"><a href="#cb2-424" aria-hidden="true" tabindex="-1"></a>pix.inla <span class="ot">=</span> pix.inla <span class="sc">%&gt;%</span>  <span class="co">#convert to an sf object</span></span>
<span id="cb2-425"><a href="#cb2-425" aria-hidden="true" tabindex="-1"></a>    as.data.frame <span class="sc">%&gt;%</span> </span>
<span id="cb2-426"><a href="#cb2-426" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb2-427"><a href="#cb2-427" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(pix.inla) <span class="ot">&lt;-</span> <span class="dv">27572</span></span>
<span id="cb2-428"><a href="#cb2-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-429"><a href="#cb2-429" aria-hidden="true" tabindex="-1"></a>idx.spatial.plot <span class="ot">=</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(pix.inla,dep.coord)) <span class="sc">&gt;</span><span class="dv">0</span></span>
<span id="cb2-430"><a href="#cb2-430" aria-hidden="true" tabindex="-1"></a>df.spatial <span class="ot">=</span> df.spatial[idx.spatial.plot,]</span>
<span id="cb2-431"><a href="#cb2-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-432"><a href="#cb2-432" aria-hidden="true" tabindex="-1"></a>plots[[<span class="dv">5</span>]] <span class="ot">=</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb2-433"><a href="#cb2-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>df.spatial<span class="sc">$</span>x<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>,<span class="at">y=</span>df.spatial<span class="sc">$</span>y<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>,<span class="at">color =</span> df.spatial<span class="sc">$</span>mean),<span class="at">size=</span><span class="dv">3</span>, <span class="at">shape=</span><span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb2-434"><a href="#cb2-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> departements,<span class="at">fill=</span><span class="st">"NA"</span>)<span class="sc">+</span></span>
<span id="cb2-435"><a href="#cb2-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">default_crs=</span><span class="st">"+init=epsg:27572"</span>,<span class="at">xlim=</span><span class="fu">range</span>(coordinla[,<span class="dv">1</span>])<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>,</span>
<span id="cb2-436"><a href="#cb2-436" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylim=</span><span class="fu">range</span>(coordinla[,<span class="dv">2</span>])<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>)<span class="sc">+</span></span>
<span id="cb2-437"><a href="#cb2-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Spatial effect"</span>) <span class="sc">+</span></span>
<span id="cb2-438"><a href="#cb2-438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>coordinla[,<span class="dv">1</span>]<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>,<span class="at">y=</span>coordinla[,<span class="dv">2</span>]<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>), <span class="at">size =</span> .<span class="dv">05</span>)<span class="sc">+</span></span>
<span id="cb2-439"><a href="#cb2-439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb2-440"><a href="#cb2-440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">color=</span><span class="st">""</span>,</span>
<span id="cb2-441"><a href="#cb2-441" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">'Latitude'</span>, <span class="at">x =</span> <span class="st">'Longitude'</span>)<span class="sc">+</span></span>
<span id="cb2-442"><a href="#cb2-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">na.value =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb2-443"><a href="#cb2-443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colourbar</span>(<span class="at">barwidth =</span> <span class="dv">1</span>,<span class="at">barheight =</span> <span class="dv">10</span>))</span>
<span id="cb2-444"><a href="#cb2-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-445"><a href="#cb2-445" aria-hidden="true" tabindex="-1"></a><span class="fu">do.call</span>(grid.arrange,<span class="fu">c</span>(plots, <span class="fu">list</span>(<span class="at">layout_matrix=</span><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>),<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>)),<span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>))))</span>
<span id="cb2-446"><a href="#cb2-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-447"><a href="#cb2-447" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-448"><a href="#cb2-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-449"><a href="#cb2-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-450"><a href="#cb2-450" aria-hidden="true" tabindex="-1"></a><span class="fu">## Estimation of the size model</span></span>
<span id="cb2-451"><a href="#cb2-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-452"><a href="#cb2-452" aria-hidden="true" tabindex="-1"></a>Similarly to the occurrence model, we use INLA to perform the size model estimation. But prior to that, we need to build the new projection matrices for the SPDE effects defined in @eq-size-model since we will consider hereafter only data such that the burnt area is greater than $0.1$ha. We here perform the estimation of the size model separately from the estimation of the occurrence model, which is possible as long as we do not construct a model where some of the random effects are used in both the occurrence model and the size model, i.e., where there are shared random effects, such as in @Koh2021. Separate estimation of the two models strongly reduces the overall computational cost for running INLA.</span>
<span id="cb2-453"><a href="#cb2-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-454"><a href="#cb2-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-455"><a href="#cb2-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-456"><a href="#cb2-456" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = F}</span></span>
<span id="cb2-457"><a href="#cb2-457" aria-hidden="true" tabindex="-1"></a>DFsize <span class="ot">=</span> DF[DF<span class="sc">$</span>BA <span class="sc">&gt;</span> <span class="fl">0.1</span>, ] </span>
<span id="cb2-458"><a href="#cb2-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-459"><a href="#cb2-459" aria-hidden="true" tabindex="-1"></a>B_FWI <span class="ot">=</span> <span class="fu">inla.spde.make.A</span>(mesh_FWI, DFsize<span class="sc">$</span>FWI)</span>
<span id="cb2-460"><a href="#cb2-460" aria-hidden="true" tabindex="-1"></a>B_FA <span class="ot">=</span> <span class="fu">inla.spde.make.A</span>(mesh_FA, DFsize<span class="sc">$</span>FA)</span>
<span id="cb2-461"><a href="#cb2-461" aria-hidden="true" tabindex="-1"></a>B_PIX <span class="ot">=</span> <span class="fu">inla.spde.make.A</span>(mesh_spatial, <span class="at">loc=</span><span class="fu">cbind</span>(DFsize<span class="sc">$</span>XL2e,DFsize<span class="sc">$</span>YL2e)<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>)</span>
<span id="cb2-462"><a href="#cb2-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-463"><a href="#cb2-463" aria-hidden="true" tabindex="-1"></a>fixed_effects_df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">intercept =</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(DFsize))) </span>
<span id="cb2-464"><a href="#cb2-464" aria-hidden="true" tabindex="-1"></a>stack.obs.size <span class="ot">=</span> <span class="fu">inla.stack</span>(<span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> DFsize<span class="sc">$</span>BA), </span>
<span id="cb2-465"><a href="#cb2-465" aria-hidden="true" tabindex="-1"></a>                            <span class="at">A =</span> <span class="fu">list</span>(B_FWI, B_FA,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span> ),</span>
<span id="cb2-466"><a href="#cb2-466" aria-hidden="true" tabindex="-1"></a>                            <span class="at">effects =</span> <span class="fu">list</span>( idx_FWI,   idx_FA,<span class="fu">list</span>(<span class="at">DEP=</span><span class="fu">match</span>(DFsize<span class="sc">$</span>DEP,dept[[<span class="dv">2</span>]])),<span class="fu">list</span>(<span class="at">YEAR=</span>(DFsize<span class="sc">$</span>YEAR<span class="dv">-2005</span>)),</span>
<span id="cb2-467"><a href="#cb2-467" aria-hidden="true" tabindex="-1"></a>                                            fixed_effects_df))</span>
<span id="cb2-468"><a href="#cb2-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-469"><a href="#cb2-469" aria-hidden="true" tabindex="-1"></a>formula.size <span class="ot">=</span> y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> intercept <span class="sc">+</span><span class="fu">f</span>(FA, <span class="at">model =</span> spde_FA) <span class="sc">+</span>  <span class="fu">f</span>(FWI, <span class="at">model =</span> spde_FWI) <span class="sc">+</span> <span class="fu">f</span>(YEAR,<span class="at">model =</span> <span class="st">"iid"</span>, <span class="at">hyper =</span> hyper_prec) <span class="sc">+</span> <span class="fu">f</span>(DEP,<span class="at">model=</span><span class="st">"iid"</span>)</span>
<span id="cb2-470"><a href="#cb2-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-471"><a href="#cb2-471" aria-hidden="true" tabindex="-1"></a>fit.size<span class="ot">=</span><span class="fu">inla</span>(formula.size,</span>
<span id="cb2-472"><a href="#cb2-472" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> <span class="fu">inla.stack.data</span>(stack.obs.size),</span>
<span id="cb2-473"><a href="#cb2-473" aria-hidden="true" tabindex="-1"></a>         <span class="at">family =</span> <span class="st">"gamma"</span>,</span>
<span id="cb2-474"><a href="#cb2-474" aria-hidden="true" tabindex="-1"></a>         <span class="at">quantiles =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>),</span>
<span id="cb2-475"><a href="#cb2-475" aria-hidden="true" tabindex="-1"></a>         <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">return.marginals=</span>T,<span class="at">config=</span><span class="cn">TRUE</span>,<span class="at">dic=</span><span class="cn">TRUE</span>,</span>
<span id="cb2-476"><a href="#cb2-476" aria-hidden="true" tabindex="-1"></a>                                <span class="at">waic=</span><span class="cn">TRUE</span>),</span>
<span id="cb2-477"><a href="#cb2-477" aria-hidden="true" tabindex="-1"></a>         <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute=</span><span class="cn">FALSE</span>,<span class="at">A=</span><span class="fu">inla.stack.A</span>(stack.obs.size)),</span>
<span id="cb2-478"><a href="#cb2-478" aria-hidden="true" tabindex="-1"></a>         <span class="at">control.inla =</span> <span class="fu">list</span>(<span class="at">strategy=</span><span class="st">"adaptive"</span>,<span class="at">adaptive.max=</span><span class="dv">1000</span>),</span>
<span id="cb2-479"><a href="#cb2-479" aria-hidden="true" tabindex="-1"></a>         <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-480"><a href="#cb2-480" aria-hidden="true" tabindex="-1"></a>         <span class="at">num.threads =</span> <span class="dv">2</span>)</span>
<span id="cb2-481"><a href="#cb2-481" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-482"><a href="#cb2-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-483"><a href="#cb2-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-484"><a href="#cb2-484" aria-hidden="true" tabindex="-1"></a>Again, after running the INLA estimation, we can plot the  estimated random effects, see @fig-posterior-mean-size. It can be seen that large wildfires tend to be associated with large values of FWI and FA. The spatial effect  is almost null except for the north-east region for which we have a negative effect. Finally, looking at the amplitude of the effects, the FWI has the strongest influence on wildfire sizes.</span>
<span id="cb2-485"><a href="#cb2-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-486"><a href="#cb2-486" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=F,message=F, fig.height = 7}</span></span>
<span id="cb2-487"><a href="#cb2-487" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-posterior-mean-size</span></span>
<span id="cb2-488"><a href="#cb2-488" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Partial effects of the size model."</span></span>
<span id="cb2-489"><a href="#cb2-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-490"><a href="#cb2-490" aria-hidden="true" tabindex="-1"></a>plots<span class="ot">=</span><span class="fu">c</span>()</span>
<span id="cb2-491"><a href="#cb2-491" aria-hidden="true" tabindex="-1"></a>names_effect <span class="ot">=</span> <span class="fu">names</span>(fit.size<span class="sc">$</span>summary.random)</span>
<span id="cb2-492"><a href="#cb2-492" aria-hidden="true" tabindex="-1"></a>j<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb2-493"><a href="#cb2-493" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">str_detect</span>(names_effect,<span class="st">"YEAR"</span>)) ){</span>
<span id="cb2-494"><a href="#cb2-494" aria-hidden="true" tabindex="-1"></a>  grid <span class="ot">=</span> <span class="fu">sort</span>(<span class="fu">unique</span>(DF_sub<span class="sc">$</span>YEAR))</span>
<span id="cb2-495"><a href="#cb2-495" aria-hidden="true" tabindex="-1"></a>  j <span class="ot">=</span> j <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-496"><a href="#cb2-496" aria-hidden="true" tabindex="-1"></a>  plots[[j]] <span class="ot">=</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb2-497"><a href="#cb2-497" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid,<span class="at">y=</span>fit.size<span class="sc">$</span>summary.random<span class="sc">$</span>YEAR<span class="sc">$</span>mean))<span class="sc">+</span></span>
<span id="cb2-498"><a href="#cb2-498" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid,<span class="at">y=</span>fit.size<span class="sc">$</span>summary.random<span class="sc">$</span>YEAR<span class="sc">$</span><span class="st">`</span><span class="at">0.025quant</span><span class="st">`</span>),</span>
<span id="cb2-499"><a href="#cb2-499" aria-hidden="true" tabindex="-1"></a>              <span class="at">color=</span><span class="st">'blue'</span>,<span class="at">linetype=</span><span class="st">'dashed'</span>)<span class="sc">+</span></span>
<span id="cb2-500"><a href="#cb2-500" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid,<span class="at">y=</span>fit.size<span class="sc">$</span>summary.random<span class="sc">$</span>YEAR<span class="sc">$</span><span class="st">`</span><span class="at">0.975quant</span><span class="st">`</span>),</span>
<span id="cb2-501"><a href="#cb2-501" aria-hidden="true" tabindex="-1"></a>              <span class="at">color=</span><span class="st">'blue'</span>,<span class="at">linetype=</span><span class="st">'dashed'</span>)<span class="sc">+</span></span>
<span id="cb2-502"><a href="#cb2-502" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">'Linear predictor'</span>, <span class="at">x =</span> <span class="st">"Year"</span>)<span class="sc">+</span></span>
<span id="cb2-503"><a href="#cb2-503" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb2-504"><a href="#cb2-504" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-505"><a href="#cb2-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-506"><a href="#cb2-506" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">str_detect</span>(names_effect,<span class="st">"DEP"</span>)) ){</span>
<span id="cb2-507"><a href="#cb2-507" aria-hidden="true" tabindex="-1"></a>  j <span class="ot">=</span> j <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-508"><a href="#cb2-508" aria-hidden="true" tabindex="-1"></a>  plots[[j]] <span class="ot">=</span> <span class="fu">ggplot</span>(departements)<span class="sc">+</span></span>
<span id="cb2-509"><a href="#cb2-509" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill=</span>fit.size<span class="sc">$</span>summary.random<span class="sc">$</span>DEP<span class="sc">$</span>mean))<span class="sc">+</span></span>
<span id="cb2-510"><a href="#cb2-510" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">default_crs=</span><span class="st">"+init=epsg:27572"</span>,<span class="at">xlim=</span><span class="fu">range</span>(coordinla[,<span class="dv">1</span>])<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>,</span>
<span id="cb2-511"><a href="#cb2-511" aria-hidden="true" tabindex="-1"></a>             <span class="at">ylim=</span><span class="fu">range</span>(coordinla[,<span class="dv">2</span>])<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>)<span class="sc">+</span></span>
<span id="cb2-512"><a href="#cb2-512" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Spatial effect"</span>) <span class="sc">+</span></span>
<span id="cb2-513"><a href="#cb2-513" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb2-514"><a href="#cb2-514" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>( <span class="at">fill=</span><span class="st">""</span>,</span>
<span id="cb2-515"><a href="#cb2-515" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="st">'Latitude'</span>, <span class="at">x =</span> <span class="st">'Longitude'</span>)<span class="sc">+</span></span>
<span id="cb2-516"><a href="#cb2-516" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis</span>(<span class="at">na.value =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb2-517"><a href="#cb2-517" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colourbar</span>(<span class="at">barwidth =</span> <span class="dv">1</span>,<span class="at">barheight =</span> <span class="dv">10</span>))</span>
<span id="cb2-518"><a href="#cb2-518" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-519"><a href="#cb2-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-520"><a href="#cb2-520" aria-hidden="true" tabindex="-1"></a>ngrid <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb2-521"><a href="#cb2-521" aria-hidden="true" tabindex="-1"></a>names_effect <span class="ot">=</span> names_effect[<span class="sc">!</span> (names_effect <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"YEAR"</span>,<span class="st">"DEP"</span>))]</span>
<span id="cb2-522"><a href="#cb2-522" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(names_effect)){</span>
<span id="cb2-523"><a href="#cb2-523" aria-hidden="true" tabindex="-1"></a>  eff <span class="ot">=</span> names_effect[i]</span>
<span id="cb2-524"><a href="#cb2-524" aria-hidden="true" tabindex="-1"></a>  mesh <span class="ot">=</span> <span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">"mesh_"</span>, eff))</span>
<span id="cb2-525"><a href="#cb2-525" aria-hidden="true" tabindex="-1"></a>  grid <span class="ot">=</span> <span class="fu">inla.mesh.projector</span>(mesh, <span class="at">dims =</span> ngrid)</span>
<span id="cb2-526"><a href="#cb2-526" aria-hidden="true" tabindex="-1"></a>  curve_mean <span class="ot">=</span> <span class="fu">inla.mesh.project</span>(grid, </span>
<span id="cb2-527"><a href="#cb2-527" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">field =</span> fit.size<span class="sc">$</span>summary.random[[eff]]<span class="sc">$</span>mean)</span>
<span id="cb2-528"><a href="#cb2-528" aria-hidden="true" tabindex="-1"></a>  curve_upper<span class="ot">=</span><span class="fu">inla.mesh.project</span>(grid,</span>
<span id="cb2-529"><a href="#cb2-529" aria-hidden="true" tabindex="-1"></a>                            <span class="at">field=</span>fit.size<span class="sc">$</span>summary.random[[eff]]<span class="sc">$</span><span class="st">`</span><span class="at">0.975quant</span><span class="st">`</span>)</span>
<span id="cb2-530"><a href="#cb2-530" aria-hidden="true" tabindex="-1"></a>  curve_lower<span class="ot">=</span><span class="fu">inla.mesh.project</span>(grid,</span>
<span id="cb2-531"><a href="#cb2-531" aria-hidden="true" tabindex="-1"></a>                            <span class="at">field=</span>fit.size<span class="sc">$</span>summary.random[[eff]]<span class="sc">$</span><span class="st">`</span><span class="at">0.025quant</span><span class="st">`</span>)</span>
<span id="cb2-532"><a href="#cb2-532" aria-hidden="true" tabindex="-1"></a>  plots[[i<span class="sc">+</span>j]] <span class="ot">=</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb2-533"><a href="#cb2-533" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid<span class="sc">$</span>x,<span class="at">y=</span>curve_mean))<span class="sc">+</span></span>
<span id="cb2-534"><a href="#cb2-534" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid<span class="sc">$</span>x,<span class="at">y=</span>curve_lower),<span class="at">color=</span><span class="st">'blue'</span>,<span class="at">linetype=</span><span class="st">'dashed'</span>)<span class="sc">+</span></span>
<span id="cb2-535"><a href="#cb2-535" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid<span class="sc">$</span>x,<span class="at">y=</span>curve_upper),<span class="at">color=</span><span class="st">'blue'</span>,<span class="at">linetype=</span><span class="st">'dashed'</span>)<span class="sc">+</span></span>
<span id="cb2-536"><a href="#cb2-536" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">'Linear predictor'</span>, <span class="at">x =</span> eff)<span class="sc">+</span></span>
<span id="cb2-537"><a href="#cb2-537" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb2-538"><a href="#cb2-538" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-539"><a href="#cb2-539" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">str_detect</span>(<span class="fu">names</span>(fit.size<span class="sc">$</span>summary.random),<span class="st">"DEP"</span>))){</span>
<span id="cb2-540"><a href="#cb2-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(grid.arrange,<span class="fu">c</span>(plots, <span class="fu">list</span>(<span class="at">layout_matrix=</span><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>,<span class="dv">4</span>),<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>)),<span class="at">heights =</span> <span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.8</span>))))</span>
<span id="cb2-541"><a href="#cb2-541" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {<span class="fu">do.call</span>(grid.arrange,<span class="fu">c</span>(plots,<span class="fu">list</span>(<span class="at">nrow=</span><span class="dv">1</span>)))}</span>
<span id="cb2-542"><a href="#cb2-542" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-543"><a href="#cb2-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-544"><a href="#cb2-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-545"><a href="#cb2-545" aria-hidden="true" tabindex="-1"></a><span class="fu"># Wildfire simulations from the posterior distribution for the observation period (2006-2020) {#sec-sim}</span></span>
<span id="cb2-546"><a href="#cb2-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-547"><a href="#cb2-547" aria-hidden="true" tabindex="-1"></a>Before applying the fitted model to climate projections, we wish to assess the validity of our model. We here focus on the capacity of the model to reproduce the observed wildfires during the study period (2006-2020) with appropriate posterior uncertainty. R-INLA implements a method to obtain independent samples from the posterior distributions of hyperparameters and latent Gaussian variables, which can then be combined with new covariate data to calculate Monte-Carlo estimations of any posterior quantity of interest.</span>
<span id="cb2-548"><a href="#cb2-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-549"><a href="#cb2-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-550"><a href="#cb2-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-551"><a href="#cb2-551" aria-hidden="true" tabindex="-1"></a><span class="fu">## Occurrence component</span></span>
<span id="cb2-552"><a href="#cb2-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-553"><a href="#cb2-553" aria-hidden="true" tabindex="-1"></a>For the occurrence model, we first have to sample from the posterior distribution of all the coefficients in the occurrence model and then combine them with new effect values, using the additivity of @eq-matrices.</span>
<span id="cb2-554"><a href="#cb2-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-555"><a href="#cb2-555" aria-hidden="true" tabindex="-1"></a>Hereinafter, we perform $n=100$ simulations and results are depicted in @fig-res-occ. The top line panels depict the spatial patterns of observed and simulated fire occurrences. In the bottom line, the yearly aggregated occurrences are shown on the left. Then, we looked for a specific year the daily and weekly aggregation (middle and right panels) of simulated fire occurrences. We chose to examine the year $2010$, but any other year could have been considered.</span>
<span id="cb2-556"><a href="#cb2-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-557"><a href="#cb2-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-558"><a href="#cb2-558" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo =F}</span></span>
<span id="cb2-559"><a href="#cb2-559" aria-hidden="true" tabindex="-1"></a>nsample <span class="ot">=</span> <span class="dv">100</span> <span class="co"># number of simulations</span></span>
<span id="cb2-560"><a href="#cb2-560" aria-hidden="true" tabindex="-1"></a>projDF <span class="ot">=</span> DF[<span class="fu">order</span>(DF<span class="sc">$</span>PIX),]</span>
<span id="cb2-561"><a href="#cb2-561" aria-hidden="true" tabindex="-1"></a>projDF<span class="sc">$</span>FWI <span class="ot">=</span> projDF<span class="sc">$</span>FWI</span>
<span id="cb2-562"><a href="#cb2-562" aria-hidden="true" tabindex="-1"></a><span class="co"># constant extrapolation</span></span>
<span id="cb2-563"><a href="#cb2-563" aria-hidden="true" tabindex="-1"></a>projDF<span class="sc">$</span>FWI[projDF<span class="sc">$</span>FWI <span class="sc">&gt;</span> mesh_FWI<span class="sc">$</span>interval[<span class="dv">2</span>]] <span class="ot">=</span> mesh_FWI<span class="sc">$</span>interval[<span class="dv">2</span>]</span>
<span id="cb2-564"><a href="#cb2-564" aria-hidden="true" tabindex="-1"></a>id_SAFRAN <span class="ot">=</span> <span class="fu">unique</span>(projDF[,<span class="fu">c</span>(<span class="st">'PIX'</span>,<span class="st">'XL2e'</span>,<span class="st">'YL2e'</span>)])</span>
<span id="cb2-565"><a href="#cb2-565" aria-hidden="true" tabindex="-1"></a>coordinla_proj <span class="ot">=</span> <span class="fu">cbind</span>(id_SAFRAN<span class="sc">$</span>XL2e,id_SAFRAN<span class="sc">$</span>YL2e)<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span></span>
<span id="cb2-566"><a href="#cb2-566" aria-hidden="true" tabindex="-1"></a>sample <span class="ot">=</span> <span class="fu">inla.posterior.sample</span>(<span class="at">n =</span> nsample, <span class="at">result =</span> fit)</span>
<span id="cb2-567"><a href="#cb2-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-568"><a href="#cb2-568" aria-hidden="true" tabindex="-1"></a>x.comp<span class="ot">=</span><span class="fu">list</span>()</span>
<span id="cb2-569"><a href="#cb2-569" aria-hidden="true" tabindex="-1"></a>fixedEffectsId<span class="ot">=</span><span class="fu">rownames</span>(fit<span class="sc">$</span>summary.fixed)</span>
<span id="cb2-570"><a href="#cb2-570" aria-hidden="true" tabindex="-1"></a>eff <span class="ot">=</span> fixedEffectsId[<span class="dv">1</span>]</span>
<span id="cb2-571"><a href="#cb2-571" aria-hidden="true" tabindex="-1"></a>x.comp[[eff]] <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">inla.posterior.sample.eval</span>(eff, sample))</span>
<span id="cb2-572"><a href="#cb2-572" aria-hidden="true" tabindex="-1"></a>randomEffectsId<span class="ot">=</span><span class="fu">names</span>(fit<span class="sc">$</span>summary.random)</span>
<span id="cb2-573"><a href="#cb2-573" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (eff <span class="cf">in</span> randomEffectsId) {</span>
<span id="cb2-574"><a href="#cb2-574" aria-hidden="true" tabindex="-1"></a>  x.comp[[eff]] <span class="ot">=</span> <span class="fu">unname</span>(<span class="fu">inla.posterior.sample.eval</span>(eff, sample))</span>
<span id="cb2-575"><a href="#cb2-575" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-576"><a href="#cb2-576" aria-hidden="true" tabindex="-1"></a>randomEffectsId <span class="ot">=</span> randomEffectsId[randomEffectsId <span class="sc">!=</span> <span class="st">"YEAR"</span>]</span>
<span id="cb2-577"><a href="#cb2-577" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (eff <span class="cf">in</span> randomEffectsId){</span>
<span id="cb2-578"><a href="#cb2-578" aria-hidden="true" tabindex="-1"></a>  meshproj <span class="ot">=</span> <span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">"mesh_"</span>, eff))</span>
<span id="cb2-579"><a href="#cb2-579" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">str_detect</span>(eff,<span class="st">"spatial"</span>)){</span>
<span id="cb2-580"><a href="#cb2-580" aria-hidden="true" tabindex="-1"></a>    meshproj <span class="ot">=</span> <span class="fu">inla.mesh.projector</span>(meshproj,<span class="at">loc =</span> coordinla_proj)</span>
<span id="cb2-581"><a href="#cb2-581" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-582"><a href="#cb2-582" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>{meshproj <span class="ot">=</span> <span class="fu">inla.mesh.projector</span>(meshproj, <span class="at">loc =</span> projDF[,eff])}</span>
<span id="cb2-583"><a href="#cb2-583" aria-hidden="true" tabindex="-1"></a>  x.comp[[eff]]<span class="ot">=</span><span class="fu">inla.mesh.project</span>(meshproj, x.comp[[eff]])</span>
<span id="cb2-584"><a href="#cb2-584" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-585"><a href="#cb2-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-586"><a href="#cb2-586" aria-hidden="true" tabindex="-1"></a><span class="co"># Then simulation of fire occurrences:</span></span>
<span id="cb2-587"><a href="#cb2-587" aria-hidden="true" tabindex="-1"></a>niter2 <span class="ot">=</span> <span class="dv">100</span>; nsample2 <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb2-588"><a href="#cb2-588" aria-hidden="true" tabindex="-1"></a>projDF<span class="sc">$</span>Occur_sim <span class="ot">=</span> <span class="dv">1</span> <span class="co"># put them to 1 (only lines with actual fire will be   selected below)</span></span>
<span id="cb2-589"><a href="#cb2-589" aria-hidden="true" tabindex="-1"></a>Liste_occur <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb2-590"><a href="#cb2-590" aria-hidden="true" tabindex="-1"></a>all_lambdas <span class="ot">=</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="at">nrow =</span> <span class="fu">dim</span>(projDF)[<span class="dv">1</span>],<span class="at">ncol =</span> niter2)</span>
<span id="cb2-591"><a href="#cb2-591" aria-hidden="true" tabindex="-1"></a>lambdamean <span class="ot">=</span>  <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">dim</span>(projDF)[<span class="dv">1</span>])</span>
<span id="cb2-592"><a href="#cb2-592" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>niter2){</span>
<span id="cb2-593"><a href="#cb2-593" aria-hidden="true" tabindex="-1"></a>  <span class="co"># OFFSET</span></span>
<span id="cb2-594"><a href="#cb2-594" aria-hidden="true" tabindex="-1"></a>  x.proj <span class="ot">=</span> <span class="dv">0</span> <span class="co"># if offset, not the case here</span></span>
<span id="cb2-595"><a href="#cb2-595" aria-hidden="true" tabindex="-1"></a>  <span class="co"># FIXED EFFECTS</span></span>
<span id="cb2-596"><a href="#cb2-596" aria-hidden="true" tabindex="-1"></a>  fixedEffectsId<span class="ot">=</span><span class="fu">rownames</span>(fit<span class="sc">$</span>summary.fixed)</span>
<span id="cb2-597"><a href="#cb2-597" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(fixedEffectsId)<span class="sc">&gt;</span><span class="dv">0</span>) {</span>
<span id="cb2-598"><a href="#cb2-598" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (eff <span class="cf">in</span> fixedEffectsId) {</span>
<span id="cb2-599"><a href="#cb2-599" aria-hidden="true" tabindex="-1"></a>      x.proj <span class="ot">=</span> x.proj <span class="sc">+</span> <span class="fu">rep</span>(x.comp[[eff]][k], <span class="fu">dim</span>(projDF)[<span class="dv">1</span>])</span>
<span id="cb2-600"><a href="#cb2-600" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-601"><a href="#cb2-601" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-602"><a href="#cb2-602" aria-hidden="true" tabindex="-1"></a>  <span class="co"># RANDOM EFFECTS</span></span>
<span id="cb2-603"><a href="#cb2-603" aria-hidden="true" tabindex="-1"></a>  randomEffectsId<span class="ot">=</span><span class="fu">names</span>(fit<span class="sc">$</span>summary.random)</span>
<span id="cb2-604"><a href="#cb2-604" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(randomEffectsId)<span class="sc">&gt;</span><span class="dv">0</span>) {</span>
<span id="cb2-605"><a href="#cb2-605" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (eff <span class="cf">in</span> randomEffectsId) {</span>
<span id="cb2-606"><a href="#cb2-606" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">str_detect</span>(eff,<span class="st">"spatial"</span>)){</span>
<span id="cb2-607"><a href="#cb2-607" aria-hidden="true" tabindex="-1"></a>        idspat <span class="ot">=</span> <span class="fu">match</span>(projDF<span class="sc">$</span>PIX,<span class="fu">unique</span>(projDF<span class="sc">$</span>PIX))</span>
<span id="cb2-608"><a href="#cb2-608" aria-hidden="true" tabindex="-1"></a>        x.proj <span class="ot">=</span> x.proj <span class="sc">+</span> x.comp[[eff]][idspat,k]</span>
<span id="cb2-609"><a href="#cb2-609" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-610"><a href="#cb2-610" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>{</span>
<span id="cb2-611"><a href="#cb2-611" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (eff <span class="sc">==</span> <span class="st">"YEAR"</span>){</span>
<span id="cb2-612"><a href="#cb2-612" aria-hidden="true" tabindex="-1"></a>          idvar <span class="ot">=</span> projDF[[eff]] <span class="sc">-</span> <span class="dv">2005</span></span>
<span id="cb2-613"><a href="#cb2-613" aria-hidden="true" tabindex="-1"></a>          x.proj <span class="ot">=</span> x.proj <span class="sc">+</span> x.comp[[eff]][idvar,k]</span>
<span id="cb2-614"><a href="#cb2-614" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-615"><a href="#cb2-615" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>{</span>
<span id="cb2-616"><a href="#cb2-616" aria-hidden="true" tabindex="-1"></a>        x.proj <span class="ot">=</span> x.proj <span class="sc">+</span> x.comp[[eff]][,k]</span>
<span id="cb2-617"><a href="#cb2-617" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-618"><a href="#cb2-618" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-619"><a href="#cb2-619" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-620"><a href="#cb2-620" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-621"><a href="#cb2-621" aria-hidden="true" tabindex="-1"></a>  lambda <span class="ot">=</span> <span class="fu">exp</span>(x.proj)</span>
<span id="cb2-622"><a href="#cb2-622" aria-hidden="true" tabindex="-1"></a>  lambdamean <span class="ot">=</span> lambdamean <span class="sc">+</span> lambda<span class="sc">/</span>niter2</span>
<span id="cb2-623"><a href="#cb2-623" aria-hidden="true" tabindex="-1"></a>  all_lambdas[,k] <span class="ot">=</span> lambda</span>
<span id="cb2-624"><a href="#cb2-624" aria-hidden="true" tabindex="-1"></a>  lambdas <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(lambda,nsample2) ,<span class="at">nrow=</span><span class="fu">length</span>(lambda),<span class="at">ncol=</span>nsample2)</span>
<span id="cb2-625"><a href="#cb2-625" aria-hidden="true" tabindex="-1"></a>  Liste_occur<span class="ot">=</span><span class="fu">cbind</span>(Liste_occur,<span class="fu">apply</span>(lambdas,<span class="at">MARGIN =</span> <span class="dv">2</span>,poisson.sim.occ, <span class="at">Dat=</span>projDF))</span>
<span id="cb2-626"><a href="#cb2-626" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-627"><a href="#cb2-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-628"><a href="#cb2-628" aria-hidden="true" tabindex="-1"></a><span class="co"># Results:</span></span>
<span id="cb2-629"><a href="#cb2-629" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">=</span> <span class="fu">length</span>(Liste_occur)</span>
<span id="cb2-630"><a href="#cb2-630" aria-hidden="true" tabindex="-1"></a>nfireDFobstot<span class="ot">=</span><span class="fu">sum</span>(projDF<span class="sc">$</span>NB0<span class="fl">.1</span>)</span>
<span id="cb2-631"><a href="#cb2-631" aria-hidden="true" tabindex="-1"></a>nfiresim<span class="ot">=</span><span class="fu">rep</span>(<span class="dv">0</span>,nsim); <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim){nfiresim[i]<span class="ot">=</span><span class="fu">sum</span>(Liste_occur[[i]]<span class="sc">$</span>Occur_sim)}</span>
<span id="cb2-632"><a href="#cb2-632" aria-hidden="true" tabindex="-1"></a>nfireDFsimtot<span class="ot">=</span><span class="fu">mean</span>(nfiresim)</span>
<span id="cb2-633"><a href="#cb2-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-634"><a href="#cb2-634" aria-hidden="true" tabindex="-1"></a>projDF<span class="sc">$</span>lambda <span class="ot">=</span> lambdamean</span>
<span id="cb2-635"><a href="#cb2-635" aria-hidden="true" tabindex="-1"></a>l<span class="ot">=</span><span class="fu">list</span>(<span class="at">Liste_occur=</span>Liste_occur,<span class="at">nsim=</span>nsim)</span>
<span id="cb2-636"><a href="#cb2-636" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-637"><a href="#cb2-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-638"><a href="#cb2-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-639"><a href="#cb2-639" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo =F, fig.width=10,fig.height=6}</span></span>
<span id="cb2-640"><a href="#cb2-640" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-res-occ</span></span>
<span id="cb2-641"><a href="#cb2-641" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "top: Spatial patterns of observed wildfire occurrences (left) and simulated occurrences (right). bottom: Simulated wildfire occurrences with $95\\%$ pointwise confidence intervals (in red) and observations (black dots)."</span></span>
<span id="cb2-642"><a href="#cb2-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-643"><a href="#cb2-643" aria-hidden="true" tabindex="-1"></a>aggr.tot <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>PIX, projDF[,<span class="fu">c</span>(<span class="st">'PIX'</span>,<span class="st">'NB0.1'</span>,<span class="st">'lambda'</span>)], <span class="at">FUN =</span> sum)</span>
<span id="cb2-644"><a href="#cb2-644" aria-hidden="true" tabindex="-1"></a>upper.bound <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">max</span>(<span class="fu">c</span>(aggr.tot<span class="sc">$</span>NB0<span class="fl">.1</span>))) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-645"><a href="#cb2-645" aria-hidden="true" tabindex="-1"></a>idx_safran <span class="ot">=</span>  <span class="fu">match</span>(aggr.tot<span class="sc">$</span>PIX,coord<span class="sc">$</span>N_SAFRAN)</span>
<span id="cb2-646"><a href="#cb2-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-647"><a href="#cb2-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-648"><a href="#cb2-648" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">rbind</span>(<span class="fu">data.frame</span>(<span class="st">"NB"</span><span class="ot">=</span>aggr.tot<span class="sc">$</span>NB0<span class="fl">.1</span>,<span class="at">lab =</span> <span class="st">'Observations'</span>),<span class="fu">data.frame</span>(<span class="st">"NB"</span><span class="ot">=</span>aggr.tot<span class="sc">$</span>lambda,<span class="at">lab=</span><span class="st">"Simulations"</span>))</span>
<span id="cb2-649"><a href="#cb2-649" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>XL2e <span class="ot">=</span> <span class="fu">rep</span>(coord<span class="sc">$</span>XL2e[idx_safran],<span class="dv">2</span>)</span>
<span id="cb2-650"><a href="#cb2-650" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>YL2e <span class="ot">=</span> <span class="fu">rep</span>(coord<span class="sc">$</span>YL2e[idx_safran],<span class="dv">2</span>)</span>
<span id="cb2-651"><a href="#cb2-651" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="fu">ggplot</span>(data)<span class="sc">+</span></span>
<span id="cb2-652"><a href="#cb2-652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>XL2e,<span class="at">y=</span>YL2e,</span>
<span id="cb2-653"><a href="#cb2-653" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> NB),<span class="at">size=</span><span class="dv">3</span>,<span class="at">shape=</span><span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb2-654"><a href="#cb2-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>lab)<span class="sc">+</span></span>
<span id="cb2-655"><a href="#cb2-655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> departements,<span class="at">fill=</span><span class="st">"NA"</span>)<span class="sc">+</span></span>
<span id="cb2-656"><a href="#cb2-656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">default_crs=</span><span class="st">"+init=epsg:27572"</span>,<span class="at">xlim=</span><span class="fu">range</span>(coordinla[,<span class="dv">1</span>])<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>,</span>
<span id="cb2-657"><a href="#cb2-657" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylim=</span><span class="fu">range</span>(coordinla[,<span class="dv">2</span>])<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>)<span class="sc">+</span></span>
<span id="cb2-658"><a href="#cb2-658" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb2-659"><a href="#cb2-659" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">color=</span><span class="st">"Counts"</span>,</span>
<span id="cb2-660"><a href="#cb2-660" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">'Latitude'</span>, <span class="at">x =</span> <span class="st">'Longitude'</span>)<span class="sc">+</span></span>
<span id="cb2-661"><a href="#cb2-661" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">na.value =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb2-662"><a href="#cb2-662" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_colourbar</span>(<span class="at">barwidth =</span> <span class="dv">1</span>,<span class="at">barheight =</span> <span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb2-663"><a href="#cb2-663" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb2-664"><a href="#cb2-664" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb2-665"><a href="#cb2-665" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>),</span>
<span id="cb2-666"><a href="#cb2-666" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb2-667"><a href="#cb2-667" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>))</span>
<span id="cb2-668"><a href="#cb2-668" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(data)</span>
<span id="cb2-669"><a href="#cb2-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-670"><a href="#cb2-670" aria-hidden="true" tabindex="-1"></a><span class="do">## Temporal aggregation ----</span></span>
<span id="cb2-671"><a href="#cb2-671" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> projDF</span>
<span id="cb2-672"><a href="#cb2-672" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">=</span> l<span class="sc">$</span>nsim</span>
<span id="cb2-673"><a href="#cb2-673" aria-hidden="true" tabindex="-1"></a>NB.aggr <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow =</span> <span class="fu">length</span>(<span class="fu">unique</span>(df<span class="sc">$</span>YEAR)), <span class="at">ncol =</span> nsim <span class="sc">+</span> <span class="dv">2</span>))</span>
<span id="cb2-674"><a href="#cb2-674" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(NB.aggr) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'YEAR'</span>,<span class="st">'Obs'</span>, <span class="fu">paste0</span>(<span class="st">'sim'</span>,<span class="dv">1</span><span class="sc">:</span>nsim) )</span>
<span id="cb2-675"><a href="#cb2-675" aria-hidden="true" tabindex="-1"></a>NB.aggr[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)] <span class="ot">=</span> <span class="fu">as.matrix</span>(<span class="fu">aggregate</span>(.<span class="sc">~</span>YEAR,df[,<span class="fu">c</span>(<span class="st">'YEAR'</span>,<span class="st">'NB0.1'</span>)],<span class="at">FUN=</span>sum))</span>
<span id="cb2-676"><a href="#cb2-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-677"><a href="#cb2-677" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim){</span>
<span id="cb2-678"><a href="#cb2-678" aria-hidden="true" tabindex="-1"></a>  df_i <span class="ot">=</span> l<span class="sc">$</span>Liste_occur[[i]]</span>
<span id="cb2-679"><a href="#cb2-679" aria-hidden="true" tabindex="-1"></a>  aggr_i <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>YEAR,df_i[,<span class="fu">c</span>(<span class="st">'YEAR'</span>,<span class="st">'Occur_sim'</span>)],<span class="at">FUN=</span>sum)</span>
<span id="cb2-680"><a href="#cb2-680" aria-hidden="true" tabindex="-1"></a>  NB.aggr[<span class="fu">match</span>(aggr_i<span class="sc">$</span>YEAR, NB.aggr<span class="sc">$</span>YEAR), i<span class="sc">+</span><span class="dv">2</span>] <span class="ot">=</span> aggr_i<span class="sc">$</span>Occur_sim</span>
<span id="cb2-681"><a href="#cb2-681" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-682"><a href="#cb2-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-683"><a href="#cb2-683" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Mean <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> mean,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-684"><a href="#cb2-684" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Q025 <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> quantile,<span class="at">probs=</span><span class="fl">0.025</span>,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-685"><a href="#cb2-685" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Q0975 <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> quantile,<span class="at">probs=</span><span class="fl">0.975</span>,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-686"><a href="#cb2-686" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> NB.aggr)<span class="sc">+</span></span>
<span id="cb2-687"><a href="#cb2-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>YEAR,<span class="at">y=</span>Obs))<span class="sc">+</span></span>
<span id="cb2-688"><a href="#cb2-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>YEAR,<span class="at">y=</span>Mean),<span class="at">color=</span><span class="st">'red'</span>)<span class="sc">+</span></span>
<span id="cb2-689"><a href="#cb2-689" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x=</span>YEAR, <span class="at">ymin=</span>Q025,<span class="at">ymax=</span>Q0975),<span class="at">fill=</span><span class="st">"red"</span>, <span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb2-690"><a href="#cb2-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">'Number of fires &gt; 0.1 ha'</span>, <span class="at">x =</span> <span class="st">'Year'</span>)<span class="sc">+</span></span>
<span id="cb2-691"><a href="#cb2-691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb2-692"><a href="#cb2-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-693"><a href="#cb2-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-694"><a href="#cb2-694" aria-hidden="true" tabindex="-1"></a><span class="co"># daily aggregation for one specific year</span></span>
<span id="cb2-695"><a href="#cb2-695" aria-hidden="true" tabindex="-1"></a>year <span class="ot">=</span> <span class="dv">2010</span> <span class="co">#can be changed for another year</span></span>
<span id="cb2-696"><a href="#cb2-696" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> projDF</span>
<span id="cb2-697"><a href="#cb2-697" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Week <span class="ot">=</span> (df<span class="sc">$</span>DOY <span class="sc">%/%</span> <span class="dv">7</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-698"><a href="#cb2-698" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df[(df<span class="sc">$</span>YEAR <span class="sc">==</span> year),]</span>
<span id="cb2-699"><a href="#cb2-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-700"><a href="#cb2-700" aria-hidden="true" tabindex="-1"></a>NB.aggr <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow =</span> <span class="fu">length</span>(<span class="fu">unique</span>(df<span class="sc">$</span>DOY)), <span class="at">ncol =</span> nsim <span class="sc">+</span> <span class="dv">2</span>))</span>
<span id="cb2-701"><a href="#cb2-701" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(NB.aggr) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'DOY'</span>,<span class="st">'Obs'</span>, <span class="fu">paste0</span>(<span class="st">'sim'</span>,<span class="dv">1</span><span class="sc">:</span>nsim) )</span>
<span id="cb2-702"><a href="#cb2-702" aria-hidden="true" tabindex="-1"></a>NB.aggr[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)] <span class="ot">=</span> <span class="fu">as.matrix</span>(<span class="fu">aggregate</span>(.<span class="sc">~</span>DOY,df[,<span class="fu">c</span>(<span class="st">'DOY'</span>,<span class="st">'NB0.1'</span>)],<span class="at">FUN=</span>sum))</span>
<span id="cb2-703"><a href="#cb2-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-704"><a href="#cb2-704" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim){</span>
<span id="cb2-705"><a href="#cb2-705" aria-hidden="true" tabindex="-1"></a>  df_i <span class="ot">=</span> l<span class="sc">$</span>Liste_occur[[i]][l<span class="sc">$</span>Liste_occur[[i]]<span class="sc">$</span>YEAR <span class="sc">==</span> year,]</span>
<span id="cb2-706"><a href="#cb2-706" aria-hidden="true" tabindex="-1"></a>  aggr_i <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>DOY,df_i[,<span class="fu">c</span>(<span class="st">'DOY'</span>,<span class="st">'Occur_sim'</span>)],<span class="at">FUN=</span>sum)</span>
<span id="cb2-707"><a href="#cb2-707" aria-hidden="true" tabindex="-1"></a>  NB.aggr[<span class="fu">match</span>(aggr_i<span class="sc">$</span>DOY, NB.aggr<span class="sc">$</span>DOY), i<span class="sc">+</span><span class="dv">2</span>] <span class="ot">=</span> aggr_i<span class="sc">$</span>Occur_sim</span>
<span id="cb2-708"><a href="#cb2-708" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-709"><a href="#cb2-709" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Mean <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> mean,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-710"><a href="#cb2-710" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Q025 <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> quantile,<span class="at">probs=</span><span class="fl">0.025</span>,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-711"><a href="#cb2-711" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Q0975 <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> quantile,<span class="at">probs=</span><span class="fl">0.975</span>,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-712"><a href="#cb2-712" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> NB.aggr)<span class="sc">+</span></span>
<span id="cb2-713"><a href="#cb2-713" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>DOY,<span class="at">y=</span>Obs))<span class="sc">+</span></span>
<span id="cb2-714"><a href="#cb2-714" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>DOY,<span class="at">y=</span>Mean),<span class="at">color=</span><span class="st">'red'</span>)<span class="sc">+</span></span>
<span id="cb2-715"><a href="#cb2-715" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x=</span>DOY, <span class="at">ymin=</span>Q025,<span class="at">ymax=</span>Q0975),<span class="at">fill=</span><span class="st">"red"</span>, <span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb2-716"><a href="#cb2-716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">'Number of fires &gt; 0.1 ha'</span>, <span class="at">x =</span> <span class="st">'Day of the year'</span>,<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">'Year'</span>,year))<span class="sc">+</span></span>
<span id="cb2-717"><a href="#cb2-717" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb2-718"><a href="#cb2-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-719"><a href="#cb2-719" aria-hidden="true" tabindex="-1"></a><span class="co"># Same plot but on weekly scale</span></span>
<span id="cb2-720"><a href="#cb2-720" aria-hidden="true" tabindex="-1"></a>NB.aggr <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow =</span> <span class="fu">length</span>(<span class="fu">unique</span>(df<span class="sc">$</span>Week)), <span class="at">ncol =</span> nsim <span class="sc">+</span> <span class="dv">2</span>))</span>
<span id="cb2-721"><a href="#cb2-721" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(NB.aggr) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Week'</span>,<span class="st">'Obs'</span>, <span class="fu">paste0</span>(<span class="st">'sim'</span>,<span class="dv">1</span><span class="sc">:</span>nsim) )</span>
<span id="cb2-722"><a href="#cb2-722" aria-hidden="true" tabindex="-1"></a>NB.aggr[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)] <span class="ot">=</span> <span class="fu">as.matrix</span>(<span class="fu">aggregate</span>(.<span class="sc">~</span>Week,df[,<span class="fu">c</span>(<span class="st">'Week'</span>,<span class="st">'NB0.1'</span>)],<span class="at">FUN=</span>sum))</span>
<span id="cb2-723"><a href="#cb2-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-724"><a href="#cb2-724" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim){</span>
<span id="cb2-725"><a href="#cb2-725" aria-hidden="true" tabindex="-1"></a>  df_i <span class="ot">=</span> l<span class="sc">$</span>Liste_occur[[i]][l<span class="sc">$</span>Liste_occur[[i]]<span class="sc">$</span>YEAR <span class="sc">==</span> year,]</span>
<span id="cb2-726"><a href="#cb2-726" aria-hidden="true" tabindex="-1"></a>  df_i<span class="sc">$</span>Week <span class="ot">=</span> (df_i<span class="sc">$</span>DOY <span class="sc">%/%</span> <span class="dv">7</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-727"><a href="#cb2-727" aria-hidden="true" tabindex="-1"></a>  aggr_i <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>Week,df_i[,<span class="fu">c</span>(<span class="st">'Week'</span>,<span class="st">'Occur_sim'</span>)],<span class="at">FUN=</span>sum)</span>
<span id="cb2-728"><a href="#cb2-728" aria-hidden="true" tabindex="-1"></a>  NB.aggr[<span class="fu">match</span>(aggr_i<span class="sc">$</span>Week, NB.aggr<span class="sc">$</span>Week), i<span class="sc">+</span><span class="dv">2</span>] <span class="ot">=</span> aggr_i<span class="sc">$</span>Occur_sim</span>
<span id="cb2-729"><a href="#cb2-729" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-730"><a href="#cb2-730" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Mean <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> mean,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-731"><a href="#cb2-731" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Q025 <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> quantile,<span class="at">probs=</span><span class="fl">0.025</span>,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-732"><a href="#cb2-732" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Q0975 <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> quantile,<span class="at">probs=</span><span class="fl">0.975</span>,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-733"><a href="#cb2-733" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> NB.aggr)<span class="sc">+</span></span>
<span id="cb2-734"><a href="#cb2-734" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Week,<span class="at">y=</span>Obs))<span class="sc">+</span></span>
<span id="cb2-735"><a href="#cb2-735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Week,<span class="at">y=</span>Mean),<span class="at">color=</span><span class="st">'red'</span>)<span class="sc">+</span></span>
<span id="cb2-736"><a href="#cb2-736" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x=</span>Week, <span class="at">ymin=</span>Q025,<span class="at">ymax=</span>Q0975),<span class="at">fill=</span><span class="st">"red"</span>, <span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb2-737"><a href="#cb2-737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">'Number of fires &gt; 0.1 ha'</span>, <span class="at">x =</span> <span class="st">'Week of the year'</span>,<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">'Year'</span>,year))<span class="sc">+</span></span>
<span id="cb2-738"><a href="#cb2-738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb2-739"><a href="#cb2-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-740"><a href="#cb2-740" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1,p3,p4,p5, <span class="at">ncol=</span><span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">2</span>,<span class="at">layout_matrix=</span><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)),<span class="at">heights=</span><span class="fu">c</span>(<span class="fl">1.5</span>,<span class="dv">1</span>))</span>
<span id="cb2-741"><a href="#cb2-741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-742"><a href="#cb2-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-743"><a href="#cb2-743" aria-hidden="true" tabindex="-1"></a>@fig-res-occ highlights that the model successfully recovers both the spatial and temporal pattern of fire occurrences. Almost all observations are within the uncertainty bands of the posterior model. The temporal aggregations also highlights the temporal trends and stochasticity of wildfire regimes, with for instance a stronger fire activity at the end of August.</span>
<span id="cb2-744"><a href="#cb2-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-745"><a href="#cb2-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-746"><a href="#cb2-746" aria-hidden="true" tabindex="-1"></a><span class="fu">## Size component {#sec-sim-sizes}</span></span>
<span id="cb2-747"><a href="#cb2-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-748"><a href="#cb2-748" aria-hidden="true" tabindex="-1"></a>As for the occurrence model, we illustrate the applicability of our model through simulations and compare the simulated sizes with the historical data (see @fig-res-sizes). The simulation scheme is as follows: for each of the $100$ previously simulated samples of fire occurrences, we generate the associated sizes by sampling the posterior distributions of the fitted size model effects and use the additivity of the linear predictor as defined in @eq-size-model.</span>
<span id="cb2-749"><a href="#cb2-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-750"><a href="#cb2-750" aria-hidden="true" tabindex="-1"></a>Simulations are presented in @fig-res-sizes. Again, the spatial aggregation is shown in the top line panels. The yearly aggregated burnt areas are depicted in the bottom-left panel. Finally, the middle and right panels in the bottom line depict the weekly aggregated occurrences of fires greater than $1$ ha and $10$ ha respectively.</span>
<span id="cb2-751"><a href="#cb2-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-752"><a href="#cb2-752" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo =F}</span></span>
<span id="cb2-753"><a href="#cb2-753" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">=</span> l<span class="sc">$</span>nsim</span>
<span id="cb2-754"><a href="#cb2-754" aria-hidden="true" tabindex="-1"></a>Proj <span class="ot">=</span> l<span class="sc">$</span>Liste_occur</span>
<span id="cb2-755"><a href="#cb2-755" aria-hidden="true" tabindex="-1"></a>nsample.size <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb2-756"><a href="#cb2-756" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">=</span> fit.size<span class="sc">$</span>summary.hyperpar<span class="sc">$</span>mean[<span class="dv">1</span>]</span>
<span id="cb2-757"><a href="#cb2-757" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(Proj)){</span>
<span id="cb2-758"><a href="#cb2-758" aria-hidden="true" tabindex="-1"></a>  projDF.size <span class="ot">=</span> Proj[[i]]</span>
<span id="cb2-759"><a href="#cb2-759" aria-hidden="true" tabindex="-1"></a>  id_SAFRAN <span class="ot">=</span> <span class="fu">unique</span>(projDF.size[,<span class="fu">c</span>(<span class="st">'PIX'</span>,<span class="st">'XL2e'</span>,<span class="st">'YL2e'</span>)])</span>
<span id="cb2-760"><a href="#cb2-760" aria-hidden="true" tabindex="-1"></a>  coordinla_proj <span class="ot">=</span> <span class="fu">cbind</span>(id_SAFRAN<span class="sc">$</span>XL2e,id_SAFRAN<span class="sc">$</span>YL2e)<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span></span>
<span id="cb2-761"><a href="#cb2-761" aria-hidden="true" tabindex="-1"></a>  sample.size <span class="ot">=</span> <span class="fu">inla.posterior.sample</span>(<span class="at">n =</span> nsample.size, <span class="at">result =</span> fit.size)</span>
<span id="cb2-762"><a href="#cb2-762" aria-hidden="true" tabindex="-1"></a>  x.comp<span class="ot">=</span><span class="fu">list</span>()</span>
<span id="cb2-763"><a href="#cb2-763" aria-hidden="true" tabindex="-1"></a>  fixedEffectsId<span class="ot">=</span><span class="fu">rownames</span>(fit.size<span class="sc">$</span>summary.fixed)</span>
<span id="cb2-764"><a href="#cb2-764" aria-hidden="true" tabindex="-1"></a>  eff <span class="ot">=</span> fixedEffectsId[<span class="dv">1</span>]</span>
<span id="cb2-765"><a href="#cb2-765" aria-hidden="true" tabindex="-1"></a>  x.comp[[eff]] <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">inla.posterior.sample.eval</span>(eff, sample.size))</span>
<span id="cb2-766"><a href="#cb2-766" aria-hidden="true" tabindex="-1"></a>  randomEffectsId<span class="ot">=</span><span class="fu">names</span>(fit.size<span class="sc">$</span>summary.random)</span>
<span id="cb2-767"><a href="#cb2-767" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (eff <span class="cf">in</span> randomEffectsId) {</span>
<span id="cb2-768"><a href="#cb2-768" aria-hidden="true" tabindex="-1"></a>    x.comp[[eff]] <span class="ot">=</span> <span class="fu">unname</span>(<span class="fu">inla.posterior.sample.eval</span>(eff, sample.size))</span>
<span id="cb2-769"><a href="#cb2-769" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-770"><a href="#cb2-770" aria-hidden="true" tabindex="-1"></a>  randomEffectsId <span class="ot">=</span> randomEffectsId[randomEffectsId <span class="sc">!=</span> <span class="fu">c</span>(<span class="st">"YEAR"</span>,<span class="st">"DEP"</span>)]</span>
<span id="cb2-771"><a href="#cb2-771" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (eff <span class="cf">in</span> randomEffectsId){</span>
<span id="cb2-772"><a href="#cb2-772" aria-hidden="true" tabindex="-1"></a>    meshproj <span class="ot">=</span> <span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">"mesh_"</span>, eff))</span>
<span id="cb2-773"><a href="#cb2-773" aria-hidden="true" tabindex="-1"></a>    meshproj <span class="ot">=</span> <span class="fu">inla.mesh.projector</span>(meshproj, <span class="at">loc =</span> projDF.size[,eff])</span>
<span id="cb2-774"><a href="#cb2-774" aria-hidden="true" tabindex="-1"></a>    x.comp[[eff]]<span class="ot">=</span><span class="fu">inla.mesh.project</span>(meshproj, x.comp[[eff]])</span>
<span id="cb2-775"><a href="#cb2-775" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-776"><a href="#cb2-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-777"><a href="#cb2-777" aria-hidden="true" tabindex="-1"></a>  <span class="co"># OFFSET</span></span>
<span id="cb2-778"><a href="#cb2-778" aria-hidden="true" tabindex="-1"></a>  x.proj <span class="ot">=</span> <span class="dv">0</span> <span class="co"># if offset, not the case here</span></span>
<span id="cb2-779"><a href="#cb2-779" aria-hidden="true" tabindex="-1"></a>  <span class="co"># FIXED EFFECTS</span></span>
<span id="cb2-780"><a href="#cb2-780" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(fixedEffectsId)<span class="sc">&gt;</span><span class="dv">0</span>) {</span>
<span id="cb2-781"><a href="#cb2-781" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (eff <span class="cf">in</span> fixedEffectsId) {</span>
<span id="cb2-782"><a href="#cb2-782" aria-hidden="true" tabindex="-1"></a>      x.proj <span class="ot">=</span> x.proj <span class="sc">+</span> <span class="fu">rep</span>(x.comp[[eff]],<span class="fu">dim</span>(projDF.size)[<span class="dv">1</span>])</span>
<span id="cb2-783"><a href="#cb2-783" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-784"><a href="#cb2-784" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-785"><a href="#cb2-785" aria-hidden="true" tabindex="-1"></a>  <span class="co"># RANDOM EFFECTS</span></span>
<span id="cb2-786"><a href="#cb2-786" aria-hidden="true" tabindex="-1"></a>  randomEffectsId<span class="ot">=</span><span class="fu">names</span>(fit.size<span class="sc">$</span>summary.random)</span>
<span id="cb2-787"><a href="#cb2-787" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(randomEffectsId)<span class="sc">&gt;</span><span class="dv">0</span>) {</span>
<span id="cb2-788"><a href="#cb2-788" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (eff <span class="cf">in</span> randomEffectsId) {</span>
<span id="cb2-789"><a href="#cb2-789" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (eff <span class="sc">==</span> <span class="st">"YEAR"</span>){</span>
<span id="cb2-790"><a href="#cb2-790" aria-hidden="true" tabindex="-1"></a>        idvar <span class="ot">=</span> projDF.size[[eff]] <span class="sc">-</span> <span class="dv">2005</span></span>
<span id="cb2-791"><a href="#cb2-791" aria-hidden="true" tabindex="-1"></a>        x.proj <span class="ot">=</span> x.proj <span class="sc">+</span> x.comp[[eff]][idvar]</span>
<span id="cb2-792"><a href="#cb2-792" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (eff <span class="sc">==</span> <span class="st">"DEP"</span>){</span>
<span id="cb2-793"><a href="#cb2-793" aria-hidden="true" tabindex="-1"></a>        idvar <span class="ot">=</span> <span class="fu">match</span>(projDF.size[[eff]] ,dept[[<span class="dv">2</span>]])</span>
<span id="cb2-794"><a href="#cb2-794" aria-hidden="true" tabindex="-1"></a>        x.proj <span class="ot">=</span> x.proj <span class="sc">+</span> x.comp[[eff]][idvar]</span>
<span id="cb2-795"><a href="#cb2-795" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb2-796"><a href="#cb2-796" aria-hidden="true" tabindex="-1"></a>        x.proj <span class="ot">=</span> x.proj <span class="sc">+</span> x.comp[[eff]]</span>
<span id="cb2-797"><a href="#cb2-797" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-798"><a href="#cb2-798" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-799"><a href="#cb2-799" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-800"><a href="#cb2-800" aria-hidden="true" tabindex="-1"></a>  surf.sim <span class="ot">=</span> <span class="dv">0</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(projDF.size))</span>
<span id="cb2-801"><a href="#cb2-801" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">=</span> <span class="fu">exp</span>(x.proj)</span>
<span id="cb2-802"><a href="#cb2-802" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(projDF.size)){</span>
<span id="cb2-803"><a href="#cb2-803" aria-hidden="true" tabindex="-1"></a>    surf.sim[j] <span class="ot">=</span> <span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape=</span>phi,<span class="at">rate=</span>phi<span class="sc">/</span>mu[j])</span>
<span id="cb2-804"><a href="#cb2-804" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-805"><a href="#cb2-805" aria-hidden="true" tabindex="-1"></a>  idx.withrepl<span class="ot">=</span><span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(projDF.size),projDF.size<span class="sc">$</span>Occur_sim)</span>
<span id="cb2-806"><a href="#cb2-806" aria-hidden="true" tabindex="-1"></a>  Proj[[i]]<span class="sc">$</span>Surf_sim <span class="ot">=</span> <span class="fu">aggregate</span>(surf.sim,<span class="at">by=</span><span class="fu">list</span>(idx.withrepl),<span class="at">FUN=</span>sum)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-807"><a href="#cb2-807" aria-hidden="true" tabindex="-1"></a>  Proj[[i]]<span class="sc">$</span>N03_sim<span class="ot">=</span><span class="fu">aggregate</span>(surf.sim<span class="sc">&gt;=</span><span class="fl">0.3</span>,<span class="at">by=</span><span class="fu">list</span>(idx.withrepl),<span class="at">FUN=</span>sum)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-808"><a href="#cb2-808" aria-hidden="true" tabindex="-1"></a>  Proj[[i]]<span class="sc">$</span>N05_sim<span class="ot">=</span><span class="fu">aggregate</span>(surf.sim<span class="sc">&gt;=</span><span class="fl">0.5</span>,<span class="at">by=</span><span class="fu">list</span>(idx.withrepl),<span class="at">FUN=</span>sum)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-809"><a href="#cb2-809" aria-hidden="true" tabindex="-1"></a>  Proj[[i]]<span class="sc">$</span>N1_sim<span class="ot">=</span><span class="fu">aggregate</span>(surf.sim<span class="sc">&gt;=</span><span class="dv">1</span>,<span class="at">by=</span><span class="fu">list</span>(idx.withrepl),<span class="at">FUN=</span>sum)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-810"><a href="#cb2-810" aria-hidden="true" tabindex="-1"></a>  Proj[[i]]<span class="sc">$</span>N10_sim<span class="ot">=</span><span class="fu">aggregate</span>(surf.sim<span class="sc">&gt;=</span><span class="dv">10</span>,<span class="at">by=</span><span class="fu">list</span>(idx.withrepl),<span class="at">FUN=</span>sum)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-811"><a href="#cb2-811" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-812"><a href="#cb2-812" aria-hidden="true" tabindex="-1"></a>Liste_occur <span class="ot">=</span> Proj</span>
<span id="cb2-813"><a href="#cb2-813" aria-hidden="true" tabindex="-1"></a>surfsim<span class="ot">=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>nsim);<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim){surfsim[i]<span class="ot">=</span><span class="fu">sum</span>(Liste_occur[[i]]<span class="sc">$</span>Surf_sim)}</span>
<span id="cb2-814"><a href="#cb2-814" aria-hidden="true" tabindex="-1"></a>meansurfsim<span class="ot">=</span><span class="fu">mean</span>(surfsim,<span class="at">na.rm=</span>T)</span>
<span id="cb2-815"><a href="#cb2-815" aria-hidden="true" tabindex="-1"></a>surfsimobs <span class="ot">=</span> <span class="fu">sum</span>(DFsize<span class="sc">$</span>BA)</span>
<span id="cb2-816"><a href="#cb2-816" aria-hidden="true" tabindex="-1"></a>l.size <span class="ot">=</span> <span class="fu">list</span>(<span class="at">Liste_occur=</span>Liste_occur,<span class="at">nsim=</span>nsim)</span>
<span id="cb2-817"><a href="#cb2-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-818"><a href="#cb2-818" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-819"><a href="#cb2-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-820"><a href="#cb2-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-821"><a href="#cb2-821" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = F}</span></span>
<span id="cb2-822"><a href="#cb2-822" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> projDF</span>
<span id="cb2-823"><a href="#cb2-823" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">=</span> l.size<span class="sc">$</span>nsim</span>
<span id="cb2-824"><a href="#cb2-824" aria-hidden="true" tabindex="-1"></a>BA.aggr.ori <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow =</span> <span class="fu">length</span>(<span class="fu">unique</span>(df<span class="sc">$</span>YEAR)), <span class="at">ncol=</span>nsim<span class="sc">+</span><span class="dv">2</span>))</span>
<span id="cb2-825"><a href="#cb2-825" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(BA.aggr.ori) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'YEAR'</span>,<span class="st">'Obs'</span>, <span class="fu">paste0</span>(<span class="st">'sim'</span>,<span class="dv">1</span><span class="sc">:</span>nsim) )</span>
<span id="cb2-826"><a href="#cb2-826" aria-hidden="true" tabindex="-1"></a>BA.aggr.ori[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)] <span class="ot">=</span> <span class="fu">as.matrix</span>(<span class="fu">aggregate</span>(.<span class="sc">~</span>YEAR,df[,<span class="fu">c</span>(<span class="st">'YEAR'</span>,<span class="st">'BA'</span>)],<span class="at">FUN=</span>sum))</span>
<span id="cb2-827"><a href="#cb2-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-828"><a href="#cb2-828" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim){</span>
<span id="cb2-829"><a href="#cb2-829" aria-hidden="true" tabindex="-1"></a>  df_i <span class="ot">=</span> Proj[[i]]</span>
<span id="cb2-830"><a href="#cb2-830" aria-hidden="true" tabindex="-1"></a>  aggr_i <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>YEAR,df_i[,<span class="fu">c</span>(<span class="st">'YEAR'</span>,<span class="st">'Surf_sim'</span>)],<span class="at">FUN=</span>sum)</span>
<span id="cb2-831"><a href="#cb2-831" aria-hidden="true" tabindex="-1"></a>  BA.aggr.ori[<span class="fu">match</span>(aggr_i<span class="sc">$</span>YEAR, BA.aggr.ori<span class="sc">$</span>YEAR), i<span class="sc">+</span><span class="dv">2</span>] <span class="ot">=</span> aggr_i<span class="sc">$</span>Surf_sim</span>
<span id="cb2-832"><a href="#cb2-832" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-833"><a href="#cb2-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-834"><a href="#cb2-834" aria-hidden="true" tabindex="-1"></a>BA.aggr.ori<span class="sc">$</span>Mean <span class="ot">=</span> <span class="fu">apply</span>(BA.aggr.ori[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> mean,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-835"><a href="#cb2-835" aria-hidden="true" tabindex="-1"></a>BA.aggr.ori<span class="sc">$</span>Q025 <span class="ot">=</span> <span class="fu">apply</span>(BA.aggr.ori[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> quantile,<span class="at">probs=</span><span class="fl">0.025</span>,</span>
<span id="cb2-836"><a href="#cb2-836" aria-hidden="true" tabindex="-1"></a>                         <span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-837"><a href="#cb2-837" aria-hidden="true" tabindex="-1"></a>BA.aggr.ori<span class="sc">$</span>Q0975 <span class="ot">=</span> <span class="fu">apply</span>(BA.aggr.ori[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> quantile,<span class="at">probs=</span><span class="fl">0.975</span>,</span>
<span id="cb2-838"><a href="#cb2-838" aria-hidden="true" tabindex="-1"></a>                          <span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-839"><a href="#cb2-839" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> BA.aggr.ori)<span class="sc">+</span></span>
<span id="cb2-840"><a href="#cb2-840" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>YEAR,<span class="at">y=</span>Obs))<span class="sc">+</span></span>
<span id="cb2-841"><a href="#cb2-841" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>YEAR,<span class="at">y=</span>Mean),<span class="at">color=</span><span class="st">'red'</span>)<span class="sc">+</span></span>
<span id="cb2-842"><a href="#cb2-842" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x=</span>YEAR, <span class="at">ymin=</span>Q025,<span class="at">ymax=</span>Q0975),<span class="at">fill=</span><span class="st">"red"</span>, <span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb2-843"><a href="#cb2-843" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">'Burnt area (ha)'</span>, <span class="at">x =</span> <span class="st">'Year'</span>)<span class="sc">+</span></span>
<span id="cb2-844"><a href="#cb2-844" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb2-845"><a href="#cb2-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-846"><a href="#cb2-846" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-847"><a href="#cb2-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-848"><a href="#cb2-848" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo =F,fig.width=10,fig.height=6}</span></span>
<span id="cb2-849"><a href="#cb2-849" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-res-sizes</span></span>
<span id="cb2-850"><a href="#cb2-850" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "top: Spatial patterns of observed wildfire sizes (left) and simulated sizes (right). bottom: Simulated wildfire sizes with $95\\%$ pointwise confidence intervals (in red) and observations (black dots)."</span></span>
<span id="cb2-851"><a href="#cb2-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-852"><a href="#cb2-852" aria-hidden="true" tabindex="-1"></a>missing.pix <span class="ot">=</span> coord[coord<span class="sc">$</span>N_SAFRAN <span class="sc">%in%</span> <span class="fu">setdiff</span>(<span class="fu">unique</span>(DF<span class="sc">$</span>PIX),<span class="fu">unique</span>(DFsize<span class="sc">$</span>PIX)),<span class="st">'N_SAFRAN'</span>]</span>
<span id="cb2-853"><a href="#cb2-853" aria-hidden="true" tabindex="-1"></a><span class="co"># We add the missing pixels by setting BA = 0 for such pixels</span></span>
<span id="cb2-854"><a href="#cb2-854" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">rbind</span>(DFsize[,<span class="fu">c</span>(<span class="st">'PIX'</span>,<span class="st">'BA'</span>)],<span class="fu">data.frame</span>(<span class="st">'PIX'</span><span class="ot">=</span>missing.pix,<span class="st">'BA'</span><span class="ot">=</span><span class="dv">0</span>))</span>
<span id="cb2-855"><a href="#cb2-855" aria-hidden="true" tabindex="-1"></a>BA.aggr <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>PIX, df[,<span class="fu">c</span>(<span class="st">'PIX'</span>,<span class="st">'BA'</span>)],<span class="at">FUN=</span>sum)</span>
<span id="cb2-856"><a href="#cb2-856" aria-hidden="true" tabindex="-1"></a>coord.plot <span class="ot">=</span> coord[coord<span class="sc">$</span>N_SAFRAN <span class="sc">%in%</span> BA.aggr<span class="sc">$</span>PIX,<span class="fu">c</span>(<span class="st">'XL2e'</span>,<span class="st">'YL2e'</span>)]</span>
<span id="cb2-857"><a href="#cb2-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-858"><a href="#cb2-858" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">=</span> l.size<span class="sc">$</span>nsim</span>
<span id="cb2-859"><a href="#cb2-859" aria-hidden="true" tabindex="-1"></a>BA.aggr.big <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow =</span> <span class="fu">length</span>(BA.aggr<span class="sc">$</span>PIX), <span class="at">ncol =</span> nsim <span class="sc">+</span> <span class="dv">2</span>))</span>
<span id="cb2-860"><a href="#cb2-860" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(BA.aggr.big) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'PIX'</span>,<span class="st">'Obs'</span>, <span class="fu">paste0</span>(<span class="st">'sim'</span>,<span class="dv">1</span><span class="sc">:</span>nsim) )</span>
<span id="cb2-861"><a href="#cb2-861" aria-hidden="true" tabindex="-1"></a>BA.aggr.big[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)] <span class="ot">=</span> BA.aggr</span>
<span id="cb2-862"><a href="#cb2-862" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim){</span>
<span id="cb2-863"><a href="#cb2-863" aria-hidden="true" tabindex="-1"></a>  df_i <span class="ot">=</span> l.size<span class="sc">$</span>Liste_occur[[i]]</span>
<span id="cb2-864"><a href="#cb2-864" aria-hidden="true" tabindex="-1"></a>  aggr_i <span class="ot">=</span>  <span class="fu">aggregate</span>(.<span class="sc">~</span>PIX, df_i[,<span class="fu">c</span>(<span class="st">'PIX'</span>,<span class="st">'Surf_sim'</span>)],<span class="at">FUN=</span>sum)</span>
<span id="cb2-865"><a href="#cb2-865" aria-hidden="true" tabindex="-1"></a>  BA.aggr.big[<span class="fu">match</span>(aggr_i<span class="sc">$</span>PIX, BA.aggr.big<span class="sc">$</span>PIX), i<span class="sc">+</span><span class="dv">2</span>] <span class="ot">=</span> aggr_i<span class="sc">$</span>Surf_sim</span>
<span id="cb2-866"><a href="#cb2-866" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-867"><a href="#cb2-867" aria-hidden="true" tabindex="-1"></a><span class="co"># mean over all estimations:</span></span>
<span id="cb2-868"><a href="#cb2-868" aria-hidden="true" tabindex="-1"></a>BA.mean <span class="ot">=</span> <span class="fu">apply</span>(BA.aggr.big[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN=</span>mean,<span class="at">MARGIN=</span><span class="dv">1</span>)</span>
<span id="cb2-869"><a href="#cb2-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-870"><a href="#cb2-870" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">rbind</span>(<span class="fu">data.frame</span>(BA.aggr,<span class="at">lab =</span> <span class="st">'Observations'</span>),<span class="fu">data.frame</span>(<span class="st">"PIX"</span><span class="ot">=</span>BA.aggr<span class="sc">$</span>PIX,<span class="st">"BA"</span><span class="ot">=</span>BA.mean,<span class="at">lab=</span><span class="st">"Simulations"</span>))</span>
<span id="cb2-871"><a href="#cb2-871" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>XL2e <span class="ot">=</span> <span class="fu">rep</span>(coord.plot[,<span class="dv">1</span>],<span class="dv">2</span>)</span>
<span id="cb2-872"><a href="#cb2-872" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>YL2e <span class="ot">=</span> <span class="fu">rep</span>(coord.plot[,<span class="dv">2</span>],<span class="dv">2</span>)</span>
<span id="cb2-873"><a href="#cb2-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-874"><a href="#cb2-874" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="fu">ggplot</span>(data)<span class="sc">+</span></span>
<span id="cb2-875"><a href="#cb2-875" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>XL2e,<span class="at">y=</span>YL2e,</span>
<span id="cb2-876"><a href="#cb2-876" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="fu">cut</span>(BA, <span class="at">breaks=</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">15</span>,<span class="dv">50</span>,<span class="dv">175</span>,<span class="dv">350</span>,<span class="fu">max</span>(BA)),<span class="at">include.lowest=</span><span class="cn">TRUE</span>)),<span class="at">size=</span><span class="dv">3</span>,<span class="at">shape=</span><span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb2-877"><a href="#cb2-877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>lab)<span class="sc">+</span></span>
<span id="cb2-878"><a href="#cb2-878" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> departements,<span class="at">fill=</span><span class="st">"NA"</span>)<span class="sc">+</span></span>
<span id="cb2-879"><a href="#cb2-879" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">default_crs=</span><span class="st">"+init=epsg:27572"</span>,<span class="at">xlim=</span><span class="fu">range</span>(coordinla[,<span class="dv">1</span>])<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>,</span>
<span id="cb2-880"><a href="#cb2-880" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylim=</span><span class="fu">range</span>(coordinla[,<span class="dv">2</span>])<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>)<span class="sc">+</span></span>
<span id="cb2-881"><a href="#cb2-881" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb2-882"><a href="#cb2-882" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">color=</span><span class="st">"Burnt area"</span>,</span>
<span id="cb2-883"><a href="#cb2-883" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">'Latitude'</span>, <span class="at">x =</span> <span class="st">'Longitude'</span>)<span class="sc">+</span></span>
<span id="cb2-884"><a href="#cb2-884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="at">na.value =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb2-885"><a href="#cb2-885" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size=</span><span class="dv">5</span>)))<span class="sc">+</span></span>
<span id="cb2-886"><a href="#cb2-886" aria-hidden="true" tabindex="-1"></a>  <span class="co"># guides(color = guide_colourbar(barwidth = 1,barheight = 10))+</span></span>
<span id="cb2-887"><a href="#cb2-887" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb2-888"><a href="#cb2-888" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb2-889"><a href="#cb2-889" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>),</span>
<span id="cb2-890"><a href="#cb2-890" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb2-891"><a href="#cb2-891" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>))</span>
<span id="cb2-892"><a href="#cb2-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-893"><a href="#cb2-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-894"><a href="#cb2-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-895"><a href="#cb2-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-896"><a href="#cb2-896" aria-hidden="true" tabindex="-1"></a><span class="co"># Occurrences given threshold on BA: Weekly aggregation for one specific year</span></span>
<span id="cb2-897"><a href="#cb2-897" aria-hidden="true" tabindex="-1"></a>year <span class="ot">=</span> <span class="dv">2010</span> <span class="co">#can be changed for another year</span></span>
<span id="cb2-898"><a href="#cb2-898" aria-hidden="true" tabindex="-1"></a>thresh <span class="ot">=</span> <span class="fl">0.3</span></span>
<span id="cb2-899"><a href="#cb2-899" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> DFsize[DFsize<span class="sc">$</span>BA <span class="sc">&gt;=</span> thresh,]</span>
<span id="cb2-900"><a href="#cb2-900" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Week <span class="ot">=</span> (df<span class="sc">$</span>DOY <span class="sc">%/%</span> <span class="dv">7</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-901"><a href="#cb2-901" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df[df<span class="sc">$</span>YEAR <span class="sc">==</span> year,]</span>
<span id="cb2-902"><a href="#cb2-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-903"><a href="#cb2-903" aria-hidden="true" tabindex="-1"></a>NB.aggr <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow =</span> <span class="fu">length</span>(<span class="dv">22</span><span class="sc">:</span><span class="dv">45</span>), <span class="at">ncol =</span> nsim <span class="sc">+</span> <span class="dv">2</span>))</span>
<span id="cb2-904"><a href="#cb2-904" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(NB.aggr) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Week'</span>,<span class="st">'Obs'</span>, <span class="fu">paste0</span>(<span class="st">'sim'</span>,<span class="dv">1</span><span class="sc">:</span>nsim) )</span>
<span id="cb2-905"><a href="#cb2-905" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Week <span class="ot">=</span> <span class="dv">22</span><span class="sc">:</span><span class="dv">45</span></span>
<span id="cb2-906"><a href="#cb2-906" aria-hidden="true" tabindex="-1"></a>aggr <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>Week,df[,<span class="fu">c</span>(<span class="st">'Week'</span>,<span class="st">'NB0.1'</span>)],<span class="at">FUN=</span>sum)</span>
<span id="cb2-907"><a href="#cb2-907" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Obs[<span class="fu">match</span>(aggr<span class="sc">$</span>Week,NB.aggr<span class="sc">$</span>Week)] <span class="ot">=</span> aggr<span class="sc">$</span>NB0<span class="fl">.1</span></span>
<span id="cb2-908"><a href="#cb2-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-909"><a href="#cb2-909" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim){</span>
<span id="cb2-910"><a href="#cb2-910" aria-hidden="true" tabindex="-1"></a>  df_i <span class="ot">=</span> l.size<span class="sc">$</span>Liste_occur[[i]][l.size<span class="sc">$</span>Liste_occur[[i]]<span class="sc">$</span>YEAR <span class="sc">==</span> year,]</span>
<span id="cb2-911"><a href="#cb2-911" aria-hidden="true" tabindex="-1"></a>  df_i<span class="sc">$</span>Week <span class="ot">=</span> (df_i<span class="sc">$</span>DOY <span class="sc">%/%</span> <span class="dv">7</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-912"><a href="#cb2-912" aria-hidden="true" tabindex="-1"></a>  aggr_i <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>Week,df_i[,<span class="fu">c</span>(<span class="st">'Week'</span>,<span class="st">'N03_sim'</span>)],<span class="at">FUN=</span>sum)</span>
<span id="cb2-913"><a href="#cb2-913" aria-hidden="true" tabindex="-1"></a>  aggr_i <span class="ot">=</span> aggr_i[<span class="fu">order</span>(aggr_i<span class="sc">$</span>Week),]</span>
<span id="cb2-914"><a href="#cb2-914" aria-hidden="true" tabindex="-1"></a>  NB.aggr[<span class="fu">match</span>(aggr_i<span class="sc">$</span>Week, NB.aggr<span class="sc">$</span>Week), i<span class="sc">+</span><span class="dv">2</span>] <span class="ot">=</span> aggr_i<span class="sc">$</span>N03_sim</span>
<span id="cb2-915"><a href="#cb2-915" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-916"><a href="#cb2-916" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Mean <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> mean,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-917"><a href="#cb2-917" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Q025 <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> quantile,<span class="at">probs=</span><span class="fl">0.025</span>,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-918"><a href="#cb2-918" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Q0975 <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> quantile,<span class="at">probs=</span><span class="fl">0.975</span>,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-919"><a href="#cb2-919" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> NB.aggr)<span class="sc">+</span></span>
<span id="cb2-920"><a href="#cb2-920" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Week,<span class="at">y=</span>Obs))<span class="sc">+</span></span>
<span id="cb2-921"><a href="#cb2-921" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Week,<span class="at">y=</span>Mean),<span class="at">color=</span><span class="st">'red'</span>)<span class="sc">+</span></span>
<span id="cb2-922"><a href="#cb2-922" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x=</span>Week, <span class="at">ymin=</span>Q025,<span class="at">ymax=</span>Q0975),<span class="at">fill=</span><span class="st">"red"</span>, <span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb2-923"><a href="#cb2-923" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">'Number of fires &gt; 0.3 ha'</span>, <span class="at">x =</span> <span class="st">'Week of the year'</span>,<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">'Year'</span>,year))<span class="sc">+</span></span>
<span id="cb2-924"><a href="#cb2-924" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb2-925"><a href="#cb2-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-926"><a href="#cb2-926" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb2-927"><a href="#cb2-927" aria-hidden="true" tabindex="-1"></a>thresh <span class="ot">=</span> <span class="fl">0.5</span></span>
<span id="cb2-928"><a href="#cb2-928" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> DFsize[DFsize<span class="sc">$</span>BA <span class="sc">&gt;=</span> thresh,]</span>
<span id="cb2-929"><a href="#cb2-929" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Week <span class="ot">=</span> (df<span class="sc">$</span>DOY <span class="sc">%/%</span> <span class="dv">7</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-930"><a href="#cb2-930" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df[df<span class="sc">$</span>YEAR <span class="sc">==</span> year,]</span>
<span id="cb2-931"><a href="#cb2-931" aria-hidden="true" tabindex="-1"></a>NB.aggr <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow =</span> <span class="fu">length</span>(<span class="dv">22</span><span class="sc">:</span><span class="dv">45</span>), <span class="at">ncol =</span> nsim <span class="sc">+</span> <span class="dv">2</span>))</span>
<span id="cb2-932"><a href="#cb2-932" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(NB.aggr) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Week'</span>,<span class="st">'Obs'</span>, <span class="fu">paste0</span>(<span class="st">'sim'</span>,<span class="dv">1</span><span class="sc">:</span>nsim) )</span>
<span id="cb2-933"><a href="#cb2-933" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Week <span class="ot">=</span> <span class="dv">22</span><span class="sc">:</span><span class="dv">45</span></span>
<span id="cb2-934"><a href="#cb2-934" aria-hidden="true" tabindex="-1"></a>aggr <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>Week,df[,<span class="fu">c</span>(<span class="st">'Week'</span>,<span class="st">'NB0.1'</span>)],<span class="at">FUN=</span>sum)</span>
<span id="cb2-935"><a href="#cb2-935" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Obs[<span class="fu">match</span>(aggr<span class="sc">$</span>Week,NB.aggr<span class="sc">$</span>Week)] <span class="ot">=</span> aggr<span class="sc">$</span>NB0<span class="fl">.1</span></span>
<span id="cb2-936"><a href="#cb2-936" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim){</span>
<span id="cb2-937"><a href="#cb2-937" aria-hidden="true" tabindex="-1"></a>  df_i <span class="ot">=</span> l.size<span class="sc">$</span>Liste_occur[[i]][l.size<span class="sc">$</span>Liste_occur[[i]]<span class="sc">$</span>YEAR <span class="sc">==</span> year,]</span>
<span id="cb2-938"><a href="#cb2-938" aria-hidden="true" tabindex="-1"></a>  df_i<span class="sc">$</span>Week <span class="ot">=</span> (df_i<span class="sc">$</span>DOY <span class="sc">%/%</span> <span class="dv">7</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-939"><a href="#cb2-939" aria-hidden="true" tabindex="-1"></a>  aggr_i <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>Week,df_i[,<span class="fu">c</span>(<span class="st">'Week'</span>,<span class="st">'N05_sim'</span>)],<span class="at">FUN=</span>sum)</span>
<span id="cb2-940"><a href="#cb2-940" aria-hidden="true" tabindex="-1"></a>  aggr_i <span class="ot">=</span> aggr_i[<span class="fu">order</span>(aggr_i<span class="sc">$</span>Week),]</span>
<span id="cb2-941"><a href="#cb2-941" aria-hidden="true" tabindex="-1"></a>  NB.aggr[<span class="fu">match</span>(aggr_i<span class="sc">$</span>Week, NB.aggr<span class="sc">$</span>Week), i<span class="sc">+</span><span class="dv">2</span>] <span class="ot">=</span> aggr_i<span class="sc">$</span>N05_sim</span>
<span id="cb2-942"><a href="#cb2-942" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-943"><a href="#cb2-943" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Mean <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> mean,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-944"><a href="#cb2-944" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Q025 <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> quantile,<span class="at">probs=</span><span class="fl">0.025</span>,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-945"><a href="#cb2-945" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Q0975 <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> quantile,<span class="at">probs=</span><span class="fl">0.975</span>,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-946"><a href="#cb2-946" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> NB.aggr)<span class="sc">+</span></span>
<span id="cb2-947"><a href="#cb2-947" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Week,<span class="at">y=</span>Obs))<span class="sc">+</span></span>
<span id="cb2-948"><a href="#cb2-948" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Week,<span class="at">y=</span>Mean),<span class="at">color=</span><span class="st">'red'</span>)<span class="sc">+</span></span>
<span id="cb2-949"><a href="#cb2-949" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x=</span>Week, <span class="at">ymin=</span>Q025,<span class="at">ymax=</span>Q0975),<span class="at">fill=</span><span class="st">"red"</span>, <span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb2-950"><a href="#cb2-950" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">'Number of fires &gt; 0.5 ha'</span>, <span class="at">x =</span> <span class="st">'Week of the year'</span>,<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">'Year'</span>,year))<span class="sc">+</span></span>
<span id="cb2-951"><a href="#cb2-951" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb2-952"><a href="#cb2-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-953"><a href="#cb2-953" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb2-954"><a href="#cb2-954" aria-hidden="true" tabindex="-1"></a>thresh <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb2-955"><a href="#cb2-955" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> DFsize[DFsize<span class="sc">$</span>BA <span class="sc">&gt;=</span> thresh,]</span>
<span id="cb2-956"><a href="#cb2-956" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Week <span class="ot">=</span> (df<span class="sc">$</span>DOY <span class="sc">%/%</span> <span class="dv">7</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-957"><a href="#cb2-957" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df[df<span class="sc">$</span>YEAR <span class="sc">==</span> year,]</span>
<span id="cb2-958"><a href="#cb2-958" aria-hidden="true" tabindex="-1"></a>NB.aggr <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow =</span> <span class="fu">length</span>(<span class="dv">22</span><span class="sc">:</span><span class="dv">45</span>), <span class="at">ncol =</span> nsim <span class="sc">+</span> <span class="dv">2</span>))</span>
<span id="cb2-959"><a href="#cb2-959" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(NB.aggr) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Week'</span>,<span class="st">'Obs'</span>, <span class="fu">paste0</span>(<span class="st">'sim'</span>,<span class="dv">1</span><span class="sc">:</span>nsim) )</span>
<span id="cb2-960"><a href="#cb2-960" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Week <span class="ot">=</span> <span class="dv">22</span><span class="sc">:</span><span class="dv">45</span></span>
<span id="cb2-961"><a href="#cb2-961" aria-hidden="true" tabindex="-1"></a>aggr <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>Week,df[,<span class="fu">c</span>(<span class="st">'Week'</span>,<span class="st">'NB0.1'</span>)],<span class="at">FUN=</span>sum)</span>
<span id="cb2-962"><a href="#cb2-962" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Obs[<span class="fu">match</span>(aggr<span class="sc">$</span>Week,NB.aggr<span class="sc">$</span>Week)] <span class="ot">=</span> aggr<span class="sc">$</span>NB0<span class="fl">.1</span></span>
<span id="cb2-963"><a href="#cb2-963" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim){</span>
<span id="cb2-964"><a href="#cb2-964" aria-hidden="true" tabindex="-1"></a>  df_i <span class="ot">=</span> l.size<span class="sc">$</span>Liste_occur[[i]][l.size<span class="sc">$</span>Liste_occur[[i]]<span class="sc">$</span>YEAR <span class="sc">==</span> year,]</span>
<span id="cb2-965"><a href="#cb2-965" aria-hidden="true" tabindex="-1"></a>  df_i<span class="sc">$</span>Week <span class="ot">=</span> (df_i<span class="sc">$</span>DOY <span class="sc">%/%</span> <span class="dv">7</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-966"><a href="#cb2-966" aria-hidden="true" tabindex="-1"></a>  aggr_i <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>Week,df_i[,<span class="fu">c</span>(<span class="st">'Week'</span>,<span class="st">'N1_sim'</span>)],<span class="at">FUN=</span>sum)</span>
<span id="cb2-967"><a href="#cb2-967" aria-hidden="true" tabindex="-1"></a>  aggr_i <span class="ot">=</span> aggr_i[<span class="fu">order</span>(aggr_i<span class="sc">$</span>Week),]</span>
<span id="cb2-968"><a href="#cb2-968" aria-hidden="true" tabindex="-1"></a>  NB.aggr[<span class="fu">match</span>(aggr_i<span class="sc">$</span>Week, NB.aggr<span class="sc">$</span>Week), i<span class="sc">+</span><span class="dv">2</span>] <span class="ot">=</span> aggr_i<span class="sc">$</span>N1_sim</span>
<span id="cb2-969"><a href="#cb2-969" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-970"><a href="#cb2-970" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Mean <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> mean,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-971"><a href="#cb2-971" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Q025 <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> quantile,<span class="at">probs=</span><span class="fl">0.025</span>,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-972"><a href="#cb2-972" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Q0975 <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> quantile,<span class="at">probs=</span><span class="fl">0.975</span>,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-973"><a href="#cb2-973" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> NB.aggr)<span class="sc">+</span></span>
<span id="cb2-974"><a href="#cb2-974" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Week,<span class="at">y=</span>Obs))<span class="sc">+</span></span>
<span id="cb2-975"><a href="#cb2-975" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Week,<span class="at">y=</span>Mean),<span class="at">color=</span><span class="st">'red'</span>)<span class="sc">+</span></span>
<span id="cb2-976"><a href="#cb2-976" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x=</span>Week, <span class="at">ymin=</span>Q025,<span class="at">ymax=</span>Q0975),<span class="at">fill=</span><span class="st">"red"</span>, <span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb2-977"><a href="#cb2-977" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">'Number of fires &gt; 1 ha'</span>, <span class="at">x =</span> <span class="st">'Week of the year'</span>,<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">'Year'</span>,year))<span class="sc">+</span></span>
<span id="cb2-978"><a href="#cb2-978" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb2-979"><a href="#cb2-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-980"><a href="#cb2-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-981"><a href="#cb2-981" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb2-982"><a href="#cb2-982" aria-hidden="true" tabindex="-1"></a>thresh <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb2-983"><a href="#cb2-983" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> DFsize[DFsize<span class="sc">$</span>BA <span class="sc">&gt;=</span> thresh,]</span>
<span id="cb2-984"><a href="#cb2-984" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>Week <span class="ot">=</span> (df<span class="sc">$</span>DOY <span class="sc">%/%</span> <span class="dv">7</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-985"><a href="#cb2-985" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df[df<span class="sc">$</span>YEAR <span class="sc">==</span> year,]</span>
<span id="cb2-986"><a href="#cb2-986" aria-hidden="true" tabindex="-1"></a>NB.aggr <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow =</span> <span class="fu">length</span>(<span class="dv">22</span><span class="sc">:</span><span class="dv">45</span>), <span class="at">ncol =</span> nsim <span class="sc">+</span> <span class="dv">2</span>))</span>
<span id="cb2-987"><a href="#cb2-987" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(NB.aggr) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Week'</span>,<span class="st">'Obs'</span>, <span class="fu">paste0</span>(<span class="st">'sim'</span>,<span class="dv">1</span><span class="sc">:</span>nsim) )</span>
<span id="cb2-988"><a href="#cb2-988" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Week <span class="ot">=</span> <span class="dv">22</span><span class="sc">:</span><span class="dv">45</span></span>
<span id="cb2-989"><a href="#cb2-989" aria-hidden="true" tabindex="-1"></a>aggr <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>Week,df[,<span class="fu">c</span>(<span class="st">'Week'</span>,<span class="st">'NB0.1'</span>)],<span class="at">FUN=</span>sum)</span>
<span id="cb2-990"><a href="#cb2-990" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Obs[<span class="fu">match</span>(aggr<span class="sc">$</span>Week,NB.aggr<span class="sc">$</span>Week)] <span class="ot">=</span> aggr<span class="sc">$</span>NB0<span class="fl">.1</span></span>
<span id="cb2-991"><a href="#cb2-991" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim){</span>
<span id="cb2-992"><a href="#cb2-992" aria-hidden="true" tabindex="-1"></a>  df_i <span class="ot">=</span> l.size<span class="sc">$</span>Liste_occur[[i]][l.size<span class="sc">$</span>Liste_occur[[i]]<span class="sc">$</span>YEAR <span class="sc">==</span> year,]</span>
<span id="cb2-993"><a href="#cb2-993" aria-hidden="true" tabindex="-1"></a>  df_i<span class="sc">$</span>Week <span class="ot">=</span> (df_i<span class="sc">$</span>DOY <span class="sc">%/%</span> <span class="dv">7</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-994"><a href="#cb2-994" aria-hidden="true" tabindex="-1"></a>  aggr_i <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>Week,df_i[,<span class="fu">c</span>(<span class="st">'Week'</span>,<span class="st">'N10_sim'</span>)],<span class="at">FUN=</span>sum)</span>
<span id="cb2-995"><a href="#cb2-995" aria-hidden="true" tabindex="-1"></a>  aggr_i <span class="ot">=</span> aggr_i[<span class="fu">order</span>(aggr_i<span class="sc">$</span>Week),]</span>
<span id="cb2-996"><a href="#cb2-996" aria-hidden="true" tabindex="-1"></a>  NB.aggr[<span class="fu">match</span>(aggr_i<span class="sc">$</span>Week, NB.aggr<span class="sc">$</span>Week), i<span class="sc">+</span><span class="dv">2</span>] <span class="ot">=</span> aggr_i<span class="sc">$</span>N10_sim</span>
<span id="cb2-997"><a href="#cb2-997" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-998"><a href="#cb2-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-999"><a href="#cb2-999" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Mean <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> mean,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-1000"><a href="#cb2-1000" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Q025 <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> quantile,<span class="at">probs=</span><span class="fl">0.025</span>,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-1001"><a href="#cb2-1001" aria-hidden="true" tabindex="-1"></a>NB.aggr<span class="sc">$</span>Q0975 <span class="ot">=</span> <span class="fu">apply</span>(NB.aggr[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)],<span class="at">FUN =</span> quantile,<span class="at">probs=</span><span class="fl">0.975</span>,<span class="at">MARGIN =</span> <span class="dv">1</span>)</span>
<span id="cb2-1002"><a href="#cb2-1002" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> NB.aggr)<span class="sc">+</span></span>
<span id="cb2-1003"><a href="#cb2-1003" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Week,<span class="at">y=</span>Obs))<span class="sc">+</span></span>
<span id="cb2-1004"><a href="#cb2-1004" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Week,<span class="at">y=</span>Mean),<span class="at">color=</span><span class="st">'red'</span>)<span class="sc">+</span></span>
<span id="cb2-1005"><a href="#cb2-1005" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x=</span>Week, <span class="at">ymin=</span>Q025,<span class="at">ymax=</span>Q0975),<span class="at">fill=</span><span class="st">"red"</span>, <span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb2-1006"><a href="#cb2-1006" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">'Number of fires &gt; 10 ha'</span>, <span class="at">x =</span> <span class="st">'Week of the year'</span>,<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">'Year'</span>,year))<span class="sc">+</span></span>
<span id="cb2-1007"><a href="#cb2-1007" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb2-1008"><a href="#cb2-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1009"><a href="#cb2-1009" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1,p2,p5,p6,<span class="at">ncol=</span><span class="dv">3</span>,<span class="at">nrow=</span><span class="dv">2</span>,</span>
<span id="cb2-1010"><a href="#cb2-1010" aria-hidden="true" tabindex="-1"></a>             <span class="at">layout_matrix=</span><span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">1</span>),<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)),<span class="at">heights=</span><span class="fu">c</span>(<span class="fl">1.5</span>,<span class="dv">1</span>))</span>
<span id="cb2-1011"><a href="#cb2-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1012"><a href="#cb2-1012" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-1013"><a href="#cb2-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1014"><a href="#cb2-1014" aria-hidden="true" tabindex="-1"></a>The size simulations depicted in @fig-res-sizes show that the model successfully recovers the spatial pattern but misses some of the the most extreme values in terms of coverage of pointwise credible intervals. Unlike the fire occurrences, the distribution of burnt areas is heavy-tailed and more difficult to predict. Still, looking at the temporal aggregation the simulations provide satisfying results and almost all observations are within the uncertainty bands. We note that for the largest fires (i.e. greater than $10$ ha), the sample size being much smaller, the uncertainties are larger.</span>
<span id="cb2-1015"><a href="#cb2-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1016"><a href="#cb2-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1017"><a href="#cb2-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1018"><a href="#cb2-1018" aria-hidden="true" tabindex="-1"></a><span class="fu"># Future wildfire simulations derived from climate model projections {#sec-proj}</span></span>
<span id="cb2-1019"><a href="#cb2-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1020"><a href="#cb2-1020" aria-hidden="true" tabindex="-1"></a> We consider hereafter four different climate models under two climate scenarios RCP4.5 and RCP8.5 where the second one is more pessimistic in terms of expected global warming than the first one. The models, together with the institutes having developed them written in parentheses, are as follows: IPSL-CM5A (Institut Pierre-Simon Laplace, France), MPI-ESM (Max Planck Institut für Meteorologie, Germany), HadGEM2 (Met Office Hadley Center, UK) and CNRM (Météo-France, France).</span>
<span id="cb2-1021"><a href="#cb2-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1022"><a href="#cb2-1022" aria-hidden="true" tabindex="-1"></a> For simulated FWI values in the climate change projections that fall outside the range of historical FWI values, we extrapolate the function $f_\text{FWI}$ as a constant. For the forest surface FA in each pixel, we extrapolate the historical values in a constant manner, that is, we use the values available for 2018.</span>
<span id="cb2-1023"><a href="#cb2-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1024"><a href="#cb2-1024" aria-hidden="true" tabindex="-1"></a>We perform $n = 20$ realizations of pixel-day occurrences and generate for each occurrence its associated size. The occurrences and sizes can then be aggregated over various spatial and temporal scales to study the potential evolutions of future wildfire risk. In @fig-climate-models, we depict the results at an annual scale. Interannual variability in simulated counts and sizes remains relatively high, even after averaging the twenty realizations over the whole study area. To smooth the projected curves and identify long-term trends in wildfire activity, we implemented a 1D-SPDE INLA model, given by @eq-inla-proj. The basis representation for the yearly effect is defined through a quadratic spline and we set PC priors for the prior function such that the probability to have a standard deviation larger than $100$ is equal to $0.5$ and we fix a range value of $30$ years. This choice is motivated by the fact that a $30$-year period is often used to calculate averages in climatological studies. Moreover, to assess if there is a general upward trend in the smoothed curve, we include the rescaled year as a linear covariate, i.e., as a fixed effect. The rescaling is constructed such as to interpret the coefficient $\beta_1$ as a decadal effect. Therefore, the role of the spline function $f_\text{YEAR}$ is to model nonlinear deviations from the general linear trend, $\beta_0+\beta_1\left(\text{YEAR}_i-2020\right)/10$. For the sake of identifiability, we set Dirichlet boundary conditions for the spline function, such that it takes value zero at both boundaries.</span>
<span id="cb2-1025"><a href="#cb2-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1026"><a href="#cb2-1026" aria-hidden="true" tabindex="-1"></a>$$\begin{array}{cc}</span>
<span id="cb2-1027"><a href="#cb2-1027" aria-hidden="true" tabindex="-1"></a>Y_i \mid \mu_i,\boldsymbol{\theta}^\text{YEAR} \sim \text{Lognormal}(\mu_i,\sigma) <span class="sc">\\</span></span>
<span id="cb2-1028"><a href="#cb2-1028" aria-hidden="true" tabindex="-1"></a>\mu_i   = \beta_0 + \beta_1 \left(\text{YEAR}_i-2020\right)/10 + f_\text{YEAR}(\text{YEAR}_i) <span class="sc">\\</span></span>
<span id="cb2-1029"><a href="#cb2-1029" aria-hidden="true" tabindex="-1"></a>\boldsymbol{\theta}^\text{YEAR} \sim  \text{Hyperprior}</span>
<span id="cb2-1030"><a href="#cb2-1030" aria-hidden="true" tabindex="-1"></a>\end{array}$$ {#eq-inla-proj}</span>
<span id="cb2-1031"><a href="#cb2-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1032"><a href="#cb2-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1033"><a href="#cb2-1033" aria-hidden="true" tabindex="-1"></a>Since the posterior sampling from the fitted model takes a lot of memory to run, we have stored the results beforehand.</span>
<span id="cb2-1034"><a href="#cb2-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1035"><a href="#cb2-1035" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=F,eval = FALSE}</span></span>
<span id="cb2-1036"><a href="#cb2-1036" aria-hidden="true" tabindex="-1"></a>model_names <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"IPSL_CM5A_WRF331F"</span>,<span class="st">"MPI_ESM_RCA4"</span>,<span class="st">"HadGEM_RCA4"</span>,<span class="st">"CNRM_RCA4"</span>)</span>
<span id="cb2-1037"><a href="#cb2-1037" aria-hidden="true" tabindex="-1"></a>nsample <span class="ot">=</span> niter2 <span class="ot">=</span> <span class="dv">20</span></span>
<span id="cb2-1038"><a href="#cb2-1038" aria-hidden="true" tabindex="-1"></a>sample <span class="ot">=</span> <span class="fu">inla.posterior.sample</span>(<span class="at">n =</span> nsample, <span class="at">result =</span> fit)</span>
<span id="cb2-1039"><a href="#cb2-1039" aria-hidden="true" tabindex="-1"></a>FA_proj <span class="ot">=</span> <span class="fu">unique</span>(DF[, <span class="fu">c</span>(<span class="st">"PIX"</span>, <span class="st">"FA"</span>,<span class="st">"DEP"</span>)])</span>
<span id="cb2-1040"><a href="#cb2-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1041"><a href="#cb2-1041" aria-hidden="true" tabindex="-1"></a><span class="co"># Size projections</span></span>
<span id="cb2-1042"><a href="#cb2-1042" aria-hidden="true" tabindex="-1"></a>nsample.size <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb2-1043"><a href="#cb2-1043" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">=</span> fit.size<span class="sc">$</span>summary.hyperpar<span class="sc">$</span>mean[<span class="dv">1</span>]</span>
<span id="cb2-1044"><a href="#cb2-1044" aria-hidden="true" tabindex="-1"></a>sample.size <span class="ot">=</span> <span class="fu">inla.posterior.sample</span>(<span class="at">n=</span>nsample.size,<span class="at">result =</span> fit.size)</span>
<span id="cb2-1045"><a href="#cb2-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1046"><a href="#cb2-1046" aria-hidden="true" tabindex="-1"></a><span class="co">#spde definitions for INLA</span></span>
<span id="cb2-1047"><a href="#cb2-1047" aria-hidden="true" tabindex="-1"></a>knots_proj <span class="ot">=</span>  <span class="fu">c</span>(<span class="dv">2030</span>, <span class="dv">2050</span>, <span class="dv">2070</span>, <span class="dv">2090</span>)</span>
<span id="cb2-1048"><a href="#cb2-1048" aria-hidden="true" tabindex="-1"></a>bnd_proj <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2100</span>)</span>
<span id="cb2-1049"><a href="#cb2-1049" aria-hidden="true" tabindex="-1"></a>mesh_proj <span class="ot">=</span> <span class="fu">inla.mesh.1d</span>(knots_proj, bnd_proj, <span class="at">degree=</span><span class="dv">2</span>, <span class="at">boundary=</span><span class="fu">c</span>(<span class="st">"dirichlet"</span>, <span class="st">"dirichlet"</span>))</span>
<span id="cb2-1050"><a href="#cb2-1050" aria-hidden="true" tabindex="-1"></a>year_proj <span class="ot">=</span> <span class="dv">2021</span><span class="sc">:</span><span class="dv">2099</span></span>
<span id="cb2-1051"><a href="#cb2-1051" aria-hidden="true" tabindex="-1"></a>B_proj <span class="ot">=</span> <span class="fu">inla.spde.make.A</span>(mesh_proj, year_proj)</span>
<span id="cb2-1052"><a href="#cb2-1052" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb2-1053"><a href="#cb2-1053" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb2-1054"><a href="#cb2-1054" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">=</span> nu <span class="sc">+</span> d<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb2-1055"><a href="#cb2-1055" aria-hidden="true" tabindex="-1"></a>spde_proj <span class="ot">=</span> <span class="fu">inla.spde2.pcmatern</span>(mesh_proj, <span class="at">alpha =</span> alpha, <span class="at">prior.sigma =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="fl">0.5</span>), <span class="at">prior.range =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="cn">NA</span>))</span>
<span id="cb2-1056"><a href="#cb2-1056" aria-hidden="true" tabindex="-1"></a>idx_proj <span class="ot">=</span> <span class="fu">inla.spde.make.index</span>(<span class="st">"proj"</span>, <span class="at">n.spde =</span> spde_proj<span class="sc">$</span>n.spde)</span>
<span id="cb2-1057"><a href="#cb2-1057" aria-hidden="true" tabindex="-1"></a>n_years <span class="ot">=</span> <span class="fu">length</span>(year_proj)</span>
<span id="cb2-1058"><a href="#cb2-1058" aria-hidden="true" tabindex="-1"></a>fixed_effects_df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">intercept =</span> <span class="fu">rep</span>(<span class="dv">1</span>, n_years),<span class="at">time =</span> (year_proj<span class="dv">-2020</span>)<span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb2-1059"><a href="#cb2-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1060"><a href="#cb2-1060" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">=</span> beta.size <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb2-1061"><a href="#cb2-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1062"><a href="#cb2-1062" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (model <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb2-1063"><a href="#cb2-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1064"><a href="#cb2-1064" aria-hidden="true" tabindex="-1"></a>  <span class="co">#FWI values</span></span>
<span id="cb2-1065"><a href="#cb2-1065" aria-hidden="true" tabindex="-1"></a>  name_clim_model <span class="ot">=</span> model_names[model]</span>
<span id="cb2-1066"><a href="#cb2-1066" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="fu">paste0</span>(<span class="st">"DATA"</span>,<span class="st">"projections_FWI_"</span>,name_clim_model,<span class="st">".RData"</span>))</span>
<span id="cb2-1067"><a href="#cb2-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1068"><a href="#cb2-1068" aria-hidden="true" tabindex="-1"></a>  sim_counts_45 <span class="ot">=</span> sim_counts_85 <span class="ot">=</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span><span class="fu">nrow</span>(fwi_rc45), <span class="at">ncol=</span>nsample)</span>
<span id="cb2-1069"><a href="#cb2-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1070"><a href="#cb2-1070" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add FA values</span></span>
<span id="cb2-1071"><a href="#cb2-1071" aria-hidden="true" tabindex="-1"></a>  fwi_rc45<span class="sc">$</span>FA <span class="ot">=</span> FA_proj<span class="sc">$</span>FA[<span class="fu">match</span>(fwi_rc45<span class="sc">$</span>PIX, FA_proj<span class="sc">$</span>PIX)]</span>
<span id="cb2-1072"><a href="#cb2-1072" aria-hidden="true" tabindex="-1"></a>  fwi_rc85<span class="sc">$</span>FA <span class="ot">=</span> FA_proj<span class="sc">$</span>FA[<span class="fu">match</span>(fwi_rc85<span class="sc">$</span>PIX, FA_proj<span class="sc">$</span>PIX)]</span>
<span id="cb2-1073"><a href="#cb2-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1074"><a href="#cb2-1074" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add DEP values</span></span>
<span id="cb2-1075"><a href="#cb2-1075" aria-hidden="true" tabindex="-1"></a>  fwi_rc45<span class="sc">$</span>DEP <span class="ot">=</span> FA_proj<span class="sc">$</span>DEP[<span class="fu">match</span>(fwi_rc45<span class="sc">$</span>PIX, FA_proj<span class="sc">$</span>PIX)]</span>
<span id="cb2-1076"><a href="#cb2-1076" aria-hidden="true" tabindex="-1"></a>  fwi_rc85<span class="sc">$</span>DEP <span class="ot">=</span> FA_proj<span class="sc">$</span>DEP[<span class="fu">match</span>(fwi_rc85<span class="sc">$</span>PIX, FA_proj<span class="sc">$</span>PIX)]</span>
<span id="cb2-1077"><a href="#cb2-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1078"><a href="#cb2-1078" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Rename FWIfl1 for simplicity</span></span>
<span id="cb2-1079"><a href="#cb2-1079" aria-hidden="true" tabindex="-1"></a>  fwi_rc45<span class="sc">$</span>FWI <span class="ot">=</span> fwi_rc45<span class="sc">$</span>FWIfl1</span>
<span id="cb2-1080"><a href="#cb2-1080" aria-hidden="true" tabindex="-1"></a>  fwi_rc85<span class="sc">$</span>FWI <span class="ot">=</span> fwi_rc85<span class="sc">$</span>FWIfl1</span>
<span id="cb2-1081"><a href="#cb2-1081" aria-hidden="true" tabindex="-1"></a>  fwi_rc85<span class="sc">$</span>FWIfl1 <span class="ot">=</span> fwi_rc45<span class="sc">$</span>FWIfl1 <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb2-1082"><a href="#cb2-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1083"><a href="#cb2-1083" aria-hidden="true" tabindex="-1"></a>  <span class="co"># constant extrapolation</span></span>
<span id="cb2-1084"><a href="#cb2-1084" aria-hidden="true" tabindex="-1"></a>  fwi_rc45<span class="sc">$</span>FWI[fwi_rc45<span class="sc">$</span>FWI <span class="sc">&gt;</span> mesh_FWI<span class="sc">$</span>interval[<span class="dv">2</span>]] <span class="ot">=</span> mesh_FWI<span class="sc">$</span>interval[<span class="dv">2</span>]</span>
<span id="cb2-1085"><a href="#cb2-1085" aria-hidden="true" tabindex="-1"></a>  fwi_rc85<span class="sc">$</span>FWI[fwi_rc85<span class="sc">$</span>FWI <span class="sc">&gt;</span> mesh_FWI<span class="sc">$</span>interval[<span class="dv">2</span>]] <span class="ot">=</span> mesh_FWI<span class="sc">$</span>interval[<span class="dv">2</span>]</span>
<span id="cb2-1086"><a href="#cb2-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1087"><a href="#cb2-1087" aria-hidden="true" tabindex="-1"></a>  id_SAFRAN <span class="ot">=</span> <span class="fu">unique</span>(fwi_rc45<span class="sc">$</span>PIX)</span>
<span id="cb2-1088"><a href="#cb2-1088" aria-hidden="true" tabindex="-1"></a>  coordinla_proj <span class="ot">=</span> <span class="fu">cbind</span>(coord<span class="sc">$</span>XL2e, coord<span class="sc">$</span>YL2e)[<span class="fu">match</span>(id_SAFRAN, coord<span class="sc">$</span>N_SAFRAN),]<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span></span>
<span id="cb2-1089"><a href="#cb2-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1090"><a href="#cb2-1090" aria-hidden="true" tabindex="-1"></a>  x.comp<span class="fl">.45</span> <span class="ot">=</span> x.comp<span class="fl">.85</span> <span class="ot">=</span><span class="fu">list</span>()</span>
<span id="cb2-1091"><a href="#cb2-1091" aria-hidden="true" tabindex="-1"></a>  fixedEffectsId<span class="ot">=</span><span class="fu">rownames</span>(fit<span class="sc">$</span>summary.fixed)</span>
<span id="cb2-1092"><a href="#cb2-1092" aria-hidden="true" tabindex="-1"></a>  eff <span class="ot">=</span> fixedEffectsId[<span class="dv">1</span>]</span>
<span id="cb2-1093"><a href="#cb2-1093" aria-hidden="true" tabindex="-1"></a>  x.comp<span class="fl">.45</span>[[eff]]<span class="ot">=</span>x.comp<span class="fl">.85</span>[[eff]] <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">inla.posterior.sample.eval</span>(eff, sample))</span>
<span id="cb2-1094"><a href="#cb2-1094" aria-hidden="true" tabindex="-1"></a>  randomEffectsId<span class="ot">=</span><span class="fu">names</span>(fit<span class="sc">$</span>summary.random)</span>
<span id="cb2-1095"><a href="#cb2-1095" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (eff <span class="cf">in</span> randomEffectsId) {</span>
<span id="cb2-1096"><a href="#cb2-1096" aria-hidden="true" tabindex="-1"></a>    x.comp<span class="fl">.45</span>[[eff]] <span class="ot">=</span> x.comp<span class="fl">.85</span>[[eff]] <span class="ot">=</span> <span class="fu">unname</span>(<span class="fu">inla.posterior.sample.eval</span>(eff, sample))</span>
<span id="cb2-1097"><a href="#cb2-1097" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-1098"><a href="#cb2-1098" aria-hidden="true" tabindex="-1"></a>  randomEffectsId <span class="ot">=</span> randomEffectsId[randomEffectsId <span class="sc">!=</span> <span class="st">"YEAR"</span>]</span>
<span id="cb2-1099"><a href="#cb2-1099" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (eff <span class="cf">in</span> randomEffectsId){</span>
<span id="cb2-1100"><a href="#cb2-1100" aria-hidden="true" tabindex="-1"></a>    meshproj <span class="ot">=</span> <span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">"mesh_"</span>, eff))</span>
<span id="cb2-1101"><a href="#cb2-1101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">str_detect</span>(eff,<span class="st">"spatial"</span>)){</span>
<span id="cb2-1102"><a href="#cb2-1102" aria-hidden="true" tabindex="-1"></a>      meshproj<span class="fl">.45</span> <span class="ot">=</span> meshproj<span class="fl">.85</span> <span class="ot">=</span> <span class="fu">inla.mesh.projector</span>(meshproj,<span class="at">loc =</span> coordinla_proj)</span>
<span id="cb2-1103"><a href="#cb2-1103" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-1104"><a href="#cb2-1104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{</span>
<span id="cb2-1105"><a href="#cb2-1105" aria-hidden="true" tabindex="-1"></a>      meshproj<span class="fl">.45</span> <span class="ot">=</span> <span class="fu">inla.mesh.projector</span>(meshproj, <span class="at">loc =</span> fwi_rc45[,eff])</span>
<span id="cb2-1106"><a href="#cb2-1106" aria-hidden="true" tabindex="-1"></a>      meshproj<span class="fl">.85</span> <span class="ot">=</span> <span class="fu">inla.mesh.projector</span>(meshproj, <span class="at">loc =</span> fwi_rc85[,eff])</span>
<span id="cb2-1107"><a href="#cb2-1107" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-1108"><a href="#cb2-1108" aria-hidden="true" tabindex="-1"></a>    x.comp<span class="fl">.45</span>[[eff]]<span class="ot">=</span><span class="fu">inla.mesh.project</span>(meshproj<span class="fl">.45</span>, x.comp<span class="fl">.45</span>[[eff]])</span>
<span id="cb2-1109"><a href="#cb2-1109" aria-hidden="true" tabindex="-1"></a>    x.comp<span class="fl">.85</span>[[eff]]<span class="ot">=</span><span class="fu">inla.mesh.project</span>(meshproj<span class="fl">.85</span>, x.comp<span class="fl">.85</span>[[eff]])</span>
<span id="cb2-1110"><a href="#cb2-1110" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-1111"><a href="#cb2-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1112"><a href="#cb2-1112" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Then simulation of fire occurrences:</span></span>
<span id="cb2-1113"><a href="#cb2-1113" aria-hidden="true" tabindex="-1"></a>  niter2 <span class="ot">=</span> nsample; nsample2 <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb2-1114"><a href="#cb2-1114" aria-hidden="true" tabindex="-1"></a>  idspat <span class="ot">=</span> <span class="fu">match</span>(fwi_rc45<span class="sc">$</span>PIX,<span class="fu">unique</span>(fwi_rc45<span class="sc">$</span>PIX))</span>
<span id="cb2-1115"><a href="#cb2-1115" aria-hidden="true" tabindex="-1"></a>  sim_counts_45 <span class="ot">=</span> sim_counts_85 <span class="ot">=</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow=</span><span class="fu">nrow</span>(fwi_rc45),<span class="at">ncol=</span>niter2)</span>
<span id="cb2-1116"><a href="#cb2-1116" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>niter2){</span>
<span id="cb2-1117"><a href="#cb2-1117" aria-hidden="true" tabindex="-1"></a>    <span class="co"># OFFSET</span></span>
<span id="cb2-1118"><a href="#cb2-1118" aria-hidden="true" tabindex="-1"></a>    x.proj<span class="fl">.45</span> <span class="ot">=</span> x.proj<span class="fl">.85</span> <span class="ot">=</span> <span class="dv">0</span> <span class="co"># if offset, not the case here</span></span>
<span id="cb2-1119"><a href="#cb2-1119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># FIXED EFFECTS</span></span>
<span id="cb2-1120"><a href="#cb2-1120" aria-hidden="true" tabindex="-1"></a>    fixedEffectsId<span class="ot">=</span><span class="fu">rownames</span>(fit<span class="sc">$</span>summary.fixed)</span>
<span id="cb2-1121"><a href="#cb2-1121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(fixedEffectsId)<span class="sc">&gt;</span><span class="dv">0</span>) {</span>
<span id="cb2-1122"><a href="#cb2-1122" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (eff <span class="cf">in</span> fixedEffectsId) {</span>
<span id="cb2-1123"><a href="#cb2-1123" aria-hidden="true" tabindex="-1"></a>        x.proj<span class="fl">.45</span> <span class="ot">=</span> x.proj<span class="fl">.45</span> <span class="sc">+</span> <span class="fu">rep</span>(x.comp<span class="fl">.45</span>[[eff]][k], <span class="fu">dim</span>(fwi_rc45)[<span class="dv">1</span>])</span>
<span id="cb2-1124"><a href="#cb2-1124" aria-hidden="true" tabindex="-1"></a>        x.proj<span class="fl">.85</span> <span class="ot">=</span> x.proj<span class="fl">.85</span> <span class="sc">+</span> <span class="fu">rep</span>(x.comp<span class="fl">.85</span>[[eff]][k], <span class="fu">dim</span>(fwi_rc85)[<span class="dv">1</span>])</span>
<span id="cb2-1125"><a href="#cb2-1125" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-1126"><a href="#cb2-1126" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-1127"><a href="#cb2-1127" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RANDOM EFFECTS</span></span>
<span id="cb2-1128"><a href="#cb2-1128" aria-hidden="true" tabindex="-1"></a>    randomEffectsId<span class="ot">=</span><span class="fu">names</span>(fit<span class="sc">$</span>summary.random)</span>
<span id="cb2-1129"><a href="#cb2-1129" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(randomEffectsId)<span class="sc">&gt;</span><span class="dv">0</span>) {</span>
<span id="cb2-1130"><a href="#cb2-1130" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (eff <span class="cf">in</span> randomEffectsId) {</span>
<span id="cb2-1131"><a href="#cb2-1131" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">str_detect</span>(eff,<span class="st">"spatial"</span>)){</span>
<span id="cb2-1132"><a href="#cb2-1132" aria-hidden="true" tabindex="-1"></a>          x.proj<span class="fl">.45</span> <span class="ot">=</span> x.proj<span class="fl">.45</span> <span class="sc">+</span> x.comp<span class="fl">.45</span>[[eff]][idspat,k]</span>
<span id="cb2-1133"><a href="#cb2-1133" aria-hidden="true" tabindex="-1"></a>          x.proj<span class="fl">.85</span> <span class="ot">=</span> x.proj<span class="fl">.85</span> <span class="sc">+</span> x.comp<span class="fl">.85</span>[[eff]][idspat,k]</span>
<span id="cb2-1134"><a href="#cb2-1134" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-1135"><a href="#cb2-1135" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>{</span>
<span id="cb2-1136"><a href="#cb2-1136" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (eff <span class="sc">==</span> <span class="st">"YEAR"</span>){</span>
<span id="cb2-1137"><a href="#cb2-1137" aria-hidden="true" tabindex="-1"></a>            <span class="co">#random sampling in the posterior distribution</span></span>
<span id="cb2-1138"><a href="#cb2-1138" aria-hidden="true" tabindex="-1"></a>            x.proj<span class="fl">.45</span> <span class="ot">=</span> x.proj<span class="fl">.45</span> <span class="sc">+</span> <span class="fu">sample</span>(x.comp<span class="fl">.45</span>[[eff]][,k], <span class="dv">1</span>)</span>
<span id="cb2-1139"><a href="#cb2-1139" aria-hidden="true" tabindex="-1"></a>            x.proj<span class="fl">.85</span> <span class="ot">=</span> x.proj<span class="fl">.85</span> <span class="sc">+</span> <span class="fu">sample</span>(x.comp<span class="fl">.85</span>[[eff]][,k], <span class="dv">1</span>)</span>
<span id="cb2-1140"><a href="#cb2-1140" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-1141"><a href="#cb2-1141" aria-hidden="true" tabindex="-1"></a>          <span class="cf">else</span>{</span>
<span id="cb2-1142"><a href="#cb2-1142" aria-hidden="true" tabindex="-1"></a>            x.proj<span class="fl">.45</span> <span class="ot">=</span> x.proj<span class="fl">.45</span> <span class="sc">+</span> x.comp<span class="fl">.45</span>[[eff]][,k]</span>
<span id="cb2-1143"><a href="#cb2-1143" aria-hidden="true" tabindex="-1"></a>            x.proj<span class="fl">.85</span> <span class="ot">=</span> x.proj<span class="fl">.85</span> <span class="sc">+</span> x.comp<span class="fl">.85</span>[[eff]][,k]</span>
<span id="cb2-1144"><a href="#cb2-1144" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-1145"><a href="#cb2-1145" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-1146"><a href="#cb2-1146" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-1147"><a href="#cb2-1147" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-1148"><a href="#cb2-1148" aria-hidden="true" tabindex="-1"></a>    lambda<span class="fl">.45</span> <span class="ot">=</span> <span class="fu">exp</span>(x.proj<span class="fl">.45</span>)</span>
<span id="cb2-1149"><a href="#cb2-1149" aria-hidden="true" tabindex="-1"></a>    lambda<span class="fl">.85</span> <span class="ot">=</span> <span class="fu">exp</span>(x.proj<span class="fl">.85</span>)</span>
<span id="cb2-1150"><a href="#cb2-1150" aria-hidden="true" tabindex="-1"></a>    sim_counts_45[,k] <span class="ot">=</span> <span class="fu">rpois</span>(<span class="fu">length</span>(lambda<span class="fl">.45</span>),lambda<span class="fl">.45</span>)</span>
<span id="cb2-1151"><a href="#cb2-1151" aria-hidden="true" tabindex="-1"></a>    sim_counts_85[,k] <span class="ot">=</span> <span class="fu">rpois</span>(<span class="fu">length</span>(lambda<span class="fl">.85</span>),lambda<span class="fl">.85</span>)</span>
<span id="cb2-1152"><a href="#cb2-1152" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-1153"><a href="#cb2-1153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(lamda<span class="fl">.45</span>,lambda<span class="fl">.85</span>,x.proj<span class="fl">.45</span>,x.proj<span class="fl">.85</span>,x.comp<span class="fl">.45</span>,x.comp<span class="fl">.85</span>)</span>
<span id="cb2-1154"><a href="#cb2-1154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gc</span>()</span>
<span id="cb2-1155"><a href="#cb2-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1156"><a href="#cb2-1156" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Size projections</span></span>
<span id="cb2-1157"><a href="#cb2-1157" aria-hidden="true" tabindex="-1"></a>  sim_size_45_tot<span class="ot">=</span>sim_size_85_tot <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow=</span><span class="fu">dim</span>(fwi_rc45)[<span class="dv">1</span>],<span class="at">ncol=</span>niter2)</span>
<span id="cb2-1158"><a href="#cb2-1158" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>niter2){</span>
<span id="cb2-1159"><a href="#cb2-1159" aria-hidden="true" tabindex="-1"></a>    projDF.size<span class="fl">.45</span> <span class="ot">=</span> fwi_rc45[sim_counts_45[,k]<span class="sc">&gt;</span><span class="dv">0</span>,]</span>
<span id="cb2-1160"><a href="#cb2-1160" aria-hidden="true" tabindex="-1"></a>    projDF.size<span class="fl">.85</span> <span class="ot">=</span> fwi_rc85[sim_counts_85[,k]<span class="sc">&gt;</span><span class="dv">0</span>,]</span>
<span id="cb2-1161"><a href="#cb2-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1162"><a href="#cb2-1162" aria-hidden="true" tabindex="-1"></a>    x.comp.<span class="fl">45.</span>size <span class="ot">=</span> x.comp.<span class="fl">85.</span>size <span class="ot">=</span><span class="fu">list</span>()</span>
<span id="cb2-1163"><a href="#cb2-1163" aria-hidden="true" tabindex="-1"></a>    fixedEffectsId<span class="ot">=</span><span class="fu">rownames</span>(fit.size<span class="sc">$</span>summary.fixed)</span>
<span id="cb2-1164"><a href="#cb2-1164" aria-hidden="true" tabindex="-1"></a>    eff <span class="ot">=</span> fixedEffectsId[<span class="dv">1</span>]</span>
<span id="cb2-1165"><a href="#cb2-1165" aria-hidden="true" tabindex="-1"></a>    x.comp.<span class="fl">45.</span>size[[eff]] <span class="ot">=</span> x.comp.<span class="fl">85.</span>size[[eff]] <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">inla.posterior.sample.eval</span>(eff, sample.size))</span>
<span id="cb2-1166"><a href="#cb2-1166" aria-hidden="true" tabindex="-1"></a>    randomEffectsId<span class="ot">=</span><span class="fu">names</span>(fit.size<span class="sc">$</span>summary.random)</span>
<span id="cb2-1167"><a href="#cb2-1167" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (eff <span class="cf">in</span> randomEffectsId) {</span>
<span id="cb2-1168"><a href="#cb2-1168" aria-hidden="true" tabindex="-1"></a>      x.comp.<span class="fl">45.</span>size[[eff]] <span class="ot">=</span> x.comp.<span class="fl">85.</span>size[[eff]] <span class="ot">=</span> <span class="fu">unname</span>(<span class="fu">inla.posterior.sample.eval</span>(eff, sample.size))</span>
<span id="cb2-1169"><a href="#cb2-1169" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-1170"><a href="#cb2-1170" aria-hidden="true" tabindex="-1"></a>    randomEffectsId <span class="ot">=</span> randomEffectsId[randomEffectsId <span class="sc">!=</span> <span class="fu">c</span>(<span class="st">"YEAR"</span>,<span class="st">"DEP"</span>)]</span>
<span id="cb2-1171"><a href="#cb2-1171" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (eff <span class="cf">in</span> randomEffectsId){</span>
<span id="cb2-1172"><a href="#cb2-1172" aria-hidden="true" tabindex="-1"></a>      meshproj <span class="ot">=</span> <span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">"mesh_"</span>, eff))</span>
<span id="cb2-1173"><a href="#cb2-1173" aria-hidden="true" tabindex="-1"></a>      meshproj<span class="fl">.45</span> <span class="ot">=</span> <span class="fu">inla.mesh.projector</span>(meshproj, <span class="at">loc =</span> projDF.size<span class="fl">.45</span>[,eff])</span>
<span id="cb2-1174"><a href="#cb2-1174" aria-hidden="true" tabindex="-1"></a>      meshproj<span class="fl">.85</span> <span class="ot">=</span> <span class="fu">inla.mesh.projector</span>(meshproj, <span class="at">loc =</span> projDF.size<span class="fl">.85</span>[,eff])</span>
<span id="cb2-1175"><a href="#cb2-1175" aria-hidden="true" tabindex="-1"></a>      x.comp.<span class="fl">45.</span>size[[eff]]<span class="ot">=</span><span class="fu">inla.mesh.project</span>(meshproj<span class="fl">.45</span>, x.comp.<span class="fl">45.</span>size[[eff]])</span>
<span id="cb2-1176"><a href="#cb2-1176" aria-hidden="true" tabindex="-1"></a>      x.comp.<span class="fl">85.</span>size[[eff]]<span class="ot">=</span><span class="fu">inla.mesh.project</span>(meshproj<span class="fl">.85</span>, x.comp.<span class="fl">85.</span>size[[eff]])</span>
<span id="cb2-1177"><a href="#cb2-1177" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-1178"><a href="#cb2-1178" aria-hidden="true" tabindex="-1"></a>    x.proj.<span class="fl">45.</span>size <span class="ot">=</span> x.proj.<span class="fl">85.</span>size <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb2-1179"><a href="#cb2-1179" aria-hidden="true" tabindex="-1"></a>    <span class="co"># FIXED EFFECTS</span></span>
<span id="cb2-1180"><a href="#cb2-1180" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(fixedEffectsId)<span class="sc">&gt;</span><span class="dv">0</span>) {</span>
<span id="cb2-1181"><a href="#cb2-1181" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (eff <span class="cf">in</span> fixedEffectsId) {</span>
<span id="cb2-1182"><a href="#cb2-1182" aria-hidden="true" tabindex="-1"></a>        x.proj.<span class="fl">45.</span>size <span class="ot">=</span> x.proj.<span class="fl">45.</span>size <span class="sc">+</span> <span class="fu">rep</span>(x.comp.<span class="fl">45.</span>size[[eff]],<span class="fu">dim</span>(projDF.size<span class="fl">.45</span>)[<span class="dv">1</span>])</span>
<span id="cb2-1183"><a href="#cb2-1183" aria-hidden="true" tabindex="-1"></a>        x.proj.<span class="fl">85.</span>size <span class="ot">=</span> x.proj.<span class="fl">85.</span>size <span class="sc">+</span> <span class="fu">rep</span>(x.comp.<span class="fl">85.</span>size[[eff]],<span class="fu">dim</span>(projDF.size<span class="fl">.85</span>)[<span class="dv">1</span>])</span>
<span id="cb2-1184"><a href="#cb2-1184" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-1185"><a href="#cb2-1185" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-1186"><a href="#cb2-1186" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RANDOM EFFECTS</span></span>
<span id="cb2-1187"><a href="#cb2-1187" aria-hidden="true" tabindex="-1"></a>    randomEffectsId<span class="ot">=</span><span class="fu">names</span>(fit.size<span class="sc">$</span>summary.random)</span>
<span id="cb2-1188"><a href="#cb2-1188" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(randomEffectsId)<span class="sc">&gt;</span><span class="dv">0</span>) {</span>
<span id="cb2-1189"><a href="#cb2-1189" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (eff <span class="cf">in</span> randomEffectsId) {</span>
<span id="cb2-1190"><a href="#cb2-1190" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">str_detect</span>(eff,<span class="st">"DEP"</span>)){</span>
<span id="cb2-1191"><a href="#cb2-1191" aria-hidden="true" tabindex="-1"></a>          idspat<span class="fl">.45</span> <span class="ot">=</span> <span class="fu">match</span>(projDF.size<span class="fl">.45</span>[[eff]] ,dept[[<span class="dv">2</span>]]) <span class="co">#match(projDF.size.45$PIX,unique(projDF.size.45$PIX))</span></span>
<span id="cb2-1192"><a href="#cb2-1192" aria-hidden="true" tabindex="-1"></a>          x.proj.<span class="fl">45.</span>size <span class="ot">=</span> x.proj.<span class="fl">45.</span>size <span class="sc">+</span> x.comp.<span class="fl">45.</span>size[[eff]][idspat<span class="fl">.45</span>]</span>
<span id="cb2-1193"><a href="#cb2-1193" aria-hidden="true" tabindex="-1"></a>          idspat<span class="fl">.85</span> <span class="ot">=</span> <span class="fu">match</span>(projDF.size<span class="fl">.85</span>[[eff]] ,dept[[<span class="dv">2</span>]]) <span class="co">#match(projDF.size.85$PIX,unique(projDF.size.85$PIX))</span></span>
<span id="cb2-1194"><a href="#cb2-1194" aria-hidden="true" tabindex="-1"></a>          x.proj.<span class="fl">85.</span>size <span class="ot">=</span> x.proj.<span class="fl">85.</span>size <span class="sc">+</span> x.comp.<span class="fl">85.</span>size[[eff]][idspat<span class="fl">.85</span>]</span>
<span id="cb2-1195"><a href="#cb2-1195" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-1196"><a href="#cb2-1196" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>{</span>
<span id="cb2-1197"><a href="#cb2-1197" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (eff <span class="sc">==</span> <span class="st">"YEAR"</span>){</span>
<span id="cb2-1198"><a href="#cb2-1198" aria-hidden="true" tabindex="-1"></a>            <span class="co">#random sampling in the posterior distribution</span></span>
<span id="cb2-1199"><a href="#cb2-1199" aria-hidden="true" tabindex="-1"></a>            x.proj.<span class="fl">45.</span>size <span class="ot">=</span> x.proj.<span class="fl">45.</span>size <span class="sc">+</span> <span class="fu">sample</span>(x.comp.<span class="fl">45.</span>size[[eff]], <span class="dv">1</span>)</span>
<span id="cb2-1200"><a href="#cb2-1200" aria-hidden="true" tabindex="-1"></a>            x.proj.<span class="fl">85.</span>size <span class="ot">=</span> x.proj.<span class="fl">85.</span>size <span class="sc">+</span> <span class="fu">sample</span>(x.comp.<span class="fl">85.</span>size[[eff]], <span class="dv">1</span>)</span>
<span id="cb2-1201"><a href="#cb2-1201" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-1202"><a href="#cb2-1202" aria-hidden="true" tabindex="-1"></a>          <span class="cf">else</span>{</span>
<span id="cb2-1203"><a href="#cb2-1203" aria-hidden="true" tabindex="-1"></a>            x.proj.<span class="fl">45.</span>size <span class="ot">=</span> x.proj.<span class="fl">45.</span>size <span class="sc">+</span> x.comp.<span class="fl">45.</span>size[[eff]]</span>
<span id="cb2-1204"><a href="#cb2-1204" aria-hidden="true" tabindex="-1"></a>            x.proj.<span class="fl">85.</span>size <span class="ot">=</span> x.proj.<span class="fl">85.</span>size <span class="sc">+</span> x.comp.<span class="fl">85.</span>size[[eff]]</span>
<span id="cb2-1205"><a href="#cb2-1205" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-1206"><a href="#cb2-1206" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-1207"><a href="#cb2-1207" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-1208"><a href="#cb2-1208" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-1209"><a href="#cb2-1209" aria-hidden="true" tabindex="-1"></a>    mu<span class="fl">.45</span> <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">exp</span>(x.proj.<span class="fl">45.</span>size))</span>
<span id="cb2-1210"><a href="#cb2-1210" aria-hidden="true" tabindex="-1"></a>    mu<span class="fl">.85</span> <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">exp</span>(x.proj.<span class="fl">85.</span>size))</span>
<span id="cb2-1211"><a href="#cb2-1211" aria-hidden="true" tabindex="-1"></a>    sim_size_45 <span class="ot">=</span> <span class="fu">rgamma</span>(<span class="at">n=</span><span class="fu">dim</span>(projDF.size<span class="fl">.45</span>)[<span class="dv">1</span>],<span class="at">shape =</span> phi,<span class="at">rate=</span><span class="fu">as.vector</span>(phi<span class="sc">/</span>mu<span class="fl">.45</span>))</span>
<span id="cb2-1212"><a href="#cb2-1212" aria-hidden="true" tabindex="-1"></a>    sim_size_85 <span class="ot">=</span> <span class="fu">rgamma</span>(<span class="at">n=</span><span class="fu">dim</span>(projDF.size<span class="fl">.85</span>)[<span class="dv">1</span>],<span class="at">shape =</span> phi,<span class="at">rate=</span><span class="fu">as.vector</span>(phi<span class="sc">/</span>mu<span class="fl">.85</span>))</span>
<span id="cb2-1213"><a href="#cb2-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1214"><a href="#cb2-1214" aria-hidden="true" tabindex="-1"></a>    idx<span class="fl">.45</span><span class="ot">=</span> <span class="fu">which</span>(sim_counts_45[,k]<span class="sc">&gt;</span><span class="dv">0</span>)<span class="co">#rep(1:dim(fwi_rc45)[1],sim_counts_45[,k])</span></span>
<span id="cb2-1215"><a href="#cb2-1215" aria-hidden="true" tabindex="-1"></a>    idx<span class="fl">.85</span><span class="ot">=</span><span class="fu">which</span>(sim_counts_85[,k]<span class="sc">&gt;</span><span class="dv">0</span>)<span class="co">#rep(1:dim(projDF.size.85)[1],sim_counts_85[,k])</span></span>
<span id="cb2-1216"><a href="#cb2-1216" aria-hidden="true" tabindex="-1"></a>    sim_size_45_tot[idx<span class="fl">.45</span>,k] <span class="ot">=</span> sim_size_45</span>
<span id="cb2-1217"><a href="#cb2-1217" aria-hidden="true" tabindex="-1"></a>    sim_size_85_tot[idx<span class="fl">.85</span>,k] <span class="ot">=</span> sim_size_85</span>
<span id="cb2-1218"><a href="#cb2-1218" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-1219"><a href="#cb2-1219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(idx<span class="fl">.45</span>,idx<span class="fl">.85</span>,mu<span class="fl">.45</span>,mu<span class="fl">.85</span>,x.proj.<span class="fl">45.</span>size,x.proj.<span class="fl">85.</span>size,sim_size_45,sim_size_85,x.comp.<span class="fl">45.</span>size,x.comp.<span class="fl">85.</span>size,projDF.size<span class="fl">.85</span>,projDF.size<span class="fl">.45</span>)</span>
<span id="cb2-1220"><a href="#cb2-1220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gc</span>()</span>
<span id="cb2-1221"><a href="#cb2-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1222"><a href="#cb2-1222" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Map of mean between 2070-2100</span></span>
<span id="cb2-1223"><a href="#cb2-1223" aria-hidden="true" tabindex="-1"></a>  sim_counts_45_map <span class="ot">=</span><span class="fu">as.data.frame</span>(sim_counts_45)</span>
<span id="cb2-1224"><a href="#cb2-1224" aria-hidden="true" tabindex="-1"></a>  sim_counts_45_map<span class="sc">$</span>YEAR <span class="ot">=</span> fwi_rc45<span class="sc">$</span>YEAR</span>
<span id="cb2-1225"><a href="#cb2-1225" aria-hidden="true" tabindex="-1"></a>  sim_counts_45_map<span class="sc">$</span>PIX <span class="ot">=</span> fwi_rc45<span class="sc">$</span>PIX</span>
<span id="cb2-1226"><a href="#cb2-1226" aria-hidden="true" tabindex="-1"></a>  sim_counts_45_map <span class="ot">=</span> sim_counts_45_map[sim_counts_45_map<span class="sc">$</span>YEAR <span class="sc">&gt;=</span> <span class="dv">2070</span>,]</span>
<span id="cb2-1227"><a href="#cb2-1227" aria-hidden="true" tabindex="-1"></a>  sim_counts_45_map<span class="sc">$</span>tot <span class="ot">=</span> <span class="fu">apply</span>(sim_counts_45_map[,<span class="fu">c</span>(<span class="dv">1</span>,nsample)],<span class="dv">1</span>,<span class="at">FUN=</span>mean)</span>
<span id="cb2-1228"><a href="#cb2-1228" aria-hidden="true" tabindex="-1"></a>  map.mean<span class="fl">.45</span> <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>PIX,sim_counts_45_map[<span class="fu">c</span>(<span class="st">"PIX"</span>,<span class="st">"tot"</span>)],<span class="at">FUN =</span> sum)</span>
<span id="cb2-1229"><a href="#cb2-1229" aria-hidden="true" tabindex="-1"></a>  idx_safran <span class="ot">=</span>  <span class="fu">match</span>(map.mean<span class="fl">.45</span><span class="sc">$</span>PIX,coord<span class="sc">$</span>N_SAFRAN)</span>
<span id="cb2-1230"><a href="#cb2-1230" aria-hidden="true" tabindex="-1"></a>  map.mean<span class="fl">.45</span> <span class="ot">=</span> map.mean<span class="fl">.45</span><span class="sc">$</span>tot <span class="sc">/</span> <span class="dv">30</span></span>
<span id="cb2-1231"><a href="#cb2-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1232"><a href="#cb2-1232" aria-hidden="true" tabindex="-1"></a>  sim_counts_85_map <span class="ot">=</span><span class="fu">as.data.frame</span>(sim_counts_85)</span>
<span id="cb2-1233"><a href="#cb2-1233" aria-hidden="true" tabindex="-1"></a>  sim_counts_85_map<span class="sc">$</span>YEAR <span class="ot">=</span> fwi_rc85<span class="sc">$</span>YEAR</span>
<span id="cb2-1234"><a href="#cb2-1234" aria-hidden="true" tabindex="-1"></a>  sim_counts_85_map<span class="sc">$</span>PIX <span class="ot">=</span> fwi_rc85<span class="sc">$</span>PIX</span>
<span id="cb2-1235"><a href="#cb2-1235" aria-hidden="true" tabindex="-1"></a>  sim_counts_85_map <span class="ot">=</span> sim_counts_85_map[sim_counts_85_map<span class="sc">$</span>YEAR <span class="sc">&gt;=</span> <span class="dv">2070</span>,]</span>
<span id="cb2-1236"><a href="#cb2-1236" aria-hidden="true" tabindex="-1"></a>  sim_counts_85_map<span class="sc">$</span>tot <span class="ot">=</span> <span class="fu">apply</span>(sim_counts_85_map[,<span class="fu">c</span>(<span class="dv">1</span>,nsample)],<span class="dv">1</span>,<span class="at">FUN=</span>mean)</span>
<span id="cb2-1237"><a href="#cb2-1237" aria-hidden="true" tabindex="-1"></a>  map.mean<span class="fl">.85</span> <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>PIX,sim_counts_85_map,<span class="at">FUN =</span> sum)</span>
<span id="cb2-1238"><a href="#cb2-1238" aria-hidden="true" tabindex="-1"></a>  map.mean<span class="fl">.85</span> <span class="ot">=</span> map.mean<span class="fl">.85</span><span class="sc">$</span>tot <span class="sc">/</span> <span class="dv">30</span></span>
<span id="cb2-1239"><a href="#cb2-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1240"><a href="#cb2-1240" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">=</span> <span class="fu">rbind</span>(<span class="fu">data.frame</span>(<span class="st">"NB"</span><span class="ot">=</span>map.mean<span class="fl">.45</span>,<span class="at">lab =</span> <span class="st">'RCP4.5'</span>),<span class="fu">data.frame</span>(<span class="st">"NB"</span><span class="ot">=</span>map.mean<span class="fl">.85</span>,<span class="at">lab=</span><span class="st">"RCP8.5"</span>))</span>
<span id="cb2-1241"><a href="#cb2-1241" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>XL2e <span class="ot">=</span> <span class="fu">rep</span>(coord<span class="sc">$</span>XL2e[idx_safran],<span class="dv">2</span>)</span>
<span id="cb2-1242"><a href="#cb2-1242" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>YL2e <span class="ot">=</span> <span class="fu">rep</span>(coord<span class="sc">$</span>YL2e[idx_safran],<span class="dv">2</span>)</span>
<span id="cb2-1243"><a href="#cb2-1243" aria-hidden="true" tabindex="-1"></a>  file_name <span class="ot">=</span> <span class="fu">paste0</span>(DATA,<span class="st">"map_proj_"</span>, model, <span class="st">".RData"</span>)</span>
<span id="cb2-1244"><a href="#cb2-1244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(data,<span class="at">file =</span> file_name)</span>
<span id="cb2-1245"><a href="#cb2-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1246"><a href="#cb2-1246" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Same but for sizes</span></span>
<span id="cb2-1247"><a href="#cb2-1247" aria-hidden="true" tabindex="-1"></a>  sim_size_45_map <span class="ot">=</span><span class="fu">as.data.frame</span>(sim_size_45_tot)</span>
<span id="cb2-1248"><a href="#cb2-1248" aria-hidden="true" tabindex="-1"></a>  sim_size_45_map<span class="sc">$</span>YEAR <span class="ot">=</span> fwi_rc45<span class="sc">$</span>YEAR</span>
<span id="cb2-1249"><a href="#cb2-1249" aria-hidden="true" tabindex="-1"></a>  sim_size_45_map<span class="sc">$</span>PIX <span class="ot">=</span> fwi_rc45<span class="sc">$</span>PIX</span>
<span id="cb2-1250"><a href="#cb2-1250" aria-hidden="true" tabindex="-1"></a>  sim_size_45_map <span class="ot">=</span> sim_size_45_map[sim_size_45_map<span class="sc">$</span>YEAR <span class="sc">&gt;=</span> <span class="dv">2070</span>,]</span>
<span id="cb2-1251"><a href="#cb2-1251" aria-hidden="true" tabindex="-1"></a>  sim_size_45_map<span class="sc">$</span>BA <span class="ot">=</span> <span class="fu">apply</span>(sim_size_45_map[,<span class="fu">c</span>(<span class="dv">1</span>,nsample)],<span class="dv">1</span>,<span class="at">FUN=</span>mean)</span>
<span id="cb2-1252"><a href="#cb2-1252" aria-hidden="true" tabindex="-1"></a>  map.mean<span class="fl">.45</span> <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>PIX,sim_size_45_map[,<span class="fu">c</span>(<span class="st">'PIX'</span>,<span class="st">"BA"</span>)],<span class="at">FUN =</span> sum)</span>
<span id="cb2-1253"><a href="#cb2-1253" aria-hidden="true" tabindex="-1"></a>  idx_safran <span class="ot">=</span>  <span class="fu">match</span>(map.mean<span class="fl">.45</span><span class="sc">$</span>PIX,coord<span class="sc">$</span>N_SAFRAN)</span>
<span id="cb2-1254"><a href="#cb2-1254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1255"><a href="#cb2-1255" aria-hidden="true" tabindex="-1"></a>  sim_size_85_map <span class="ot">=</span><span class="fu">as.data.frame</span>(sim_size_85_tot)</span>
<span id="cb2-1256"><a href="#cb2-1256" aria-hidden="true" tabindex="-1"></a>  sim_size_85_map<span class="sc">$</span>YEAR <span class="ot">=</span> fwi_rc85<span class="sc">$</span>YEAR</span>
<span id="cb2-1257"><a href="#cb2-1257" aria-hidden="true" tabindex="-1"></a>  sim_size_85_map<span class="sc">$</span>PIX <span class="ot">=</span> fwi_rc85<span class="sc">$</span>PIX</span>
<span id="cb2-1258"><a href="#cb2-1258" aria-hidden="true" tabindex="-1"></a>  sim_size_85_map <span class="ot">=</span> sim_size_85_map[sim_size_85_map<span class="sc">$</span>YEAR <span class="sc">&gt;=</span> <span class="dv">2070</span>,]</span>
<span id="cb2-1259"><a href="#cb2-1259" aria-hidden="true" tabindex="-1"></a>  sim_size_85_map<span class="sc">$</span>BA <span class="ot">=</span> <span class="fu">apply</span>(sim_size_85_map[,<span class="fu">c</span>(<span class="dv">1</span>,nsample)],<span class="dv">1</span>,<span class="at">FUN=</span>mean)</span>
<span id="cb2-1260"><a href="#cb2-1260" aria-hidden="true" tabindex="-1"></a>  map.mean<span class="fl">.85</span> <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>PIX,sim_size_85_map[,<span class="fu">c</span>(<span class="st">'PIX'</span>,<span class="st">"BA"</span>)],<span class="at">FUN =</span> sum)</span>
<span id="cb2-1261"><a href="#cb2-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1262"><a href="#cb2-1262" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">=</span> <span class="fu">rbind</span>(<span class="fu">data.frame</span>(<span class="st">"BA"</span><span class="ot">=</span>map.mean<span class="fl">.45</span><span class="sc">$</span>BA<span class="sc">/</span><span class="dv">30</span> ,<span class="at">lab =</span> <span class="st">'RCP4.5'</span>),<span class="fu">data.frame</span>(<span class="st">"BA"</span><span class="ot">=</span>map.mean<span class="fl">.85</span><span class="sc">$</span>BA<span class="sc">/</span><span class="dv">30</span> ,<span class="at">lab=</span><span class="st">"RCP8.5"</span>))</span>
<span id="cb2-1263"><a href="#cb2-1263" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>XL2e <span class="ot">=</span> <span class="fu">rep</span>(coord<span class="sc">$</span>XL2e[idx_safran],<span class="dv">2</span>)</span>
<span id="cb2-1264"><a href="#cb2-1264" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>YL2e <span class="ot">=</span> <span class="fu">rep</span>(coord<span class="sc">$</span>YL2e[idx_safran],<span class="dv">2</span>)</span>
<span id="cb2-1265"><a href="#cb2-1265" aria-hidden="true" tabindex="-1"></a>  file_name <span class="ot">=</span> <span class="fu">paste0</span>(DATA,<span class="st">"map_proj_size_"</span>, model, <span class="st">".RData"</span>)</span>
<span id="cb2-1266"><a href="#cb2-1266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(data,<span class="at">file =</span> file_name)</span>
<span id="cb2-1267"><a href="#cb2-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1268"><a href="#cb2-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1269"><a href="#cb2-1269" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Yearly mean + smooth for trend</span></span>
<span id="cb2-1270"><a href="#cb2-1270" aria-hidden="true" tabindex="-1"></a>  sim_counts_85 <span class="ot">=</span><span class="fu">as.data.frame</span>(sim_counts_85)</span>
<span id="cb2-1271"><a href="#cb2-1271" aria-hidden="true" tabindex="-1"></a>  sim_counts_85<span class="sc">$</span>YEAR <span class="ot">=</span> fwi_rc85<span class="sc">$</span>YEAR</span>
<span id="cb2-1272"><a href="#cb2-1272" aria-hidden="true" tabindex="-1"></a>  yearly.mean<span class="fl">.85</span> <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>YEAR,sim_counts_85,<span class="at">FUN =</span> sum)</span>
<span id="cb2-1273"><a href="#cb2-1273" aria-hidden="true" tabindex="-1"></a>  yearly.mean<span class="fl">.85</span> <span class="ot">=</span> <span class="fu">apply</span>(yearly.mean<span class="fl">.85</span>[,<span class="sc">-</span><span class="dv">1</span>],<span class="dv">1</span>,<span class="at">FUN=</span>mean)</span>
<span id="cb2-1274"><a href="#cb2-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1275"><a href="#cb2-1275" aria-hidden="true" tabindex="-1"></a>  sim_counts_45 <span class="ot">=</span><span class="fu">as.data.frame</span>(sim_counts_45)</span>
<span id="cb2-1276"><a href="#cb2-1276" aria-hidden="true" tabindex="-1"></a>  sim_counts_45<span class="sc">$</span>YEAR <span class="ot">=</span> fwi_rc45<span class="sc">$</span>YEAR</span>
<span id="cb2-1277"><a href="#cb2-1277" aria-hidden="true" tabindex="-1"></a>  yearly.mean<span class="fl">.45</span> <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>YEAR,sim_counts_45,<span class="at">FUN =</span> sum)</span>
<span id="cb2-1278"><a href="#cb2-1278" aria-hidden="true" tabindex="-1"></a>  yearly.mean<span class="fl">.45</span> <span class="ot">=</span> <span class="fu">apply</span>(yearly.mean<span class="fl">.45</span>[,<span class="sc">-</span><span class="dv">1</span>],<span class="dv">1</span>,<span class="at">FUN=</span>mean)</span>
<span id="cb2-1279"><a href="#cb2-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1280"><a href="#cb2-1280" aria-hidden="true" tabindex="-1"></a>  sim_size_85_tot <span class="ot">=</span><span class="fu">as.data.frame</span>(sim_size_85_tot)</span>
<span id="cb2-1281"><a href="#cb2-1281" aria-hidden="true" tabindex="-1"></a>  sim_size_85_tot<span class="sc">$</span>YEAR <span class="ot">=</span> fwi_rc85<span class="sc">$</span>YEAR</span>
<span id="cb2-1282"><a href="#cb2-1282" aria-hidden="true" tabindex="-1"></a>  yearly.mean.<span class="fl">85.</span>size <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>YEAR,sim_size_85_tot,<span class="at">FUN =</span> sum)</span>
<span id="cb2-1283"><a href="#cb2-1283" aria-hidden="true" tabindex="-1"></a>  yearly.mean.<span class="fl">85.</span>size <span class="ot">=</span> <span class="fu">apply</span>(yearly.mean.<span class="fl">85.</span>size[,<span class="sc">-</span><span class="dv">1</span>],<span class="dv">1</span>,<span class="at">FUN=</span>mean)</span>
<span id="cb2-1284"><a href="#cb2-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1285"><a href="#cb2-1285" aria-hidden="true" tabindex="-1"></a>  sim_size_45_tot <span class="ot">=</span><span class="fu">as.data.frame</span>(sim_size_45_tot)</span>
<span id="cb2-1286"><a href="#cb2-1286" aria-hidden="true" tabindex="-1"></a>  sim_size_45_tot<span class="sc">$</span>YEAR <span class="ot">=</span> fwi_rc85<span class="sc">$</span>YEAR</span>
<span id="cb2-1287"><a href="#cb2-1287" aria-hidden="true" tabindex="-1"></a>  yearly.mean.<span class="fl">45.</span>size <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>YEAR,sim_size_45_tot,<span class="at">FUN =</span> sum)</span>
<span id="cb2-1288"><a href="#cb2-1288" aria-hidden="true" tabindex="-1"></a>  yearly.mean.<span class="fl">45.</span>size <span class="ot">=</span> <span class="fu">apply</span>(yearly.mean.<span class="fl">45.</span>size[,<span class="sc">-</span><span class="dv">1</span>],<span class="dv">1</span>,<span class="at">FUN=</span>mean)</span>
<span id="cb2-1289"><a href="#cb2-1289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1290"><a href="#cb2-1290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gc</span>()</span>
<span id="cb2-1291"><a href="#cb2-1291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1292"><a href="#cb2-1292" aria-hidden="true" tabindex="-1"></a>  <span class="co">#smoothing curves with INLA</span></span>
<span id="cb2-1293"><a href="#cb2-1293" aria-hidden="true" tabindex="-1"></a>  stack <span class="ot">=</span> <span class="fu">inla.stack</span>(<span class="at">data =</span> <span class="fu">list</span>(<span class="at">y_45 =</span> yearly.mean<span class="fl">.45</span>, <span class="at">y_85 =</span> yearly.mean<span class="fl">.85</span>, <span class="at">y_45.size =</span>  yearly.mean.<span class="fl">45.</span>size,<span class="at">y_85.size =</span>  yearly.mean.<span class="fl">85.</span>size), <span class="at">A =</span> <span class="fu">list</span>(B_proj, <span class="dv">1</span>), <span class="at">effects =</span> <span class="fu">list</span>(idx_proj, fixed_effects_df))</span>
<span id="cb2-1294"><a href="#cb2-1294" aria-hidden="true" tabindex="-1"></a>  hyper_prec<span class="ot">=</span><span class="fu">list</span>(<span class="at">theta=</span><span class="fu">list</span>(<span class="at">initial =</span> <span class="fu">log</span>(<span class="dv">1</span>), <span class="at">prior=</span><span class="st">"pc.prec"</span>,</span>
<span id="cb2-1295"><a href="#cb2-1295" aria-hidden="true" tabindex="-1"></a>                             <span class="at">param =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>)))</span>
<span id="cb2-1296"><a href="#cb2-1296" aria-hidden="true" tabindex="-1"></a>  my_formula <span class="ot">=</span> y_45 <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> intercept <span class="sc">+</span> time  <span class="sc">+</span> <span class="fu">f</span>(proj, <span class="at">model =</span> spde_proj)</span>
<span id="cb2-1297"><a href="#cb2-1297" aria-hidden="true" tabindex="-1"></a>  fit_45 <span class="ot">=</span> <span class="fu">inla</span>(my_formula,</span>
<span id="cb2-1298"><a href="#cb2-1298" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">inla.stack.data</span>(stack),</span>
<span id="cb2-1299"><a href="#cb2-1299" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="st">"lognormal"</span>,</span>
<span id="cb2-1300"><a href="#cb2-1300" aria-hidden="true" tabindex="-1"></a>                <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">hyper =</span> hyper_prec),</span>
<span id="cb2-1301"><a href="#cb2-1301" aria-hidden="true" tabindex="-1"></a>                <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute=</span><span class="cn">FALSE</span>, <span class="at">A=</span><span class="fu">inla.stack.A</span>(stack)), <span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">num.threads =</span> <span class="dv">2</span>)</span>
<span id="cb2-1302"><a href="#cb2-1302" aria-hidden="true" tabindex="-1"></a>  my_formula <span class="ot">=</span> y_85 <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span>  intercept <span class="sc">+</span> time <span class="sc">+</span> <span class="fu">f</span>(proj, <span class="at">model =</span> spde_proj)</span>
<span id="cb2-1303"><a href="#cb2-1303" aria-hidden="true" tabindex="-1"></a>  fit_85 <span class="ot">=</span> <span class="fu">inla</span>(my_formula,</span>
<span id="cb2-1304"><a href="#cb2-1304" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">inla.stack.data</span>(stack),</span>
<span id="cb2-1305"><a href="#cb2-1305" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="st">"lognormal"</span>,</span>
<span id="cb2-1306"><a href="#cb2-1306" aria-hidden="true" tabindex="-1"></a>                <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">hyper =</span> hyper_prec),</span>
<span id="cb2-1307"><a href="#cb2-1307" aria-hidden="true" tabindex="-1"></a>                <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute =</span> <span class="cn">FALSE</span>, <span class="at">A =</span> <span class="fu">inla.stack.A</span>(stack)),<span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">num.threads =</span> <span class="dv">2</span>)</span>
<span id="cb2-1308"><a href="#cb2-1308" aria-hidden="true" tabindex="-1"></a>  my_formula <span class="ot">=</span> y_45.size <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> intercept <span class="sc">+</span> time  <span class="sc">+</span> <span class="fu">f</span>(proj, <span class="at">model =</span> spde_proj)</span>
<span id="cb2-1309"><a href="#cb2-1309" aria-hidden="true" tabindex="-1"></a>  fit_45.size <span class="ot">=</span> <span class="fu">inla</span>(my_formula,</span>
<span id="cb2-1310"><a href="#cb2-1310" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> <span class="fu">inla.stack.data</span>(stack),</span>
<span id="cb2-1311"><a href="#cb2-1311" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> <span class="st">"lognormal"</span>,</span>
<span id="cb2-1312"><a href="#cb2-1312" aria-hidden="true" tabindex="-1"></a>                     <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">hyper =</span> hyper_prec),</span>
<span id="cb2-1313"><a href="#cb2-1313" aria-hidden="true" tabindex="-1"></a>                     <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute =</span> <span class="cn">FALSE</span>, <span class="at">A =</span> <span class="fu">inla.stack.A</span>(stack)),<span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">num.threads =</span> <span class="dv">2</span>)</span>
<span id="cb2-1314"><a href="#cb2-1314" aria-hidden="true" tabindex="-1"></a>  my_formula <span class="ot">=</span> y_85.size <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> intercept <span class="sc">+</span> time  <span class="sc">+</span> <span class="fu">f</span>(proj, <span class="at">model =</span> spde_proj)</span>
<span id="cb2-1315"><a href="#cb2-1315" aria-hidden="true" tabindex="-1"></a>  fit_85.size <span class="ot">=</span> <span class="fu">inla</span>(my_formula,</span>
<span id="cb2-1316"><a href="#cb2-1316" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> <span class="fu">inla.stack.data</span>(stack),</span>
<span id="cb2-1317"><a href="#cb2-1317" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> <span class="st">"lognormal"</span>,</span>
<span id="cb2-1318"><a href="#cb2-1318" aria-hidden="true" tabindex="-1"></a>                     <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">hyper =</span> hyper_prec),</span>
<span id="cb2-1319"><a href="#cb2-1319" aria-hidden="true" tabindex="-1"></a>                     <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute =</span> <span class="cn">FALSE</span>, <span class="at">A =</span> <span class="fu">inla.stack.A</span>(stack)),<span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">num.threads =</span> <span class="dv">2</span>)</span>
<span id="cb2-1320"><a href="#cb2-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1321"><a href="#cb2-1321" aria-hidden="true" tabindex="-1"></a>  <span class="co">#save slope parameters</span></span>
<span id="cb2-1322"><a href="#cb2-1322" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">=</span> <span class="fu">rbind</span>(beta,<span class="fu">cbind</span>(fit_45<span class="sc">$</span>summary.fixed[<span class="dv">2</span>,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>)],</span>
<span id="cb2-1323"><a href="#cb2-1323" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"lab"</span><span class="ot">=</span><span class="fu">paste</span>(name_clim_model,<span class="st">"4.5"</span>)))</span>
<span id="cb2-1324"><a href="#cb2-1324" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">=</span> <span class="fu">rbind</span>(beta,<span class="fu">cbind</span>(fit_85<span class="sc">$</span>summary.fixed[<span class="dv">2</span>,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>)],</span>
<span id="cb2-1325"><a href="#cb2-1325" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"lab"</span><span class="ot">=</span><span class="fu">paste</span>(name_clim_model,<span class="st">"8.5"</span>)))</span>
<span id="cb2-1326"><a href="#cb2-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1327"><a href="#cb2-1327" aria-hidden="true" tabindex="-1"></a>    beta.size <span class="ot">=</span> <span class="fu">rbind</span>(beta.size,<span class="fu">cbind</span>(fit_45.size<span class="sc">$</span>summary.fixed[<span class="dv">2</span>,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>)],</span>
<span id="cb2-1328"><a href="#cb2-1328" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"lab"</span><span class="ot">=</span><span class="fu">paste</span>(name_clim_model,<span class="st">"4.5"</span>)))</span>
<span id="cb2-1329"><a href="#cb2-1329" aria-hidden="true" tabindex="-1"></a>  beta.size <span class="ot">=</span> <span class="fu">rbind</span>(beta.size,<span class="fu">cbind</span>(fit_85.size<span class="sc">$</span>summary.fixed[<span class="dv">2</span>,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>)],</span>
<span id="cb2-1330"><a href="#cb2-1330" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"lab"</span><span class="ot">=</span><span class="fu">paste</span>(name_clim_model,<span class="st">"8.5"</span>)))</span>
<span id="cb2-1331"><a href="#cb2-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1332"><a href="#cb2-1332" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot the results</span></span>
<span id="cb2-1333"><a href="#cb2-1333" aria-hidden="true" tabindex="-1"></a>  eff <span class="ot">=</span> <span class="st">"proj"</span></span>
<span id="cb2-1334"><a href="#cb2-1334" aria-hidden="true" tabindex="-1"></a>  grid <span class="ot">=</span> <span class="fu">inla.mesh.projector</span>(mesh_proj, <span class="at">loc =</span> year_proj)</span>
<span id="cb2-1335"><a href="#cb2-1335" aria-hidden="true" tabindex="-1"></a>  ngrid <span class="ot">=</span> <span class="fu">length</span>(grid<span class="sc">$</span>x)</span>
<span id="cb2-1336"><a href="#cb2-1336" aria-hidden="true" tabindex="-1"></a>  file_name <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"computo_figures/plot_smooth_"</span>, model, <span class="st">".png"</span>)</span>
<span id="cb2-1337"><a href="#cb2-1337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">png</span>(file_name)</span>
<span id="cb2-1338"><a href="#cb2-1338" aria-hidden="true" tabindex="-1"></a>  ylim <span class="ot">=</span> <span class="fu">range</span>(yearly.mean<span class="fl">.45</span>, yearly.mean<span class="fl">.85</span>)</span>
<span id="cb2-1339"><a href="#cb2-1339" aria-hidden="true" tabindex="-1"></a>  curve_mean_45 <span class="ot">=</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">exp</span>(fit_45<span class="sc">$</span>summary.linear.predictor<span class="sc">$</span>mean[<span class="dv">1</span><span class="sc">:</span>ngrid])</span>
<span id="cb2-1340"><a href="#cb2-1340" aria-hidden="true" tabindex="-1"></a>  curve_upper_45 <span class="ot">=</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">exp</span>(fit_45<span class="sc">$</span>summary.linear.predictor<span class="sc">$</span><span class="st">`</span><span class="at">0.975quant</span><span class="st">`</span>[<span class="dv">1</span><span class="sc">:</span>ngrid])</span>
<span id="cb2-1341"><a href="#cb2-1341" aria-hidden="true" tabindex="-1"></a>  curve_lower_45 <span class="ot">=</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">exp</span>(fit_45<span class="sc">$</span>summary.linear.predictor<span class="sc">$</span><span class="st">`</span><span class="at">0.025quant</span><span class="st">`</span>[<span class="dv">1</span><span class="sc">:</span>ngrid])</span>
<span id="cb2-1342"><a href="#cb2-1342" aria-hidden="true" tabindex="-1"></a>  curve_mean_85 <span class="ot">=</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">exp</span>(fit_85<span class="sc">$</span>summary.linear.predictor<span class="sc">$</span>mean[<span class="dv">1</span><span class="sc">:</span>ngrid])</span>
<span id="cb2-1343"><a href="#cb2-1343" aria-hidden="true" tabindex="-1"></a>  curve_upper_85 <span class="ot">=</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">exp</span>(fit_85<span class="sc">$</span>summary.linear.predictor<span class="sc">$</span><span class="st">`</span><span class="at">0.975quant</span><span class="st">`</span>[<span class="dv">1</span><span class="sc">:</span>ngrid])</span>
<span id="cb2-1344"><a href="#cb2-1344" aria-hidden="true" tabindex="-1"></a>  curve_lower_85 <span class="ot">=</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">exp</span>(fit_85<span class="sc">$</span>summary.linear.predictor<span class="sc">$</span><span class="st">`</span><span class="at">0.025quant</span><span class="st">`</span>[<span class="dv">1</span><span class="sc">:</span>ngrid])</span>
<span id="cb2-1345"><a href="#cb2-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1346"><a href="#cb2-1346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb2-1347"><a href="#cb2-1347" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>year_proj,<span class="at">y=</span>yearly.mean<span class="fl">.45</span>),<span class="at">color =</span> <span class="st">"gray50"</span>,<span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb2-1348"><a href="#cb2-1348" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(name_clim_model)<span class="sc">+</span></span>
<span id="cb2-1349"><a href="#cb2-1349" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>year_proj,<span class="at">y=</span>yearly.mean<span class="fl">.85</span>),<span class="at">color=</span><span class="st">'pink'</span>,<span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb2-1350"><a href="#cb2-1350" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid<span class="sc">$</span>x,<span class="at">y=</span>curve_mean_45),<span class="at">color=</span><span class="st">'gray20'</span>,<span class="at">size=</span><span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb2-1351"><a href="#cb2-1351" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="dv">70</span>,<span class="dv">470</span>)<span class="sc">+</span></span>
<span id="cb2-1352"><a href="#cb2-1352" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid<span class="sc">$</span>x,<span class="at">y=</span>curve_lower_45),<span class="at">color=</span><span class="st">'gray20'</span>,<span class="at">size=</span><span class="fl">1.5</span>,</span>
<span id="cb2-1353"><a href="#cb2-1353" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb2-1354"><a href="#cb2-1354" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid<span class="sc">$</span>x,<span class="at">y=</span>curve_upper_45),<span class="at">color=</span><span class="st">'gray20'</span>,<span class="at">size=</span><span class="fl">1.5</span>,</span>
<span id="cb2-1355"><a href="#cb2-1355" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb2-1356"><a href="#cb2-1356" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid<span class="sc">$</span>x,<span class="at">y=</span>curve_mean_85),<span class="at">color=</span><span class="st">'red'</span>,<span class="at">size=</span><span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb2-1357"><a href="#cb2-1357" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid<span class="sc">$</span>x,<span class="at">y=</span>curve_lower_85),<span class="at">color=</span><span class="st">'red'</span>,<span class="at">size=</span><span class="fl">1.5</span>,</span>
<span id="cb2-1358"><a href="#cb2-1358" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb2-1359"><a href="#cb2-1359" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid<span class="sc">$</span>x,<span class="at">y=</span>curve_upper_85),<span class="at">color=</span><span class="st">'red'</span>,<span class="at">size=</span><span class="fl">1.5</span>,</span>
<span id="cb2-1360"><a href="#cb2-1360" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb2-1361"><a href="#cb2-1361" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb2-1362"><a href="#cb2-1362" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">'Annual count'</span>, <span class="at">x =</span> <span class="st">"Year"</span>)<span class="sc">+</span></span>
<span id="cb2-1363"><a href="#cb2-1363" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="fl">19.3</span>),</span>
<span id="cb2-1364"><a href="#cb2-1364" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">24</span>),</span>
<span id="cb2-1365"><a href="#cb2-1365" aria-hidden="true" tabindex="-1"></a>          <span class="at">title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">18</span>))</span>
<span id="cb2-1366"><a href="#cb2-1366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb2-1367"><a href="#cb2-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1368"><a href="#cb2-1368" aria-hidden="true" tabindex="-1"></a>  file_name <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"computo_figures/plot_smooth_size_"</span>, model, <span class="st">".png"</span>)</span>
<span id="cb2-1369"><a href="#cb2-1369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">png</span>(file_name)</span>
<span id="cb2-1370"><a href="#cb2-1370" aria-hidden="true" tabindex="-1"></a>    curve_mean_45 <span class="ot">=</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">exp</span>(fit_45.size<span class="sc">$</span>summary.linear.predictor<span class="sc">$</span>mean[<span class="dv">1</span><span class="sc">:</span>ngrid])</span>
<span id="cb2-1371"><a href="#cb2-1371" aria-hidden="true" tabindex="-1"></a>  curve_upper_45 <span class="ot">=</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">exp</span>(fit_45.size<span class="sc">$</span>summary.linear.predictor<span class="sc">$</span><span class="st">`</span><span class="at">0.975quant</span><span class="st">`</span>[<span class="dv">1</span><span class="sc">:</span>ngrid])</span>
<span id="cb2-1372"><a href="#cb2-1372" aria-hidden="true" tabindex="-1"></a>  curve_lower_45 <span class="ot">=</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">exp</span>(fit_45.size<span class="sc">$</span>summary.linear.predictor<span class="sc">$</span><span class="st">`</span><span class="at">0.025quant</span><span class="st">`</span>[<span class="dv">1</span><span class="sc">:</span>ngrid])</span>
<span id="cb2-1373"><a href="#cb2-1373" aria-hidden="true" tabindex="-1"></a>  curve_mean_85 <span class="ot">=</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">exp</span>(fit_85.size<span class="sc">$</span>summary.linear.predictor<span class="sc">$</span>mean[<span class="dv">1</span><span class="sc">:</span>ngrid])</span>
<span id="cb2-1374"><a href="#cb2-1374" aria-hidden="true" tabindex="-1"></a>  curve_upper_85 <span class="ot">=</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">exp</span>(fit_85.size<span class="sc">$</span>summary.linear.predictor<span class="sc">$</span><span class="st">`</span><span class="at">0.975quant</span><span class="st">`</span>[<span class="dv">1</span><span class="sc">:</span>ngrid])</span>
<span id="cb2-1375"><a href="#cb2-1375" aria-hidden="true" tabindex="-1"></a>  curve_lower_85 <span class="ot">=</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">exp</span>(fit_85.size<span class="sc">$</span>summary.linear.predictor<span class="sc">$</span><span class="st">`</span><span class="at">0.025quant</span><span class="st">`</span>[<span class="dv">1</span><span class="sc">:</span>ngrid])</span>
<span id="cb2-1376"><a href="#cb2-1376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1377"><a href="#cb2-1377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb2-1378"><a href="#cb2-1378" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>year_proj,<span class="at">y=</span>yearly.mean.<span class="fl">45.</span>size),<span class="at">color =</span> <span class="st">"gray50"</span>,<span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb2-1379"><a href="#cb2-1379" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">2500</span>)<span class="sc">+</span></span>
<span id="cb2-1380"><a href="#cb2-1380" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(name_clim_model)<span class="sc">+</span></span>
<span id="cb2-1381"><a href="#cb2-1381" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>year_proj,<span class="at">y=</span>yearly.mean.<span class="fl">85.</span>size),<span class="at">color=</span><span class="st">'pink'</span>,<span class="at">size=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb2-1382"><a href="#cb2-1382" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid<span class="sc">$</span>x,<span class="at">y=</span>curve_mean_45),<span class="at">color=</span><span class="st">'gray20'</span>,<span class="at">size=</span><span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb2-1383"><a href="#cb2-1383" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid<span class="sc">$</span>x,<span class="at">y=</span>curve_lower_45),<span class="at">color=</span><span class="st">'gray20'</span>,<span class="at">size=</span><span class="fl">1.5</span>,<span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb2-1384"><a href="#cb2-1384" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid<span class="sc">$</span>x,<span class="at">y=</span>curve_upper_45),<span class="at">color=</span><span class="st">'gray20'</span>,<span class="at">size=</span><span class="fl">1.5</span>,<span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb2-1385"><a href="#cb2-1385" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid<span class="sc">$</span>x,<span class="at">y=</span>curve_mean_85),<span class="at">color=</span><span class="st">'red'</span>,<span class="at">size=</span><span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb2-1386"><a href="#cb2-1386" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid<span class="sc">$</span>x,<span class="at">y=</span>curve_lower_85),<span class="at">color=</span><span class="st">'red'</span>,<span class="at">size=</span><span class="fl">1.5</span>,<span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb2-1387"><a href="#cb2-1387" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes_string</span>(<span class="at">x=</span>grid<span class="sc">$</span>x,<span class="at">y=</span>curve_upper_85),<span class="at">color=</span><span class="st">'red'</span>,<span class="at">size=</span><span class="fl">1.5</span>,<span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb2-1388"><a href="#cb2-1388" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb2-1389"><a href="#cb2-1389" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">'Annual burnt area (ha)'</span>, <span class="at">x =</span> <span class="st">"Year"</span>)<span class="sc">+</span></span>
<span id="cb2-1390"><a href="#cb2-1390" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="fl">19.3</span>),</span>
<span id="cb2-1391"><a href="#cb2-1391" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">24</span>),</span>
<span id="cb2-1392"><a href="#cb2-1392" aria-hidden="true" tabindex="-1"></a>          <span class="at">title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">18</span>))</span>
<span id="cb2-1393"><a href="#cb2-1393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb2-1394"><a href="#cb2-1394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1395"><a href="#cb2-1395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(fwi_rc45,fwi_rc85,id_SAFRAN,coordinla_proj,yearly.mean<span class="fl">.85</span>,yearly.mean<span class="fl">.45</span>,sim_counts_45,sim_counts_85,fit_85,fit_45,stack,yearly.mean.<span class="fl">85.</span>size,yearly.mean.<span class="fl">45.</span>size,sim_size_45_tot,sim_size_85_tot,fit_85.size,fit_45.size,idspat, meshproj<span class="fl">.45</span>,meshproj<span class="fl">.85</span>,sim_counts_45_map,sim_counts_85_map,sim_size_45_map,sim_size_85_map)</span>
<span id="cb2-1396"><a href="#cb2-1396" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gc</span>()</span>
<span id="cb2-1397"><a href="#cb2-1397" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-1398"><a href="#cb2-1398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1399"><a href="#cb2-1399" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">=</span> <span class="fu">paste0</span>(DATA,<span class="st">"beta_smooth.RData"</span>)</span>
<span id="cb2-1400"><a href="#cb2-1400" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(beta,beta.size,<span class="at">file =</span> file_name)</span>
<span id="cb2-1401"><a href="#cb2-1401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-1402"><a href="#cb2-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1403"><a href="#cb2-1403" aria-hidden="true" tabindex="-1"></a>::: {#fig-climate-models layout-nrow=2}</span>
<span id="cb2-1404"><a href="#cb2-1404" aria-hidden="true" tabindex="-1"></a><span class="al">![](computo_figures/plot_smooth_1.png)</span></span>
<span id="cb2-1405"><a href="#cb2-1405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1406"><a href="#cb2-1406" aria-hidden="true" tabindex="-1"></a><span class="al">![](computo_figures/plot_smooth_2.png)</span></span>
<span id="cb2-1407"><a href="#cb2-1407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1408"><a href="#cb2-1408" aria-hidden="true" tabindex="-1"></a><span class="al">![](computo_figures/plot_smooth_3.png)</span></span>
<span id="cb2-1409"><a href="#cb2-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1410"><a href="#cb2-1410" aria-hidden="true" tabindex="-1"></a><span class="al">![](computo_figures/plot_smooth_4.png)</span></span>
<span id="cb2-1411"><a href="#cb2-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1412"><a href="#cb2-1412" aria-hidden="true" tabindex="-1"></a><span class="al">![](computo_figures/plot_smooth_size_1.png)</span></span>
<span id="cb2-1413"><a href="#cb2-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1414"><a href="#cb2-1414" aria-hidden="true" tabindex="-1"></a><span class="al">![](computo_figures/plot_smooth_size_2.png)</span></span>
<span id="cb2-1415"><a href="#cb2-1415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1416"><a href="#cb2-1416" aria-hidden="true" tabindex="-1"></a><span class="al">![](computo_figures/plot_smooth_size_3.png)</span></span>
<span id="cb2-1417"><a href="#cb2-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1418"><a href="#cb2-1418" aria-hidden="true" tabindex="-1"></a><span class="al">![](computo_figures/plot_smooth_size_4.png)</span></span>
<span id="cb2-1419"><a href="#cb2-1419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1420"><a href="#cb2-1420" aria-hidden="true" tabindex="-1"></a>Annual means of wildfire occurrences (top-line) and sizes (bottom-line) for the four climate models and the two emission scenarios (RCP4.5 in black, RCP8.5 in red). Dots represent annual averages calculated over twenty samples from the full posterior model, continuous curves report the posterior mean fit of the INLA model used to smooth curves, and dashed lines indicate the corresponding $95\%$ credible intervals.</span>
<span id="cb2-1421"><a href="#cb2-1421" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb2-1422"><a href="#cb2-1422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1423"><a href="#cb2-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1424"><a href="#cb2-1424" aria-hidden="true" tabindex="-1"></a>Looking at @fig-climate-models, the four climate models provide  substantially different results. The IPSL-CM5A and CNRM show no significant trend either for occurrences or for sizes under both scenarios. Among the two other models, MPI-ESM  shows a clearer trend: by 2100, the number of wildfire occurrences can be expected to double on average under the most pessimistic emission scenario. The associated wildfire sizes are also increasing, going from $500$ ha in 2020 to up to $1500$ ha by the end of the century. This evolution can be better measured by looking at the posterior distribution of the decadal linear effect defined in @eq-inla-proj. Summary statistics for $\beta_1$ are reported in the Appendix. Under the RCP8.5 scenario, the HadGEM-RCA4 and MPI-ESM models lead to significantly positive $\beta_1$ estimates since their $95\%$ credible intervals do not contain zero.</span>
<span id="cb2-1425"><a href="#cb2-1425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1426"><a href="#cb2-1426" aria-hidden="true" tabindex="-1"></a>To capture potential spatial variability of projected wildfire activities, we also considered the spatial aggregation of the simulated occurrences and sizes during the end of the projection period (2070–2100), results are depicted in @fig-climate-models-map.</span>
<span id="cb2-1427"><a href="#cb2-1427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1428"><a href="#cb2-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1429"><a href="#cb2-1429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = F,echo= F}</span></span>
<span id="cb2-1430"><a href="#cb2-1430" aria-hidden="true" tabindex="-1"></a><span class="co"># Occurrence plots</span></span>
<span id="cb2-1431"><a href="#cb2-1431" aria-hidden="true" tabindex="-1"></a>projDF <span class="ot">=</span> DF[<span class="fu">order</span>(DF<span class="sc">$</span>PIX),]</span>
<span id="cb2-1432"><a href="#cb2-1432" aria-hidden="true" tabindex="-1"></a>aggr.tot <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>PIX, projDF[,<span class="fu">c</span>(<span class="st">'PIX'</span>,<span class="st">'NB0.1'</span>)], <span class="at">FUN =</span> sum)</span>
<span id="cb2-1433"><a href="#cb2-1433" aria-hidden="true" tabindex="-1"></a>idx_safran <span class="ot">=</span>  <span class="fu">match</span>(aggr.tot<span class="sc">$</span>PIX,coord<span class="sc">$</span>N_SAFRAN)</span>
<span id="cb2-1434"><a href="#cb2-1434" aria-hidden="true" tabindex="-1"></a>data.obs <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="st">'NB'</span><span class="ot">=</span> aggr.tot<span class="sc">$</span>NB0<span class="fl">.1</span> <span class="sc">/</span><span class="dv">15</span> , <span class="st">"PIX"</span> <span class="ot">=</span> aggr.tot<span class="sc">$</span>PIX,</span>
<span id="cb2-1435"><a href="#cb2-1435" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"lab"</span> <span class="ot">=</span> <span class="st">"Observations"</span>,<span class="st">"XL2e"</span> <span class="ot">=</span> coord<span class="sc">$</span>XL2e[idx_safran],</span>
<span id="cb2-1436"><a href="#cb2-1436" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"YL2e"</span> <span class="ot">=</span> coord<span class="sc">$</span>YL2e[idx_safran])</span>
<span id="cb2-1437"><a href="#cb2-1437" aria-hidden="true" tabindex="-1"></a>All_maps <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb2-1438"><a href="#cb2-1438" aria-hidden="true" tabindex="-1"></a>model_names_short <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"IPSL"</span>,<span class="st">"MPI"</span>,<span class="st">"HadGEM"</span>,<span class="st">"CNRM"</span>)</span>
<span id="cb2-1439"><a href="#cb2-1439" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (model <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb2-1440"><a href="#cb2-1440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="fu">paste0</span>(DATA,<span class="st">"map_proj_"</span>, model, <span class="st">".RData"</span>))</span>
<span id="cb2-1441"><a href="#cb2-1441" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>model_name <span class="ot">=</span> <span class="fu">paste</span>(model_names_short[model],data<span class="sc">$</span>lab)</span>
<span id="cb2-1442"><a href="#cb2-1442" aria-hidden="true" tabindex="-1"></a>  All_maps <span class="ot">=</span> <span class="fu">rbind</span>(All_maps,data)</span>
<span id="cb2-1443"><a href="#cb2-1443" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-1444"><a href="#cb2-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1445"><a href="#cb2-1445" aria-hidden="true" tabindex="-1"></a>All_maps <span class="ot">=</span> All_maps[<span class="fu">order</span>(All_maps<span class="sc">$</span>lab),]</span>
<span id="cb2-1446"><a href="#cb2-1446" aria-hidden="true" tabindex="-1"></a>All_maps<span class="sc">$</span>lab_2 <span class="ot">=</span> <span class="fu">factor</span>(All_maps<span class="sc">$</span>model_name, <span class="at">levels=</span><span class="fu">unique</span>(All_maps<span class="sc">$</span>model_name))</span>
<span id="cb2-1447"><a href="#cb2-1447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1448"><a href="#cb2-1448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1449"><a href="#cb2-1449" aria-hidden="true" tabindex="-1"></a>PIXplot <span class="ot">=</span> <span class="fu">unique</span>(data.obs<span class="sc">$</span>PIX)</span>
<span id="cb2-1450"><a href="#cb2-1450" aria-hidden="true" tabindex="-1"></a>coordL2e <span class="ot">=</span> coord[<span class="fu">match</span>(PIXplot,coord<span class="sc">$</span>N_SAFRAN),]</span>
<span id="cb2-1451"><a href="#cb2-1451" aria-hidden="true" tabindex="-1"></a>coordinla <span class="ot">=</span> <span class="fu">cbind</span>(coordL2e<span class="sc">$</span>XL2e<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>,coordL2e<span class="sc">$</span>YL2e<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>)</span>
<span id="cb2-1452"><a href="#cb2-1452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1453"><a href="#cb2-1453" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="fu">ggplot</span>(data.obs)<span class="sc">+</span></span>
<span id="cb2-1454"><a href="#cb2-1454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>XL2e,<span class="at">y=</span>YL2e, <span class="at">color =</span> NB),<span class="at">size=</span><span class="dv">5</span>,<span class="at">shape=</span><span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb2-1455"><a href="#cb2-1455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> departements,<span class="at">fill=</span><span class="st">"NA"</span>)<span class="sc">+</span></span>
<span id="cb2-1456"><a href="#cb2-1456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">default_crs=</span><span class="st">"+init=epsg:27572"</span>,<span class="at">xlim=</span><span class="fu">range</span>(coordinla[,<span class="dv">1</span>])<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>,</span>
<span id="cb2-1457"><a href="#cb2-1457" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylim=</span><span class="fu">range</span>(coordinla[,<span class="dv">2</span>])<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>)<span class="sc">+</span></span>
<span id="cb2-1458"><a href="#cb2-1458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb2-1459"><a href="#cb2-1459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observations"</span>)<span class="sc">+</span></span>
<span id="cb2-1460"><a href="#cb2-1460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">color=</span><span class="st">"Counts/yr"</span>,</span>
<span id="cb2-1461"><a href="#cb2-1461" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">'Latitude'</span>, <span class="at">x =</span> <span class="st">'Longitude'</span>)<span class="sc">+</span></span>
<span id="cb2-1462"><a href="#cb2-1462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">na.value =</span> <span class="cn">NA</span>,</span>
<span id="cb2-1463"><a href="#cb2-1463" aria-hidden="true" tabindex="-1"></a>                      <span class="at">limits =</span> <span class="fu">range</span>(All_maps<span class="sc">$</span>NB),</span>
<span id="cb2-1464"><a href="#cb2-1464" aria-hidden="true" tabindex="-1"></a>                      <span class="at">guide=</span><span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb2-1465"><a href="#cb2-1465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>),</span>
<span id="cb2-1466"><a href="#cb2-1466" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">24</span>),</span>
<span id="cb2-1467"><a href="#cb2-1467" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">22</span>),</span>
<span id="cb2-1468"><a href="#cb2-1468" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>),</span>
<span id="cb2-1469"><a href="#cb2-1469" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb2-1470"><a href="#cb2-1470" aria-hidden="true" tabindex="-1"></a>        <span class="at">title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">18</span>))</span>
<span id="cb2-1471"><a href="#cb2-1471" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> <span class="fu">ggplot</span>(All_maps)<span class="sc">+</span></span>
<span id="cb2-1472"><a href="#cb2-1472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>XL2e,<span class="at">y=</span>YL2e, <span class="at">color =</span> NB),<span class="at">size=</span><span class="dv">5</span>,<span class="at">shape=</span><span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb2-1473"><a href="#cb2-1473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>lab_2,<span class="at">ncol =</span> <span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb2-1474"><a href="#cb2-1474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> departements,<span class="at">fill=</span><span class="st">"NA"</span>)<span class="sc">+</span></span>
<span id="cb2-1475"><a href="#cb2-1475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">default_crs=</span><span class="st">"+init=epsg:27572"</span>,<span class="at">xlim=</span><span class="fu">range</span>(coordinla[,<span class="dv">1</span>])<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>,</span>
<span id="cb2-1476"><a href="#cb2-1476" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylim=</span><span class="fu">range</span>(coordinla[,<span class="dv">2</span>])<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>)<span class="sc">+</span></span>
<span id="cb2-1477"><a href="#cb2-1477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb2-1478"><a href="#cb2-1478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">color=</span><span class="st">"Counts/yr"</span>,</span>
<span id="cb2-1479"><a href="#cb2-1479" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">''</span>, <span class="at">x =</span> <span class="st">''</span>)<span class="sc">+</span></span>
<span id="cb2-1480"><a href="#cb2-1480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">na.value =</span> <span class="cn">NA</span>,<span class="at">limits =</span> <span class="fu">range</span>(All_maps<span class="sc">$</span>NB))<span class="sc">+</span></span>
<span id="cb2-1481"><a href="#cb2-1481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_colourbar</span>(<span class="at">barwidth =</span> <span class="dv">1</span>,<span class="at">barheight =</span> <span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb2-1482"><a href="#cb2-1482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb2-1483"><a href="#cb2-1483" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">24</span>),</span>
<span id="cb2-1484"><a href="#cb2-1484" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">22</span>),</span>
<span id="cb2-1485"><a href="#cb2-1485" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>),</span>
<span id="cb2-1486"><a href="#cb2-1486" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb2-1487"><a href="#cb2-1487" aria-hidden="true" tabindex="-1"></a>        <span class="at">title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">18</span>))</span>
<span id="cb2-1488"><a href="#cb2-1488" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1,p2,<span class="at">nrow=</span><span class="dv">1</span>,<span class="at">widths=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">2.5</span>))</span>
<span id="cb2-1489"><a href="#cb2-1489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1490"><a href="#cb2-1490" aria-hidden="true" tabindex="-1"></a><span class="co"># Size plots</span></span>
<span id="cb2-1491"><a href="#cb2-1491" aria-hidden="true" tabindex="-1"></a>projDF <span class="ot">=</span> DF[<span class="fu">order</span>(DF<span class="sc">$</span>PIX),]</span>
<span id="cb2-1492"><a href="#cb2-1492" aria-hidden="true" tabindex="-1"></a>aggr.tot <span class="ot">=</span> <span class="fu">aggregate</span>(.<span class="sc">~</span>PIX, projDF[,<span class="fu">c</span>(<span class="st">'PIX'</span>,<span class="st">'BA'</span>)], <span class="at">FUN =</span> sum)</span>
<span id="cb2-1493"><a href="#cb2-1493" aria-hidden="true" tabindex="-1"></a>idx_safran <span class="ot">=</span>  <span class="fu">match</span>(aggr.tot<span class="sc">$</span>PIX,coord<span class="sc">$</span>N_SAFRAN)</span>
<span id="cb2-1494"><a href="#cb2-1494" aria-hidden="true" tabindex="-1"></a>data.obs <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="st">'BA'</span><span class="ot">=</span> aggr.tot<span class="sc">$</span>BA<span class="sc">/</span><span class="dv">15</span>,<span class="st">"lab"</span> <span class="ot">=</span> <span class="st">"Observations"</span>,<span class="st">"XL2e"</span> <span class="ot">=</span> coord<span class="sc">$</span>XL2e[idx_safran],<span class="st">"YL2e"</span> <span class="ot">=</span> coord<span class="sc">$</span>YL2e[idx_safran])</span>
<span id="cb2-1495"><a href="#cb2-1495" aria-hidden="true" tabindex="-1"></a>All_maps <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb2-1496"><a href="#cb2-1496" aria-hidden="true" tabindex="-1"></a>model_names_short <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"IPSL"</span>,<span class="st">"MPI"</span>,<span class="st">"HadGEM"</span>,<span class="st">"CNRM"</span>)</span>
<span id="cb2-1497"><a href="#cb2-1497" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (model <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb2-1498"><a href="#cb2-1498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="fu">paste0</span>(DATA,<span class="st">"map_proj_size_"</span>, model, <span class="st">".RData"</span>))</span>
<span id="cb2-1499"><a href="#cb2-1499" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>lab <span class="ot">=</span> <span class="fu">paste</span>(model_names_short[model],data<span class="sc">$</span>lab)</span>
<span id="cb2-1500"><a href="#cb2-1500" aria-hidden="true" tabindex="-1"></a>  All_maps <span class="ot">=</span> <span class="fu">rbind</span>(All_maps,data)</span>
<span id="cb2-1501"><a href="#cb2-1501" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-1502"><a href="#cb2-1502" aria-hidden="true" tabindex="-1"></a>All_maps <span class="ot">=</span> <span class="fu">rbind</span>(All_maps[<span class="fu">str_detect</span>(All_maps<span class="sc">$</span>lab,<span class="st">"RCP4.5"</span>),],</span>
<span id="cb2-1503"><a href="#cb2-1503" aria-hidden="true" tabindex="-1"></a>                 All_maps[<span class="sc">!</span><span class="fu">str_detect</span>(All_maps<span class="sc">$</span>lab,<span class="st">"RCP4.5"</span>),])</span>
<span id="cb2-1504"><a href="#cb2-1504" aria-hidden="true" tabindex="-1"></a>All_maps<span class="sc">$</span>lab_2 <span class="ot">=</span> <span class="fu">factor</span>(All_maps<span class="sc">$</span>lab, <span class="at">levels=</span><span class="fu">unique</span>(All_maps<span class="sc">$</span>lab))</span>
<span id="cb2-1505"><a href="#cb2-1505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1506"><a href="#cb2-1506" aria-hidden="true" tabindex="-1"></a>max.BA <span class="ot">=</span> <span class="fu">max</span>(<span class="fu">c</span>(All_maps<span class="sc">$</span>BA,data.obs<span class="sc">$</span>BA))</span>
<span id="cb2-1507"><a href="#cb2-1507" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="fu">ggplot</span>(data.obs)<span class="sc">+</span></span>
<span id="cb2-1508"><a href="#cb2-1508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>XL2e,<span class="at">y=</span>YL2e, <span class="at">color =</span> <span class="fu">cut</span>(BA, <span class="at">breaks=</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">15</span>,<span class="dv">30</span>,max.BA),<span class="at">include.lowest=</span><span class="cn">TRUE</span>)),<span class="at">size=</span><span class="dv">5</span>,<span class="at">shape=</span><span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb2-1509"><a href="#cb2-1509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> departements,<span class="at">fill=</span><span class="st">"NA"</span>)<span class="sc">+</span></span>
<span id="cb2-1510"><a href="#cb2-1510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">default_crs=</span><span class="st">"+init=epsg:27572"</span>,<span class="at">xlim=</span><span class="fu">range</span>(coordinla[,<span class="dv">1</span>])<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>,</span>
<span id="cb2-1511"><a href="#cb2-1511" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylim=</span><span class="fu">range</span>(coordinla[,<span class="dv">2</span>])<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>)<span class="sc">+</span></span>
<span id="cb2-1512"><a href="#cb2-1512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb2-1513"><a href="#cb2-1513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Observations"</span>)<span class="sc">+</span></span>
<span id="cb2-1514"><a href="#cb2-1514" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">color=</span><span class="st">"Burnt area (ha)"</span>,</span>
<span id="cb2-1515"><a href="#cb2-1515" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">'Latitude'</span>, <span class="at">x =</span> <span class="st">'Longitude'</span>)<span class="sc">+</span></span>
<span id="cb2-1516"><a href="#cb2-1516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">na.value =</span> <span class="cn">NA</span> ,<span class="at">drop =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-1517"><a href="#cb2-1517" aria-hidden="true" tabindex="-1"></a>                      <span class="at">guide=</span><span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb2-1518"><a href="#cb2-1518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>),</span>
<span id="cb2-1519"><a href="#cb2-1519" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">24</span>),</span>
<span id="cb2-1520"><a href="#cb2-1520" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">22</span>),</span>
<span id="cb2-1521"><a href="#cb2-1521" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>),</span>
<span id="cb2-1522"><a href="#cb2-1522" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb2-1523"><a href="#cb2-1523" aria-hidden="true" tabindex="-1"></a>        <span class="at">title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">18</span>))</span>
<span id="cb2-1524"><a href="#cb2-1524" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> <span class="fu">ggplot</span>(All_maps)<span class="sc">+</span></span>
<span id="cb2-1525"><a href="#cb2-1525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>XL2e,<span class="at">y=</span>YL2e, <span class="at">color =</span> <span class="fu">cut</span>(BA, <span class="at">breaks=</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">15</span>,<span class="dv">30</span>,max.BA),<span class="at">include.lowest=</span>T)),<span class="at">size=</span><span class="dv">5</span>,<span class="at">shape=</span><span class="dv">15</span>)<span class="sc">+</span></span>
<span id="cb2-1526"><a href="#cb2-1526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>lab_2,<span class="at">nrow=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb2-1527"><a href="#cb2-1527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> departements,<span class="at">fill=</span><span class="st">"NA"</span>)<span class="sc">+</span></span>
<span id="cb2-1528"><a href="#cb2-1528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">default_crs=</span><span class="st">"+init=epsg:27572"</span>,<span class="at">xlim=</span><span class="fu">range</span>(coordinla[,<span class="dv">1</span>])<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>,</span>
<span id="cb2-1529"><a href="#cb2-1529" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylim=</span><span class="fu">range</span>(coordinla[,<span class="dv">2</span>])<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>)<span class="sc">+</span></span>
<span id="cb2-1530"><a href="#cb2-1530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb2-1531"><a href="#cb2-1531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">color=</span><span class="st">"Burnt area (ha/yr)"</span>,</span>
<span id="cb2-1532"><a href="#cb2-1532" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">''</span>, <span class="at">x =</span> <span class="st">''</span>)<span class="sc">+</span></span>
<span id="cb2-1533"><a href="#cb2-1533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">na.value =</span> <span class="cn">NA</span>,<span class="at">drop =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb2-1534"><a href="#cb2-1534" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size=</span><span class="dv">5</span>)))<span class="sc">+</span></span>
<span id="cb2-1535"><a href="#cb2-1535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb2-1536"><a href="#cb2-1536" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">24</span>),</span>
<span id="cb2-1537"><a href="#cb2-1537" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>),</span>
<span id="cb2-1538"><a href="#cb2-1538" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">18</span>),</span>
<span id="cb2-1539"><a href="#cb2-1539" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb2-1540"><a href="#cb2-1540" aria-hidden="true" tabindex="-1"></a>        <span class="at">title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">18</span>))</span>
<span id="cb2-1541"><a href="#cb2-1541" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1,p2,<span class="at">nrow=</span><span class="dv">1</span>,<span class="at">widths=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">2.5</span>))</span>
<span id="cb2-1542"><a href="#cb2-1542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1543"><a href="#cb2-1543" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-1544"><a href="#cb2-1544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1545"><a href="#cb2-1545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1546"><a href="#cb2-1546" aria-hidden="true" tabindex="-1"></a>::: {#fig-climate-models-map layout-nrow=2}</span>
<span id="cb2-1547"><a href="#cb2-1547" aria-hidden="true" tabindex="-1"></a><span class="al">![Projected wildfire occurrences](computo_figures/map_occ_proj_2.png)</span>{#fig-occ-proj}</span>
<span id="cb2-1548"><a href="#cb2-1548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1549"><a href="#cb2-1549" aria-hidden="true" tabindex="-1"></a><span class="al">![Projected burnt area](computo_figures/map_size_proj_2.png)</span>{#fig-size-proj}</span>
<span id="cb2-1550"><a href="#cb2-1550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1551"><a href="#cb2-1551" aria-hidden="true" tabindex="-1"></a>Spatial patterns of wildfire activity during the end of the projection period (2070–2100) for each climate models and associated climate scenarios. Values correspond to the mean values over the period and are compared to the mean values during the observation period (2006-2020) displayed on the left-hand side.</span>
<span id="cb2-1552"><a href="#cb2-1552" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb2-1553"><a href="#cb2-1553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1554"><a href="#cb2-1554" aria-hidden="true" tabindex="-1"></a>From @fig-occ-proj, it can be seen that the spatial pattern of fire occurrences will remain essentially the same, but the intensities within each pixel may change. Under the scenario RCP $4.5$ most models show no strong significant increasing trend. However, under the pessimistic scenario RCP $8.5$, MPI-ESM model seems to predict a substantial increase in fire activities. To a lesser extent, a similar observation can be made for models CNRM and HadGEM2.</span>
<span id="cb2-1555"><a href="#cb2-1555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1556"><a href="#cb2-1556" aria-hidden="true" tabindex="-1"></a>Looking at the projected burnt areas <span class="co">[</span><span class="ot">@fig-size-proj</span><span class="co">]</span>, similarly to the simulations performed over the observation period in @sec-sim-sizes, predictions are quite noisy which we attribute to the fact that burnt areas are relatively heavy-tailed, such that a relatively small number of values can have a relatively strong influence on the calculation of the mean. But again, under the scenario RCP $8.5$, MPI-ESM model shows a significant increase in the average annual fire size compared to the observation period.</span>
<span id="cb2-1557"><a href="#cb2-1557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1558"><a href="#cb2-1558" aria-hidden="true" tabindex="-1"></a>These experiments seem to indicate that for the Aquitaine region the climate-related vulnerability of forests to wildfires could increase to a lesser extent in the future than in the historical core wildfire area in the Southeastern France.</span>
<span id="cb2-1559"><a href="#cb2-1559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1560"><a href="#cb2-1560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1561"><a href="#cb2-1561" aria-hidden="true" tabindex="-1"></a><span class="fu"># Discussion</span></span>
<span id="cb2-1562"><a href="#cb2-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1563"><a href="#cb2-1563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1564"><a href="#cb2-1564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1565"><a href="#cb2-1565" aria-hidden="true" tabindex="-1"></a>A first remark should be made concerning the most recent wildfire events: as the 2022 weather data are not yet available, the 2022 summer fire season was not considered in this study. Therefore, the projections obtained above do not take into account the relatively extreme fire activities with several very large fires that have been observed in the Western part of France during this period, and the resulting projections could potentially have been more pessimistic in terms of the future increase of wildfire risk in the study region. The results we obtain point towards an increase in future wildfire risk. However, the uncertainty about the future climate remains large and propagates through to projected wildfire risk. Indeed, the weather simulations of the four climate models considered here lead to clearly significant increases only in some cases for rather pessimistic scenarios of greenhouse gas emissions.</span>
<span id="cb2-1566"><a href="#cb2-1566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1567"><a href="#cb2-1567" aria-hidden="true" tabindex="-1"></a>This work presented a step-by-step methodology for the modelling of spatiotemporal marked point processes, that has been applied to the modelling of wildfire activities in the Southwest region of France. Due to the high stochasticity involved in wildfire activity but also in climate-change projections, and due to the complex processes and data that have to be modeled, Bayesian hierarchical modeling provides an appropriate framework for including various observed predictors and random effects into a model that allows for accurate predictions with precise uncertainty assessment. Our model includes additive random effects for various components of the linear predictors, such as nonlinear effects of continuous covariates, spatial random effects and temporal random effects. The SPDE approach provides flexible Gaussian prior distributions for such effects with two hyperparameters for the variance and the correlation range, and the INLA method allows for fast and reliable Bayesian inference even with complex and high-dimensional structures of the latent linear predictor and the likelihood model of the data.</span>
<span id="cb2-1568"><a href="#cb2-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1569"><a href="#cb2-1569" aria-hidden="true" tabindex="-1"></a>In addition, we also presented how INLA can be used to smooth relatively noisy simulations of projected time series of risk occurrences, here based on combining posterior simulations of model parameters with new weather-related covariates obtained from climate model output. Our smoothing approach based on a Bayesian hierarchical model is an attractive statistical alternative to the classical filtering approaches from signal processing, since it can lead to more interpretable results while at the same time providing uncertainty envelopes.</span>
<span id="cb2-1570"><a href="#cb2-1570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1571"><a href="#cb2-1571" aria-hidden="true" tabindex="-1"></a>We want to emphasize that our modeling approach for spatiotemporal marked point processes can also be used in other contexts. In ecology, for example, researchers are interested in modelling the distribution of species in space and time over a given study area: the occurrences of the spatio-temporal process could be the observation locations, and the marks could refer to certain characteristics (traits) of the observed individuals. In particular, we plan to construct INLA-SPDE models similar to the one presented here to project how species distributions evolve in response to present and future climatic change <span class="co">[</span><span class="ot">see e.g. @Guillot2022; @Laxton2023</span><span class="co">]</span>.</span>
<span id="cb2-1572"><a href="#cb2-1572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1573"><a href="#cb2-1573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1574"><a href="#cb2-1574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1575"><a href="#cb2-1575" aria-hidden="true" tabindex="-1"></a><span class="fu"># Appendix {.unnumbered}</span></span>
<span id="cb2-1576"><a href="#cb2-1576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1577"><a href="#cb2-1577" aria-hidden="true" tabindex="-1"></a>Estimates of $\beta_1$ as defined in @eq-inla-proj are depicted in the folowing table, highlighting for which climate model there is a positive trend in wildfire activities (in red).</span>
<span id="cb2-1578"><a href="#cb2-1578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1581"><a href="#cb2-1581" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb2-1582"><a href="#cb2-1582" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Estimated slopes of the linear predictor defined in Eq. (5) for each climate model"</span></span>
<span id="cb2-1583"><a href="#cb2-1583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1584"><a href="#cb2-1584" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">=</span> <span class="fu">unz</span>(<span class="st">"fire_data.zip"</span>, <span class="st">"beta_smooth.RData"</span>)</span>
<span id="cb2-1585"><a href="#cb2-1585" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(temp)</span>
<span id="cb2-1586"><a href="#cb2-1586" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(temp)</span>
<span id="cb2-1587"><a href="#cb2-1587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1588"><a href="#cb2-1588" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(beta) <span class="ot">=</span> beta[,<span class="dv">4</span>]</span>
<span id="cb2-1589"><a href="#cb2-1589" aria-hidden="true" tabindex="-1"></a>all_betas <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">cbind</span>(beta[<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">1</span>,<span class="dv">2</span>),<span class="sc">-</span><span class="dv">4</span>],beta.size[<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">1</span>,<span class="dv">2</span>),<span class="sc">-</span><span class="dv">4</span>]),<span class="dv">3</span>)</span>
<span id="cb2-1590"><a href="#cb2-1590" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(all_betas) <span class="sc">%&gt;%</span></span>
<span id="cb2-1591"><a href="#cb2-1591" aria-hidden="true" tabindex="-1"></a><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-1592"><a href="#cb2-1592" aria-hidden="true" tabindex="-1"></a><span class="fu">row_spec</span>(<span class="fu">which</span>(<span class="fu">rowSums</span>(all_betas<span class="sc">&gt;</span><span class="dv">0</span>)<span class="sc">==</span><span class="dv">6</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-1593"><a href="#cb2-1593" aria-hidden="true" tabindex="-1"></a><span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">" "</span>, <span class="st">"Occurrence"</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">"Size"</span> <span class="ot">=</span> <span class="dv">3</span>))</span>
<span id="cb2-1594"><a href="#cb2-1594" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-1595"><a href="#cb2-1595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1596"><a href="#cb2-1596" aria-hidden="true" tabindex="-1"></a><span class="fu"># Ackowledgments {.unnumbered}</span></span>
<span id="cb2-1597"><a href="#cb2-1597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1598"><a href="#cb2-1598" aria-hidden="true" tabindex="-1"></a>The authors are grateful to Météo-France for making the SAFRAN data available.</span>
<span id="cb2-1599"><a href="#cb2-1599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1600"><a href="#cb2-1600" aria-hidden="true" tabindex="-1"></a><span class="fu"># Supplementary materials {.unnumbered}</span></span>
<span id="cb2-1601"><a href="#cb2-1601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1602"><a href="#cb2-1602" aria-hidden="true" tabindex="-1"></a>All data used in this study are available at the following link: <span class="co">[</span><span class="ot">https://doi.org/10.5281/zenodo.7870592</span><span class="co">](https://doi.org/10.5281/zenodo.7870592)</span>. Note that for confidentiality reasons, the fire data provided correspond to simulated data from the model developed in this work.</span>
<span id="cb2-1603"><a href="#cb2-1603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1604"><a href="#cb2-1604" aria-hidden="true" tabindex="-1"></a>The R codes are available on GitHub: <span class="co">[</span><span class="ot">https://github.com/jlegrand35/wildfire_activities</span><span class="co">](https://github.com/jlegrand35/wildfire_activities)</span></span>
<span id="cb2-1605"><a href="#cb2-1605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1606"><a href="#cb2-1606" aria-hidden="true" tabindex="-1"></a><span class="fu"># References {.unnumbered}</span></span>
<span id="cb2-1607"><a href="#cb2-1607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1608"><a href="#cb2-1608" aria-hidden="true" tabindex="-1"></a>::: {#refs}</span>
<span id="cb2-1609"><a href="#cb2-1609" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb2-1610"><a href="#cb2-1610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1611"><a href="#cb2-1611" aria-hidden="true" tabindex="-1"></a><span class="fu"># Session information {.appendix .unnumbered}</span></span>
<span id="cb2-1612"><a href="#cb2-1612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-1613"><a href="#cb2-1613" aria-hidden="true" tabindex="-1"></a><span class="in">```{r session-info} </span></span>
<span id="cb2-1614"><a href="#cb2-1614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sessionInfo</span>() </span>
<span id="cb2-1615"><a href="#cb2-1615" aria-hidden="true" tabindex="-1"></a><span class="in">```</span> </span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>